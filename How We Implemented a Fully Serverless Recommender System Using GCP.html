<!DOCTYPE html>
<!-- saved from url=(0111)https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc -->
<html xmlns:cc="http://creativecommons.org/ns#" class=""><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# medium-com: http://ogp.me/ns/fb/medium-com#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=contain"><title>How We Implemented a Fully Serverless Recommender System Using GCP</title><link rel="canonical" href="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc"><meta name="title" content="How We Implemented a Fully Serverless Recommender System Using GCP"><meta name="referrer" content="always"><meta name="description" content="Just recently we were faced with a quite exciting challenge by our company and I’d like to take the opportunity to write down about it and what we’ve learned along the way. Our main goal was to work…"><meta name="theme-color" content="#000000"><meta property="og:title" content="How We Implemented a Fully Serverless Recommender System Using GCP"><meta property="twitter:title" content="How We Implemented a Fully Serverless Recommender System Using GCP"><meta property="og:url" content="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc"><meta property="og:image" content="https://cdn-images-1.medium.com/max/1200/1*axNxklrne21SY_N6pyXp-w.png"><meta property="fb:app_id" content="542599432471018"><meta property="og:description" content="Just recently we were faced with a quite exciting challenge by our company and I’d like to take the opportunity to write down about it and…"><meta name="twitter:description" content="Just recently we were faced with a quite exciting challenge by our company and I’d like to take the opportunity to write down about it and…"><meta name="twitter:image:src" content="https://cdn-images-1.medium.com/max/1200/1*axNxklrne21SY_N6pyXp-w.png"><link rel="publisher" href="https://plus.google.com/103654360130207659246"><link rel="author" href="https://medium.com/@willian.fuks"><meta property="author" content="Will Fuks"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="article:publisher" content="https://www.facebook.com/medium"><meta property="article:author" content="Will Fuks"><meta name="robots" content="index, follow"><meta property="article:published_time" content="2017-12-12T14:13:02.577Z"><meta name="twitter:site" content="@Medium"><meta property="og:site_name" content="Medium"><meta name="twitter:label1" value="Reading time"><meta name="twitter:data1" value="29 min read"><meta name="twitter:app:name:iphone" content="Medium"><meta name="twitter:app:id:iphone" content="828256236"><meta name="twitter:app:url:iphone" content="medium://p/9c9fbbdc46cc"><meta property="al:ios:app_name" content="Medium"><meta property="al:ios:app_store_id" content="828256236"><meta property="al:android:package" content="com.medium.reader"><meta property="al:android:app_name" content="Medium"><meta property="al:ios:url" content="medium://p/9c9fbbdc46cc"><meta property="al:android:url" content="medium://p/9c9fbbdc46cc"><meta property="al:web:url" content="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc"><link rel="search" type="application/opensearchdescription+xml" title="Medium" href="https://medium.com/osd.xml"><link rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/9c9fbbdc46cc"><script async="" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/branch-latest.min.js"></script><script type="application/ld+json">{"@context":"http://schema.org","@type":"NewsArticle","image":{"@type":"ImageObject","width":795,"height":520,"url":"https://cdn-images-1.medium.com/max/875/1*axNxklrne21SY_N6pyXp-w.png"},"url":"https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc","dateCreated":"2017-12-12T14:13:02.577Z","datePublished":"2017-12-12T14:13:02.577Z","dateModified":"2018-06-20T15:06:38.817Z","headline":"How We Implemented a Fully Serverless Recommender System Using GCP","name":"How We Implemented a Fully Serverless Recommender System Using GCP","thumbnailUrl":"https://cdn-images-1.medium.com/max/875/1*axNxklrne21SY_N6pyXp-w.png","keywords":["Tag:Google Cloud Platform","Tag:Machine Learning","Tag:Recommender Systems","Tag:Serverless","Publication:google-cloud","LockedPostSource:0","Elevated:false","LayerCake:0"],"author":{"@type":"Person","name":"Will Fuks","url":"https://medium.com/@willian.fuks"},"creator":["Will Fuks"],"publisher":{"@type":"Organization","name":"Google Cloud Platform - Community","url":"https://medium.com/google-cloud","logo":{"@type":"ImageObject","width":60,"height":60,"url":"https://cdn-images-1.medium.com/max/66/1*FUjLiCANvATKeaJEeg20Rw.png"}},"mainEntityOfPage":"https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc"}</script><meta name="parsely-link" content="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc"><link rel="stylesheet" type="text/css" class="js-glyph-" id="glyph-8" href="./How We Implemented a Fully Serverless Recommender System Using GCP_files/m2.css"><link rel="stylesheet" href="./How We Implemented a Fully Serverless Recommender System Using GCP_files/main-branding-base.SKBRHU_QJfaEkjWHhwLaJA.css"><script>if (window.top !== window.self) window.top.location = window.self.location.href;var OB_startTime = new Date().getTime(); var OB_loadErrors = []; function _onerror(e) { OB_loadErrors.push(e) }; if (document.addEventListener) document.addEventListener("error", _onerror, true); else if (document.attachEvent) document.attachEvent("onerror", _onerror); function _asyncScript(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = u; f.parentNode.insertBefore(s, f);}function _asyncStyles(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("link"); s.rel = "stylesheet"; s.href = u; f.parentNode.insertBefore(s, f); return s}(new Image()).src = "/_/stat?event=pixel.load&origin=" + encodeURIComponent(location.origin);</script><!--[if lt IE 9]><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js"></script><![endif]--><link rel="icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico" class="js-favicon"><link rel="apple-touch-icon" sizes="152x152" href="https://cdn-images-1.medium.com/fit/c/167/167/1*FUjLiCANvATKeaJEeg20Rw.png"><link rel="apple-touch-icon" sizes="120x120" href="https://cdn-images-1.medium.com/fit/c/132/132/1*FUjLiCANvATKeaJEeg20Rw.png"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn-images-1.medium.com/fit/c/84/84/1*FUjLiCANvATKeaJEeg20Rw.png"><link rel="apple-touch-icon" sizes="60x60" href="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_FUjLiCANvATKeaJEeg20Rw(1).png"><link rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg" color="#171717"></head><body itemscope="" class="postShowScreen browser-chrome os-mac is-withMagicUnderlinesv-glyph v-glyph--m2 is-js is-withMagicUnderlines is-resizing" data-action-scope="_actionscope_0"><script>document.body.className = document.body.className.replace(/(^|\s)is-noJs(\s|$)/, "$1is-js$2")</script><div class="site-main surface-container" id="container"><div class="butterBar butterBar--error" data-action-scope="_actionscope_1"><div class="butterBar-message">Images haven’t loaded yet. Please exit printing, wait for images to load, and try to print again.</div></div><div class="surface" id="_obv.shell._surface_1539586055752" style="display: block; visibility: visible;"><div class="screenContent surface-content is-supplementalPostContentLoaded" data-used="true" data-action-scope="_actionscope_2"><canvas class="canvas-renderer" width="1294" height="617"></canvas><div class="container u-maxWidth740 u-xs-margin0 notesPositionContainer js-notesPositionContainer"><div class="notesMarkers" data-action-scope="_actionscope_5"></div></div><div class="metabar u-clearfix js-metabar u-fixed u-backgroundTransparentWhiteDarkest u-xs-sizeFullViewportWidth"><div class="branch-journeys-top"></div><div class="js-metabarMiddle metabar-inner u-marginAuto u-maxWidth1000 u-flexCenter u-justifyContentSpaceBetween u-height65 u-xs-height56 u-paddingHorizontal20"><div class="metabar-block u-flex1  u-flexCenter"><div class="js-metabarLogoLeft"><a href="https://medium.com/" data-log-event="home" class="siteNav-logo u-flexCenter u-paddingTop0"><span class="svgIcon svgIcon--logoMonogram svgIcon--45px is-flushLeft u-flexCenter u-paddingTop0"><svg class="svgIcon-use" width="45" height="45"><path d="M5 40V5h35v35H5zm8.56-12.627c0 .555-.027.687-.318 1.03l-2.457 2.985v.396h6.974v-.396l-2.456-2.985c-.291-.343-.344-.502-.344-1.03V18.42l6.127 13.364h.714l5.256-13.364v10.644c0 .29 0 .342-.185.528l-1.848 1.796v.396h9.19v-.396l-1.822-1.796c-.184-.186-.21-.238-.21-.528V15.937c0-.291.026-.344.21-.528l1.823-1.797v-.396h-6.471l-4.622 11.542-5.203-11.542h-6.79v.396l2.14 2.64c.239.292.291.37.291.768v10.353z"></path></svg></span><span class="u-textScreenReader">Homepage</span></a></div><div class="u-flexCenter u-height65 u-xs-height56"><span class="u-inlineBlock u-height28 u-xs-height24 u-verticalAlignTop u-marginRight20 u-marginLeft15 u-borderRightLighter"></span></div><div class="u-flexCenter u-height65 u-xs-height56 u-marginRight18"><a class="js-collectionLogoOrName u-uiTextBold u-fontSize18 u-lineHeightTightest u-xs-fontSize22" href="https://medium.com/google-cloud?source=logo-lo_dnt_IwTGKK4Ik4yn---e52cf94d98af"><img height="36" width="36" class="u-paddingTop5" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_FUjLiCANvATKeaJEeg20Rw.png" alt="Google Cloud Platform - Community"></a></div><div class="u-flexCenter u-height65 u-xs-height56 u-xs-hide"><div class="buttonSet"><button class="button button--primary button--smallest u-noUserSelect button--withChrome u-accentColor--buttonNormal js-relationshipButton is-smallPill" data-action="sign-up-prompt" data-sign-in-action="toggle-follow-collection" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/collection/google-cloud" data-action-source="----e52cf94d98af----------------------follow_header" data-collection-id="e52cf94d98af"><span class="button-label  js-buttonLabel">Follow</span></button></div></div></div><div class="metabar-block u-flex0 u-flexCenter"><div class="u-flexCenter u-height65 u-xs-height56"><div class="buttonSet buttonSet--wide u-lineHeightInherit"><a class="button button--primary button--chromeless u-accentColor--buttonNormal is-inSiteNavBar u-xs-hide js-signInButton" href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2Fgoogle-cloud%2Fhow-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc&amp;source=--------------------------nav_reg&amp;operation=login" data-action="sign-in-prompt" data-redirect="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc" data-action-source="--------------------------nav_reg">Sign in</a><a class="button button--primary button--withChrome u-accentColor--buttonNormal is-inSiteNavBar js-signUpButton" href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2Fgoogle-cloud%2Fhow-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc&amp;source=--------------------------nav_reg&amp;operation=register" data-action="sign-up-prompt" data-redirect="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc" data-action-source="--------------------------nav_reg">Get started</a></div></div></div></div><div class="metabar-inner u-marginAuto u-maxWidth1000 js-metabarBottom"><nav role="navigation" class="metabar-block metabar-block--below u-overflowHidden u-height44"><ul class="u-textAlignLeft u-noWrap u-overflowX u-paddingBottom100 u-sm-paddingLeft20 u-sm-paddingRight20 js-collectionNavItems"><li class="metabar-navItem js-collectionNavItem u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken u-baseColor--link js-homeNav" href="https://medium.com/google-cloud">Home</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink" href="https://medium.com/google-cloud/weekly/home">This Week in GCP</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink" href="https://medium.com/google-cloud/tagged/kubernetes">Containers</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink" href="https://medium.com/google-cloud/tagged/google-compute-engine">Virtualization</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink" href="https://medium.com/google-cloud/tagged/google-app-engine">Platform as a Service</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink" href="https://medium.com/google-cloud/tagged/bigquery">Data</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink" href="https://medium.com/google-cloud/tagged/machine-learning">Machine Learning</a></li><span class="u-borderLeft1 u-paddingLeft12 u-baseColor--borderLight"></span><li class="metabar-navItem js-collectionNavItem  u-paddingLeft0 is-external u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darkenOnHover u-accentColor--textDarken link--noUnderline u-baseColor--link js-navItemLink" href="https://cloud.google.com/blog/" rel="nofollow noopener" target="_blank">More</a></li><li class="metabar-navItem js-collectionNavItem u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon u-top1" href="https://medium.com/google-cloud/search" title="Search" aria-label="Search"><span class="button-defaultState"><span class="svgIcon svgIcon--search svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M20.067 18.933l-4.157-4.157a6 6 0 1 0-.884.884l4.157 4.157a.624.624 0 1 0 .884-.884zM6.5 11c0-2.62 2.13-4.75 4.75-4.75S16 8.38 16 11s-2.13 4.75-4.75 4.75S6.5 13.62 6.5 11z"></path></svg></span></span></a></li></ul></nav></div></div><div class="metabar metabar--spacer js-metabarSpacer  u-height105 u-xs-height95"></div><main role="main"><article class=" u-minHeight100vhOffset65 u-overflowHidden postArticle postArticle--full is-withAccentColors u-marginBottom40" lang="en"><header class="container u-maxWidth740"><div class="uiScale uiScale-ui--regular uiScale-caption--regular postMetaHeader u-paddingBottom10 row"><div class="col u-size12of12 js-postMetaLockup"><div class="uiScale uiScale-ui--regular uiScale-caption--regular postMetaLockup postMetaLockup--authorWithBio u-flexCenter js-postMetaLockup"><div class="u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@willian.fuks?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_KKOPcg6qjT9LWFRohbOwjQ.jpeg" class="avatar-image avatar-image--small" alt="Go to the profile of Will Fuks"></a></div><div class="u-flex1 u-paddingLeft15 u-overflowHidden"><div class="u-lineHeightTightest"><a class="ds-link ds-link--styleSubtle ui-captionStrong u-inlineBlock link link--darken link--darker" href="https://medium.com/@willian.fuks?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a><span class="followState js-followState" data-user-id="e9c35a095d0d"><button class="button button--smallest u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-marginLeft10 u-xs-hide" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc" data-action-source="post_header_lockup"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--smallest u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-marginLeft10 u-xs-hide" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/e9c35a095d0d" data-action-source="post_header_lockup-e9c35a095d0d-------------------------follow_byline"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="ui-caption ui-xs-clamp2 postMetaInline">Working as a Data Scientist at Dafiti Group</div><div class="ui-caption postMetaInline js-testPostMetaInlineSupplemental"><time datetime="2017-12-12T14:13:02.577Z">Dec 12, 2017</time><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="29 min read"></span></div></div></div></div></div></header><div class="postArticle-content js-postField js-notesSource js-trackedPost" data-post-id="9c9fbbdc46cc" data-source="post_page" data-collection-id="e52cf94d98af" data-tracking-context="postPage" data-scroll="native"><section name="b233" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h1 name="11c0" id="11c0" class="graf graf--h3 graf--leading graf--title">How We Implemented a Fully Serverless Recommender System Using&nbsp;GCP</h1><p name="f59b" id="f59b" class="graf graf--p graf-after--h3">Just recently we were faced with a quite exciting challenge by our company and I’d like to take the opportunity to write down about it and what we’ve learned along the way.</p><p name="bcb3" id="bcb3" class="graf graf--p graf-after--p">Our main goal was to work together with our central team at <a href="http://global-fashion-group.com/" data-href="http://global-fashion-group.com/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">GFG Group</a> to develop a Recommender System capable of interacting effectively with our customers for our different ventures, with one catch: it should be built on top of <a href="https://spark.apache.org/" data-href="https://spark.apache.org/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Apache-Spark</a>; reason being that the team already had a know-how on Spark systems and its management in production environment.</p><p name="2e0c" id="2e0c" class="graf graf--p graf-after--p">So, in this post, I’d like to write about what implementation we came up with. We had two months to implement something and the final solution ended up being a fully Serverless system built on top of Google Cloud Platform (GCP).</p><p name="4727" id="4727" class="graf graf--p graf-after--p">The final algorithm implemented is known as “DIMSUM” and is the one currently running at Twitter as well. Here’s an overview of the implemented architecture of what we’ll be discussing in this post:</p><figure name="26db" id="26db" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 458px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 65.4%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*axNxklrne21SY_N6pyXp-w.png" data-width="795" data-height="520" data-action="zoom" data-action-value="1*axNxklrne21SY_N6pyXp-w.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_axNxklrne21SY_N6pyXp-w.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="47"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*axNxklrne21SY_N6pyXp-w.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_axNxklrne21SY_N6pyXp-w(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*axNxklrne21SY_N6pyXp-w.png"></noscript></div></div></figure><p name="55b2" id="55b2" class="graf graf--p graf-after--figure">In a nutshell: AppEngine orchestrates calls (triggered by crons) that loads data to our Cloud Storage, builds a Dataproc cluster, process our main algorithm, saves results to Storage again and finally we have a Dataflow pipeline execution that loads the results to Datastore so that Appengine has direct access and can serve recommendations to our customers.</p><p name="4171" id="4171" class="graf graf--p graf-after--p">Ok, that was quite of a hell of a nutshell.</p><p name="1447" id="1447" class="graf graf--p graf-after--p">Don’t worry about all these operations for now, notice though that we have different colors connecting different elements and those will be discussed separately as they constitute the main blocks of our system. Themes covered in this post will be:</p><ol class="postList"><li name="1426" id="1426" class="graf graf--li graf-after--p">Understanding the Algorithm</li><li name="cb1e" id="cb1e" class="graf graf--li graf-after--li">Getting the Data</li><li name="786d" id="786d" class="graf graf--li graf-after--li">Cron Jobs in AppEngine</li><li name="c8ec" id="c8ec" class="graf graf--li graf-after--li">Dataproc Execution</li><li name="efba" id="efba" class="graf graf--li graf-after--li">Pipeline Process with Dataflow</li><li name="fb63" id="fb63" class="graf graf--li graf-after--li">Making Recommendations</li><li name="2d25" id="2d25" class="graf graf--li graf-after--li">Costs Estimation</li><li name="d48a" id="d48a" class="graf graf--li graf-after--li">Future Work</li><li name="3edd" id="3edd" class="graf graf--li graf-after--li">Conclusion</li></ol><p name="17a6" id="17a6" class="graf graf--p graf-after--li">With no further ado, let’s go!</p><h3 name="f6d5" id="f6d5" class="graf graf--h3 graf-after--p">1. Understanding the Algorithm (DIMSUM)</h3><p name="7905" id="7905" class="graf graf--p graf-after--h3">Our first approach was trying to implement the <a href="http://yifanhu.net/PUB/cf.pdf" data-href="http://yifanhu.net/PUB/cf.pdf" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">neighborhood algorithm</a>, a very successful implementation very popular in the Recommender Systems literature, specially in the field of <a href="https://en.wikipedia.org/wiki/Collaborative_filtering" data-href="https://en.wikipedia.org/wiki/Collaborative_filtering" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Collaborative Filtering</a>.</p><p name="2d9d" id="2d9d" class="graf graf--p graf-after--p">It works by basically finding similarity scores between different items (and items here can be products, customers, music, anything in which you can extract some sense of correlation between elements) and uses these scores to predict how much customers will enjoy a given each item.</p><p name="5824" id="5824" class="graf graf--p graf-after--p">In eCommerce, for the most part, we don’t know exactly whether a given customer liked an item or not; that means that all we can do is compute general interactions from customers such as “how many times he or she visited this product? Did he put this to basket? Did she purchased it? If so, we try to add values that indicates some sense of likability for that particular item, as implicit as it may be, we still try to extract signal from those actions.</p><p name="fa90" id="fa90" class="graf graf--p graf-after--p">To make it more clear, let’s say we observed 4 customers and their interactions with 2 distinct products (1 means customer browsed the product page):</p><figure name="043a" id="043a" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 510px; max-height: 183px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.9%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*kDtbdE5olB81in5lrDICQQ.png" data-width="510" data-height="183" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_kDtbdE5olB81in5lrDICQQ.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="25"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*kDtbdE5olB81in5lrDICQQ.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_kDtbdE5olB81in5lrDICQQ(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*kDtbdE5olB81in5lrDICQQ.png"></noscript></div></div></figure><p name="dca3" id="dca3" class="graf graf--p graf-after--figure">To find a correlation between these two shoes, we use the cosine similarity given by the formula:</p><figure name="df73" id="df73" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 557px; max-height: 182px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 32.7%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*IPV2VURSJG13NAa4-N7Blw.png" data-width="557" data-height="182" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_IPV2VURSJG13NAa4-N7Blw.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="22"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*IPV2VURSJG13NAa4-N7Blw.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_IPV2VURSJG13NAa4-N7Blw(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*IPV2VURSJG13NAa4-N7Blw.png"></noscript></div></div></figure><p name="dc31" id="dc31" class="graf graf--p graf-after--figure">All the equation is saying is the similarity metric is the summation of intersections between products for each customer normalized by those interactions.</p><p name="5176" id="5176" class="graf graf--p graf-after--p">If, say, every single customer interacts with both products then the result will be exactly 1 which means both products are 100% similar. Customers who likes one are expected to like just the same the other; if they interact with just one of the skus and not the other then final result will be 0 which leads to the notion that if a customer likes one there’s no expectation that he or she will like the other.</p><p name="07f2" id="07f2" class="graf graf--p graf-after--p">In the previous example we have:</p><p name="1850" id="1850" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">A</strong> = [1, 0, 1, 1]; <strong class="markup--strong markup--p-strong">B</strong> = [0, 0, 1, 1]</p><p name="d488" id="d488" class="graf graf--p graf-after--p">Applying the similarity score equation we get:</p><p name="7357" id="7357" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">similarity</em> = (1 * 0 + 0 * 0 + 1 * 1 + 1 * 1) / √(1² + 0² + 1² + 1²) * √(0² + 0² + 1² + 1²) ≈ 0.82</p><p name="3274" id="3274" class="graf graf--p graf-after--p">As you can see, it’s literally an extraction of intersections between products normalized by the all the values on that product.</p><p name="5f09" id="5f09" class="graf graf--p graf-after--p">With these similarities scores we can make predictions of how much customers might enjoy items not seem so far. Let’s take our previous example: if we know that the similarity between red shoes and beige is 82% and suppose we know a customer liked one of them; we can infer that there’s a 82% chance that he will like the other given their similarity score. We can express this notion of making predictions to new items mathematically by:</p><figure name="4279" id="4279" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 307px; max-height: 104px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 33.900000000000006%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*jAXRKAqL8RGlF2fcxf61iQ.png" data-width="307" data-height="104" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_jAXRKAqL8RGlF2fcxf61iQ.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="25"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*jAXRKAqL8RGlF2fcxf61iQ.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_jAXRKAqL8RGlF2fcxf61iQ(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*jAXRKAqL8RGlF2fcxf61iQ.png"></noscript></div></div></figure><p name="f90e" id="f90e" class="graf graf--p graf-after--figure">Time to introduce some notation: in the above equation, “u” identifies a given customer at our website; “i” and “j” are identifiers for items, the “r” is a metric that tells us how user <em class="markup--em markup--p-em">u</em> interacted with an item so in our previous example it’s the 1s and 0s. The “s” is the similarity we just computed, so “s_ij” is the similarity between item “i” with “j” (in our example, “i” could be the red shoes and “j” the beige one).</p><p name="7f0d" id="7f0d" class="graf graf--p graf-after--p">So all the formula is saying: to predict how much user “u” will like item “i”, expressed by the “r” with the “^” symbol, we observe all items that he or she interacted with; we observe the similarities between those and the one we want to make the prediction, multiply all the interactions by the similarities and sum everything up (the division is a way of normalizing the equation and in practice we don’t apply it as recommended by the literature). I know it sounds confusing, but given that an image is worth a thousand words, here’s a depiction of how it works:</p><figure name="dbaa" id="dbaa" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 226px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 32.4%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*hGNfIt4q9lK588AQE_eMhg.png" data-width="1020" data-height="330" data-action="zoom" data-action-value="1*hGNfIt4q9lK588AQE_eMhg.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_hGNfIt4q9lK588AQE_eMhg.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="22"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*hGNfIt4q9lK588AQE_eMhg.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_hGNfIt4q9lK588AQE_eMhg(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*hGNfIt4q9lK588AQE_eMhg.png"></noscript></div></div></figure><p name="b1ac" id="b1ac" class="graf graf--p graf-after--figure">In this case, our customer interacted “1.5” points with first sku, 2 with second and 2.5 with third. The similarities between those same products and the one we want to make the prediction is 56%, 21% and 67% respectively. Therefore, for us to predict how much this customer will enjoy the fourth product we multiply the interactions and similarities of each sku we know about the customer, sum everything up and normalize by the similarity scores which results in 2.42. This is an expectation of how much we predict our customer will enjoy this particular item.</p><p name="2449" id="2449" class="graf graf--p graf-after--p">And that’s pretty much it! In summary, neighborhood observes all interactions of customers and items and extract these similarities metrics between them which allows us to predict how customers will enjoy new items.</p><p name="1f8d" id="1f8d" class="graf graf--p graf-after--p">There’s one problem though and here is where the challenge begins: at Dafiti (one of the ventures from GFG), we have millions of customers visiting our website everyday and they can potentially interact with some other hundreds of thousands of available products.</p><p name="ab37" id="ab37" class="graf graf--p graf-after--p">If you take Dafiti’s data and try to find all interactions of customers and items and then try to build all similarities between all products you’ll find your computer/cluster exploding and burning into flames after a few seconds in. And if you do that in some shared cluster make sure to leave the building ASAP (remove digital prints before doing so*).</p><p name="56de" id="56de" class="graf graf--p graf-after--p">Well, as it turns out, there’s smarter ways of doing it and here’s where we started making some considerable progress in our challenge.</p><h4 name="5e5a" id="5e5a" class="graf graf--h4 graf-after--p">1.1 The DIMSUM&nbsp;Approach</h4><p name="edfc" id="edfc" class="graf graf--p graf-after--h4">As using Spark was a mandatory request for this project, we searched for ways on how to implement cosines computation in a MapReduce fashion; what we found is that the framework is basically a pipeline of steps where you can map your input value to new values and reduce it (if you ever need so) to aggregate results into some final metric. Main idea therefore is: apply map to transform data and if you need some aggregation (you normally do) then use some reduce operation.</p><p name="e0c2" id="e0c2" class="graf graf--p graf-after--p">And if you think it through, you’ll end up realizing that it’s actually quite simple to implement some neighborhood approach in a MapReduce framework: we have our training data which contains users and their interactions with products (we’ll discuss more about those later) so we can arrange it like:</p><pre name="7b52" id="7b52" class="graf graf--pre graf-after--p">{“user”: “user_0”, “items”: [{“sku”: “sku_0”, “r”: 1},<br>                             {“sku”: “sku_1”, “r”: 2}]}<br>{“user”: “user_1”, “items”: [{“sku”: “sku_0”, “r”: 2},<br>                             {“sku”: “sku_2”, “r”: 1}]}</pre><pre name="422d" id="422d" class="graf graf--pre graf-after--pre">(...)</pre><pre name="ad94" id="ad94" class="graf graf--pre graf-after--pre">{“user”: “user_m”, “items”: [{“sku”: “sku_0”, “r”: 2},<br>                             {“sku”: “sku_n”, “r”: 1}]}</pre><p name="891f" id="891f" class="graf graf--p graf-after--pre">In other words, we can arrange it to <em class="markup--em markup--p-em">m</em> users and their interactions for potentially <em class="markup--em markup--p-em">n</em> items (remember that we do not save “zero” values as this would consume huge amounts of memory unnecessarily).</p><p name="b09b" id="b09b" class="graf graf--p graf-after--p">As the cosine metric looks for correlations between products on a customer level (if a customer interacts with both items then their intersection grows), we can use this simple algorithm to extract similarities:</p><figure name="6c8d" id="6c8d" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 526px; max-height: 272px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 51.7%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*DlaWO0yR3UGrxbE2roOtzg.png" data-width="526" data-height="272" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_DlaWO0yR3UGrxbE2roOtzg.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="38"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*DlaWO0yR3UGrxbE2roOtzg.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_DlaWO0yR3UGrxbE2roOtzg(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*DlaWO0yR3UGrxbE2roOtzg.png"></noscript></div></div></figure><p name="8346" id="8346" class="graf graf--p graf-after--figure">Notice that this algorithm is not extracting the cosine similarity per say as it’s not normalizing by the norm of each sku vector of interactions; in practice, we still need to make this normalization (this is quite simple and we’ll show you how we did it). Visually, it’s something like this:</p><figure name="9d20" id="9d20" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 667px; max-height: 220px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 33%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*2xxu6CgUdqC_pi8Sli83Hg.png" data-width="667" data-height="220" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_2xxu6CgUdqC_pi8Sli83Hg.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="22"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*2xxu6CgUdqC_pi8Sli83Hg.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_2xxu6CgUdqC_pi8Sli83Hg(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*2xxu6CgUdqC_pi8Sli83Hg.png"></noscript></div></div></figure><p name="3239" id="3239" class="graf graf--p graf-after--figure">For each customer we have this double “for” corresponding to each “ai” and “aj” where we scan through the vector emitting ai * aj.</p><p name="c2ed" id="c2ed" class="graf graf--p graf-after--p">We took this algorithm from <a href="https://stanford.edu/~rezab/papers/dimsum.pdf" data-href="https://stanford.edu/~rezab/papers/dimsum.pdf" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Reza Zadeh’s paper</a> discussing the DIMSUM implementation at Twitter (it’s quite an amazing read and if you are a Data Scientist or enjoys this area in computer science I highly recommend the read, it’s certainly worth it).</p><p name="2f99" id="2f99" class="graf graf--p graf-after--p">Well, this algorithm is called the “NaiveMapper” (for a good reason). For each row representing a customer, we make a cross-product between all items. Say, for instance, a given customer interacted with skus 0, 1 and 2; we might end up with (just an example, the numbers were written randomly):</p><p name="4faa" id="4faa" class="graf graf--p graf-after--p">[((sku0, sku0), 1),<br>&nbsp;((sku0, sku1), 2),<br>&nbsp;((sku0, sku2), 0),<br>&nbsp;((sku1, sku0), 2),<br>&nbsp;((sku1, sku1), 2),<br>&nbsp;((sku1, sku2), 1),<br>((sku2, sku0), 0),<br>((sku2, sku1), 1),<br>((sku2, sku2), 1)]</p><p name="ee90" id="ee90" class="graf graf--p graf-after--p">The step of extracting all these correlations for each customer is our mapping phase (or “<em class="markup--em markup--p-em">Shuffle Phase”</em>) whose BigO is <em class="markup--em markup--p-em">O</em>(mL²) (“L” is the maximum number of interactions a customer had in our whole training set). Well, if you are a developer you certainly already know what happens when we have <em class="markup--em markup--p-em">O</em>(n²): smooooke on the waaaaateeeer…</p><p name="cfd4" id="cfd4" class="graf graf--p graf-after--p">Not good. Not necessarily infeasible but mainly not that…cool. As in Dafiti <em class="markup--em markup--p-em">L </em>can be potentially thousands of skus and <em class="markup--em markup--p-em">m</em> is millions, you see the problem we have in hands. Well, DIMSUM is the way to break this problem into a more tractable one by implementing this new algorithm:</p><figure name="b83a" id="b83a" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 513px; max-height: 419px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 81.69999999999999%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="0*KmpoikBn3rVp-3SZ." data-width="513" data-height="419" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_KmpoikBn3rVp-3SZ" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="59"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/0*KmpoikBn3rVp-3SZ." src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_KmpoikBn3rVp-3SZ(1)"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/0*KmpoikBn3rVp-3SZ."></noscript></div></div></figure><p name="29b5" id="29b5" class="graf graf--p graf-after--figure">It’s the same idea with one smart change: now we have this scalar “γ” that works as a sampling rate for the emission of correlations in the shuffle phase. But it’s not just adding a simple scalar and “voilá”, it’s done! We need some rigorous mathematical analysis to understand what are the trade-offs of having this sampling happening!</p><p name="bc04" id="bc04" class="graf graf--p graf-after--p graf--trailing">I’ll take the time now to explain a bit further how it works but the next mini-session is totally “skip-able”.</p></div></div></section><section name="ff8f" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="dabc" id="dabc" class="graf graf--p graf--leading">(I’ll be following Rezab’s paper notation thoroughly). As we already discussed, let <strong class="markup--strong markup--p-strong">A</strong> be the matrix whose rows are customers and columns are products and values in each cell corresponds to some implicit metric of how much our customers enjoyed a given item (say each time he browsed a product we add 1 point for instance).</p><p name="f528" id="f528" class="graf graf--p graf-after--p">As previously discussed, for each row we iterate over all products interactions building combinations and emitting those values to the Reduce phase. Now that we have a sampling rate for the emission, it must follow for each intersection:</p><figure name="2199" id="2199" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 395px; max-height: 73px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 18.5%;"></div><img class="graf-image" data-image-id="1*qwP0TOf-DaoQep2AYP8T1A.png" data-width="395" data-height="73" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_qwP0TOf-DaoQep2AYP8T1A.png"></div></figure><p name="1c96" id="1c96" class="graf graf--p graf-after--figure">And:</p><figure name="55e2" id="55e2" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 245px; max-height: 58px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 23.7%;"></div><img class="graf-image" data-image-id="1*pAvtxnyipG_wQM2OVDtiYg.png" data-width="245" data-height="58" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_pAvtxnyipG_wQM2OVDtiYg.png"></div></figure><p name="f9ae" id="f9ae" class="graf graf--p graf-after--figure">The “‖ci‖” is the norm of the product vector “i”. That means that the more interactions a product has the less likely we are to emit its values; the reasoning is that we already have lots of information about it so we can afford to emit a bit less information and still converge to the real similarity value within a bounded error.</p><p name="32d2" id="32d2" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">X</strong> is a <a href="https://www.khanacademy.org/math/statistics-probability/random-variables-stats-library/random-variables-discrete/v/random-variables" data-href="https://www.khanacademy.org/math/statistics-probability/random-variables-stats-library/random-variables-discrete/v/random-variables" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">random variable</a> since it follows now a probability distribution and the final similarity score is the normalized summation of these Xs which gives us:</p><figure name="0c8b" id="0c8b" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 175px; max-height: 83px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 47.4%;"></div><img class="graf-image" data-image-id="1*YV6tWstZ9RjlL7dw1YzAVw.png" data-width="175" data-height="83" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_YV6tWstZ9RjlL7dw1YzAVw.png"></div></figure><p name="dc35" id="dc35" class="graf graf--p graf-after--figure">Ok, I confess, I just couldn’t understand where the “γ” came from; as it turns out, it’s quite simple: the similarity is the summation of the “X” normalized by the norms of each product vector (as we discussed in the beginning of this post). But given that we are emitting these values with a given probability, the expected value will be multiplied by this probability as well.</p><p name="57fc" id="57fc" class="graf graf--p graf-after--p">That means that if we do not correct for this effect, we’ll end up with something like “p * similarity” as for the final result. This being the case, we need to divide by “p” so that the expected value converges to the real value. But given our equation for probability, if we divide the cosine by “p” we cancel out the norms of the skus and the “γ” will remain in the denominator.</p><p name="262a" id="262a" class="graf graf--p graf-after--p">It’s possible to deduce the following: if γ = Ω(n/ε²) (that is, the sampling rate is proportional to the amount of products in training data divided by the squared expected relative error between true value and estimated one) then:</p><figure name="e4df" id="e4df" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 227px; max-height: 81px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><img class="graf-image" data-image-id="1*WHJ1R_QNSJcl9fdqKj4ogw.png" data-width="227" data-height="81" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_WHJ1R_QNSJcl9fdqKj4ogw.png"></div></figure><p name="f412" id="f412" class="graf graf--p graf-after--figure">With probability of at least 50%. <strong class="markup--strong markup--p-strong">B </strong>is our similarity matrix and <strong class="markup--strong markup--p-strong">D</strong> is a diagonal matrix whose each value in the diagonal is the norm a correspondent product. The deduction is somewhat extensive and we won’t go through here, still the paper has a thorough deduction of each step).</p><p name="942b" id="942b" class="graf graf--p graf-after--p">This formulation also leads us to the following: if γ ≥ α/ε for a given α ∈ ℝ¹ then:</p><figure name="e754" id="e754" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 563px; max-height: 90px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 16%;"></div><img class="graf-image" data-image-id="1*zp82Al2mGPAyTD3DrC6nxw.png" data-width="563" data-height="90" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_zp82Al2mGPAyTD3DrC6nxw.png"></div></figure><p name="5815" id="5815" class="graf graf--p graf-after--figure">And:</p><figure name="8933" id="8933" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 524px; max-height: 45px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 8.6%;"></div><img class="graf-image" data-image-id="1*emxrbsUujsFy-9fjDhLqEg.png" data-width="524" data-height="45" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_emxrbsUujsFy-9fjDhLqEg.png"></div></figure><p name="d396" id="d396" class="graf graf--p graf-after--figure">This gives us a upper and lower limit for how wrong we may end up being in our computation given the value we’ve chosen for γ. The bigger α is the lower are the chances of computed value being too far away from true value, for a given bounded error ε.</p><p name="9216" id="9216" class="graf graf--p graf-after--p">The beauty of this all: our shuffle phase ends up having <em class="markup--em markup--p-em">O</em>(nLγ/H²) where “H” is the smallest nonzero entry in <strong class="markup--strong markup--p-strong">A</strong> after we scale it to be between 0 and 1.</p><p name="ed48" id="ed48" class="graf graf--p graf-after--p">This is the reason the algorithm is called “DIMSUM” which extends for “<strong class="markup--strong markup--p-strong">Dimension Independent Matrix Square Using MapReduce</strong>”: notice that, before, this value was <em class="markup--em markup--p-em">O</em>(mL²) and now it’s completely unrelated to how many customers we have in our training data! The “m” is gone and now we basically have a linear <em class="markup--em markup--p-em">O</em> which allows us to process huge amounts of data, build our similarity matrix and have some guarantees that obtained values are converging to real values given defined boundaries.</p><p name="e5c3" id="e5c3" class="graf graf--p graf-after--p">The Reduce phase will be just a summation so the best strategy here is avoiding to emit too many values to this phase.</p><p name="c298" id="c298" class="graf graf--p graf-after--p">And that hopefully is a good enough of an introduction to how we compute these algorithms using MapReduce framework. There’s definitely some heavy mathematics behind it but still it’ll allow us to make all sorts of linear algebra operations on matrices as effectively as possible, given bounded errors we’ll be trading-off.</p><p name="b4c9" id="b4c9" class="graf graf--p graf-after--p">What changes therefore is the following: remember our previous example on the emissions for each customer? If we take the same example, now with DIMSUM we might end up with something like this:</p><p name="5f26" id="5f26" class="graf graf--p graf-after--p">[((sku0, sku0), 1),<br><br>&nbsp;((sku0, sku2), 0),<br><br><br>&nbsp;((sku1, sku2), 1),<br>((sku2, sku0), 0),<br><br>((sku2, sku2), 1)]</p><p name="5ac4" id="5ac4" class="graf graf--p graf-after--p graf--trailing">The absent values are no longer being emitted as now we have a probability of emitting each correlation.</p></div></div></section><section name="a190" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="8201" id="8201" class="graf graf--p graf--leading">When implementing the algorithm we’ll be making a small adaptation to the mapping phase, like so:</p><figure name="bca6" id="bca6" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 554px; max-height: 280px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 50.5%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*ai6VwHZrmNuSu3M4GHtf_Q.png" data-width="554" data-height="280" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_ai6VwHZrmNuSu3M4GHtf_Q.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="36"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*ai6VwHZrmNuSu3M4GHtf_Q.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_ai6VwHZrmNuSu3M4GHtf_Q(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*ai6VwHZrmNuSu3M4GHtf_Q.png"></noscript></div></div></figure><p name="0877" id="0877" class="graf graf--p graf-after--figure">Which reduces not only the emissions but also the computation required as the second “aik” is computed only if the first “aij” has been accepted in the sampling scheme.</p><p name="8aa4" id="8aa4" class="graf graf--p graf-after--p">And that’s pretty much it! We basically need to extract correlations between products for each customers but doing so in big data is unfeasible for the most part. We, therefore, use sampling techniques to bring the <em class="markup--em markup--p-em">O</em> to much lower value ranges so we can implement all sorts of linear algebra operations to data.</p><p name="45a9" id="45a9" class="graf graf--p graf-after--p">Well, we are ready to start implementing DIMSUM!</p><p name="a9fa" id="a9fa" class="graf graf--p graf-after--p">Kinda…</p><p name="1dad" id="1dad" class="graf graf--p graf-after--p">We still need data to feed the algorithm! Data is the new gold so…let’s dig for it!</p><h3 name="24a1" id="24a1" class="graf graf--h3 graf-after--p">2. Show Me The&nbsp;Data</h3><p name="ec52" id="ec52" class="graf graf--p graf-after--h3">This is what we’ll be talking about right now:</p><figure name="0ab4" id="0ab4" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 466px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 66.5%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*kaQ0VibMjNMxBCf2SghsMw.png" data-width="962" data-height="640" data-action="zoom" data-action-value="1*kaQ0VibMjNMxBCf2SghsMw.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_kaQ0VibMjNMxBCf2SghsMw.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="47"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*kaQ0VibMjNMxBCf2SghsMw.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_kaQ0VibMjNMxBCf2SghsMw(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*kaQ0VibMjNMxBCf2SghsMw.png"></noscript></div></div></figure><p name="e4eb" id="e4eb" class="graf graf--p graf-after--figure">First tools we used to come up with our Serverless implementation were AppEngine, BigQuery and Cloud Storage.</p><p name="96e3" id="96e3" class="graf graf--p graf-after--p"><a href="https://cloud.google.com/products/big-data/?hl=pt-br&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=latam-BR-all-pt-dr-bkws-all-all-trial-b-latam-1002243-LUAC0000358&amp;utm_content=text-ad-none-any-DEV_c-CRE_204833483167-ADGP_BKWS+%7C+Multi+~+Bigquery+Google-KWID_43700022301561115-kwd-302438885959-userloc_1001773&amp;utm_term=KW_%2Bbigquery%20%2Bgoogle-ST_%2Bbigquery+%2Bgoogle&amp;dclid=CL_tiJTPgNgCFQcchwodeagASQ" data-href="https://cloud.google.com/products/big-data/?hl=pt-br&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=latam-BR-all-pt-dr-bkws-all-all-trial-b-latam-1002243-LUAC0000358&amp;utm_content=text-ad-none-any-DEV_c-CRE_204833483167-ADGP_BKWS+%7C+Multi+~+Bigquery+Google-KWID_43700022301561115-kwd-302438885959-userloc_1001773&amp;utm_term=KW_%2Bbigquery%20%2Bgoogle-ST_%2Bbigquery+%2Bgoogle&amp;dclid=CL_tiJTPgNgCFQcchwodeagASQ" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">BigQuery</a> is basically a genius implementation of a new concept for a database that is designed to work with big data as easily as possible. There’s no indexes nor any infrastructure you need to take care of. You just load your data there and it just process everything you need, on-demand, on-the-fly, on-freaking-awesome.</p><p name="b2a2" id="b2a2" class="graf graf--p graf-after--p">We used BQ to transform our data from <a href="https://support.google.com/analytics/answer/3437719?hl=en" data-href="https://support.google.com/analytics/answer/3437719?hl=en" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Google Analytics</a> to a format that our algorithm in Spark could work with; as we were working with our central team at GFG, we used the same input schema as theirs for production environment. Here’s an example of the data we feed our algorithm with:</p><pre name="98b5" id="98b5" class="graf graf--pre graf-after--p">user,productSku,type<br>95106786645166913,AG672APF78UCF,1<br>8897887309145128270,FI911APF10HUZ,2<br>1153521620412862249,CO515APM42GTT,2<br>1819629928011287314,FI911SHM06PUF,1<br>1133082218947946503,JO546APM50KFT,3</pre><p name="aa28" id="aa28" class="graf graf--p graf-after--pre">Some points to make: remember from our previous discussion that we track signs from customers to implicitly infer how much a given customer enjoys a given item? So, here’s how we make it: “1” means that the customer browsed a given product; “2” the product was added to basket and finally “3”: the product was purchased.</p><p name="1dfa" id="1dfa" class="graf graf--p graf-after--p">We infer therefore that user <code class="markup--code markup--p-code">95106786645166913</code> browsed on product <code class="markup--code markup--p-code">AG672APF78UCF</code>&nbsp;, user <code class="markup--code markup--p-code">8897...</code> added <code class="markup--code markup--p-code">FI911APF10HUZ</code> to basket and so on.</p><p name="5699" id="5699" class="graf graf--p graf-after--p">For now, this is just an indication for us. A customer browsing an item does not mean at all that he or she likes it. But it’s also an implicit signal that we don’t want to get rid off; if the same customer adds the same item to basket we have something more meaningful than just “a browsing” and the same goes for purchasing. Notice that a customer buying a product still does not mean that he or she likes it. Maybe it was a gift for somebody else, maybe he returns the item later on, maybe he’s in a hurry and had to buy what he found first...this is the query we run to extract these values:</p><figure name="9859" id="9859" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 73.571%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/5939191449b11081764a98a376919be4?postId=9c9fbbdc46cc" data-media-id="5939191449b11081764a98a376919be4" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/5939191449b11081764a98a376919be4.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/5939191449b11081764a98a376919be4?postId=9c9fbbdc46cc" data-media-id="5939191449b11081764a98a376919be4" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="d5a1" id="d5a1" class="graf graf--p graf-after--figure">So far so good! But if we want a Serverless solution, we need somehow to trigger this query execution automatically, without having a machine with a cron service running.</p><p name="755f" id="755f" class="graf graf--p graf-after--p">This is where <a href="https://console.cloud.google.com/appengine?src=ac" data-href="https://console.cloud.google.com/appengine?src=ac" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">AppEngine</a> comes into play.</p><h3 name="adf2" id="adf2" class="graf graf--h3 graf-after--p">3. Bless the&nbsp;Crons</h3><p name="bdd9" id="bdd9" class="graf graf--p graf-after--h3">Google AppEngine is, in a nutshell, a <a href="http://wsgi.readthedocs.io/en/latest/what.html" data-href="http://wsgi.readthedocs.io/en/latest/what.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Serverless WSGI</a> server where you can upload routes, their associated functions and directive rules; just build the code associated to each route and deploy to GAE and it will just work: auto-scaling, traffic allocation, logging, authentication, memcache and many other features.</p><p name="2e1c" id="2e1c" class="graf graf--p graf-after--p">I’d like to right now already show you an example of one of our code deployed for managing the crons we’ll be talking soon. This is known as our <strong class="markup--strong markup--p-strong">main.py</strong> service:</p><figure name="e5d4" id="e5d4" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 59.143%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/77293472103add32d3b5cb9d76c2d2cb?postId=9c9fbbdc46cc" data-media-id="77293472103add32d3b5cb9d76c2d2cb" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/77293472103add32d3b5cb9d76c2d2cb.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/77293472103add32d3b5cb9d76c2d2cb?postId=9c9fbbdc46cc" data-media-id="77293472103add32d3b5cb9d76c2d2cb" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="3448" id="3448" class="graf graf--p graf-after--figure">Notice this is a <a href="http://flask.pocoo.org/" data-href="http://flask.pocoo.org/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Flask</a> application with one route rule specified: for requests having a URL with pattern <code class="markup--code markup--p-code">/run_job/job_name/</code> will trigger the <code class="markup--code markup--p-code">run_job()</code> function (where later on we’ll be scheduling our tasks in GCP). This is basically the code you deploy to GAE and it take care of the rest.</p><p name="4368" id="4368" class="graf graf--p graf-after--p">If you read GAE docs, you’ll notice there’s two types of environment where you can upload your code: Standard vs Flexible.</p><p name="62a3" id="62a3" class="graf graf--p graf-after--p">Main difference is: Standard runs in a <a href="https://en.wikipedia.org/wiki/Sandbox_%28software_development%29" data-href="https://en.wikipedia.org/wiki/Sandbox_(software_development)" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">sandboxed</a> environment that blocks several things such as running user C code, multi-threading/processing, writing to disk and so on. What you get in return is the possibility of scaling down to zero machines, as well as a set of tools only available in this option, such as the <a href="https://cloud.google.com/appengine/docs/standard/python/ndb/" data-href="https://cloud.google.com/appengine/docs/standard/python/ndb/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">NDB</a> library (designed by BDFL Guido Van Rossum).</p><p name="ba54" id="ba54" class="graf graf--p graf-after--p">Flexible Environment, on the other hand, receives a Docker image where you expose a port that routes traffic to an internal WSGI server (for Python, <a href="http://gunicorn.org/" data-href="http://gunicorn.org/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">gunicorn</a> is quite popular and will be used later on in this post) which guarantees you can install pretty much anything. The downside for the flexibility is that creating a new instance for the auto-scaling is more time consuming and thanks to that there’s always going to be at least one machine running all the time, i.e, you can’t scale down to zero instances in this option.</p><p name="f1cf" id="f1cf" class="graf graf--p graf-after--p">So a good rule of thumb we use is: if what we are designing will have large periods of inactivity (no requests) then we go with Standard; if more advanced coding is required (such as multiprocessing and C based processing) and is always receiving requests non-stop, go with Flexible.</p><p name="2653" id="2653" class="graf graf--p graf-after--p">Well, you might be asking: “What this all has to do with us being able to run cron jobs for the queries in BigQuery”?</p><p name="f7ac" id="f7ac" class="graf graf--p graf-after--p">No worries. Let’s talk about that!</p><p name="7606" id="7606" class="graf graf--p graf-after--p">This is what we’ll be discussing now:</p><figure name="382d" id="382d" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 493px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 70.39999999999999%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*ozaycfRcwnGjn6rSeS3Z4w.png" data-width="942" data-height="663" data-action="zoom" data-action-value="1*ozaycfRcwnGjn6rSeS3Z4w.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_ozaycfRcwnGjn6rSeS3Z4w.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="52"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*ozaycfRcwnGjn6rSeS3Z4w.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_ozaycfRcwnGjn6rSeS3Z4w(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*ozaycfRcwnGjn6rSeS3Z4w.png"></noscript></div></div></figure><p name="ce1c" id="ce1c" class="graf graf--p graf-after--figure">GAE has native support for Serverless CRON triggers. All you have to do is specifiy a URL that will receive a GET request and you just code whatever you need in that URL. You’ll have to deploy a <a href="https://cloud.google.com/appengine/docs/standard/python/config/cronref" data-href="https://cloud.google.com/appengine/docs/standard/python/config/cronref" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">cron.yaml</a> file specifying routes and rules; here’s one example from the official docs:</p><pre name="525b" id="525b" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">#cron.yaml<br>cron:<br>- description: "daily summary job"<br>  url: /tasks/summary<br>  schedule: every 24 hours</code></pre><p name="80ba" id="80ba" class="graf graf--p graf-after--pre">This means every 24 hours a GET request will be issued to the URL <code class="markup--code markup--p-code">/tasks/summary.</code></p><p name="d51c" id="d51c" class="graf graf--p graf-after--p">There’s one important requirement in GAE: requests must be completed within a 60 seconds time frame as otherwise you’ll have to schedule the operation to join a <a href="https://cloud.google.com/appengine/docs/standard/python/taskqueue/" data-href="https://cloud.google.com/appengine/docs/standard/python/taskqueue/" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">queue</a> and the task will be processed as a background one, outside of the input request.</p><p name="1841" id="1841" class="graf graf--p graf-after--p">We want our cron to run a query in BigQuery and then export results to GCS; this can potentially take more than 60s so we created a <a href="https://cloud.google.com/appengine/docs/standard/python/taskqueue/" data-href="https://cloud.google.com/appengine/docs/standard/python/taskqueue/" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">scheduler</a> for the cron to initiate when the specified time trigger occurs.</p><p name="35e8" id="35e8" class="graf graf--p graf-after--p">Basically, what happens then is: our cron issues a GET to our main router which in turn adds a task to our scheduler defined by (we used the concept of <a href="https://cloud.google.com/appengine/docs/standard/python/taskqueue/push/" data-href="https://cloud.google.com/appengine/docs/standard/python/taskqueue/push/" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">push queues</a> in this case):</p><figure name="656c" id="656c" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 162%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/057ee9eede8cb7171934ef446000f98c?postId=9c9fbbdc46cc" data-media-id="057ee9eede8cb7171934ef446000f98c" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/057ee9eede8cb7171934ef446000f98c.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/057ee9eede8cb7171934ef446000f98c?postId=9c9fbbdc46cc" data-media-id="057ee9eede8cb7171934ef446000f98c" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="56f9" id="56f9" class="graf graf--p graf-after--figure">So far we have: a cron that issues a GET request to <code class="markup--code markup--p-code">/run_job/job_name</code> which in turn adds to our task queue a job associated to URL <code class="markup--code markup--p-code">/export_customers</code> which in turn runs our query and extraction operations. Gosh that is confusing! Maybe a picture helps a bit here:</p><figure name="1928" id="1928" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 310px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 44.2%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*GkowJRk8EaIsFu80sqVdiA.png" data-width="988" data-height="437" data-action="zoom" data-action-value="1*GkowJRk8EaIsFu80sqVdiA.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_GkowJRk8EaIsFu80sqVdiA.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="31"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*GkowJRk8EaIsFu80sqVdiA.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_GkowJRk8EaIsFu80sqVdiA(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*GkowJRk8EaIsFu80sqVdiA.png"></noscript></div></div></figure><p name="ca26" id="ca26" class="graf graf--p graf-after--figure">Our main service is defined by this <a href="https://cloud.google.com/appengine/docs/standard/python/config/appref" data-href="https://cloud.google.com/appengine/docs/standard/python/config/appref" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">yaml</a> file:</p><figure name="a408" id="a408" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/06e7c2f42773cbaa44ec579ac4a312e6?postId=9c9fbbdc46cc" data-media-id="06e7c2f42773cbaa44ec579ac4a312e6" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/06e7c2f42773cbaa44ec579ac4a312e6.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/06e7c2f42773cbaa44ec579ac4a312e6?postId=9c9fbbdc46cc" data-media-id="06e7c2f42773cbaa44ec579ac4a312e6" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="b7a9" id="b7a9" class="graf graf--p graf-after--figure">This is where our discussion about Standard vs Flexible comes into play: we don’t need those machines up and running all the time. Only when they are processing the scheduled tasks; if we don’t specify an environment in this ymal file, then standard is deployed by default.</p><p name="f5d0" id="f5d0" class="graf graf--p graf-after--p">So now we can setup a cron that looks for the service “dataproc-twitter” and find in the handlers definition where to redirect the request, that is, the application called “app” inside the file called “main.py”. This is our yaml definition for the workers that will run our scheduled processes in background:</p><figure name="0243" id="0243" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 43.571%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/be3e8af4e3068dd8d7bf596f389f6adf?postId=9c9fbbdc46cc" data-media-id="be3e8af4e3068dd8d7bf596f389f6adf" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/be3e8af4e3068dd8d7bf596f389f6adf.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/be3e8af4e3068dd8d7bf596f389f6adf?postId=9c9fbbdc46cc" data-media-id="be3e8af4e3068dd8d7bf596f389f6adf" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="07c4" id="07c4" class="graf graf--p graf-after--figure">We also need to define a rate at which our <a href="https://cloud.google.com/appengine/docs/standard/python/config/queueref" data-href="https://cloud.google.com/appengine/docs/standard/python/config/queueref" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">queue</a> will be processed. This is simple, for our project we did it like:</p><figure name="e301" id="e301" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 15.429%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/4b69fdf2c29c5c0c4e4fa1c041caaffb?postId=9c9fbbdc46cc" data-media-id="4b69fdf2c29c5c0c4e4fa1c041caaffb" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/4b69fdf2c29c5c0c4e4fa1c041caaffb.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/4b69fdf2c29c5c0c4e4fa1c041caaffb?postId=9c9fbbdc46cc" data-media-id="4b69fdf2c29c5c0c4e4fa1c041caaffb" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="d64d" id="d64d" class="graf graf--p graf-after--figure">And finally, our cron:</p><figure name="d3b4" id="d3b4" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 36.143%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/84aa383c747ec5abcf88d2d309808340?postId=9c9fbbdc46cc" data-media-id="84aa383c747ec5abcf88d2d309808340" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/84aa383c747ec5abcf88d2d309808340.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/84aa383c747ec5abcf88d2d309808340?postId=9c9fbbdc46cc" data-media-id="84aa383c747ec5abcf88d2d309808340" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="b6e9" id="b6e9" class="graf graf--p graf-after--figure">Deploying to GAE is quite simple; <a href="https://cloud.google.com/sdk/downloads" data-href="https://cloud.google.com/sdk/downloads" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">gcloud</a> is required to be installed, after that, we just run:</p><p name="693d" id="693d" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">gcloud app deploy main.yaml worker.yaml</code></p><p name="9017" id="9017" class="graf graf--p graf-after--p">And that’s it. The other deploys goes like:</p><pre name="ba4f" id="ba4f" class="graf graf--pre graf-after--p">gcloud app deploy queue.yaml<br>gcloud app deploy cron.yaml</pre><p name="f47c" id="f47c" class="graf graf--p graf-after--pre">In GCP dashboard there’s an update to everything that is happening:</p><figure name="f1ac" id="f1ac" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 253px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 36.199999999999996%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*3wKrr10BTkooWcfhNJzQ_A.png" data-width="1436" data-height="520" data-action="zoom" data-action-value="1*3wKrr10BTkooWcfhNJzQ_A.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_3wKrr10BTkooWcfhNJzQ_A.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="25"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*3wKrr10BTkooWcfhNJzQ_A.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_3wKrr10BTkooWcfhNJzQ_A(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*3wKrr10BTkooWcfhNJzQ_A.png"></noscript></div></div></figure><p name="531f" id="531f" class="graf graf--p graf-after--figure">As well as information about the crons that we just installed:</p><figure name="293f" id="293f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 245px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*isXpb_KmM2rfSDKW1jqrYQ.png" data-width="1438" data-height="503" data-action="zoom" data-action-value="1*isXpb_KmM2rfSDKW1jqrYQ.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_isXpb_KmM2rfSDKW1jqrYQ.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="25"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*isXpb_KmM2rfSDKW1jqrYQ.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_isXpb_KmM2rfSDKW1jqrYQ(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*isXpb_KmM2rfSDKW1jqrYQ.png"></noscript></div></div></figure><p name="a84a" id="a84a" class="graf graf--p graf-after--figure">(The cron “run_dimsum” will be explained later).</p><p name="88c2" id="88c2" class="graf graf--p graf-after--p">Well, now we already know how to run Serverless cron jobs in GCP. Let’s go to the Spark implementation then!</p><h3 name="d863" id="d863" class="graf graf--h3 graf-after--p">4. Dataproc PySpark To&nbsp;Heaven</h3><p name="2f3d" id="2f3d" class="graf graf--p graf-after--h3">In a nutshell, Dataproc is a Google fully managed cluster that already have Spark builtin ready to go. You basically specify how many workers you want and pretty much it, hit the play and wait a few minutes for the cluster to be created.</p><p name="2a4c" id="2a4c" class="graf graf--p graf-after--p">Well, as previously discussed, we aimed to implement the DIMSUM algorithm in Spark. First thing we created was a cron based trigger that when initiated builds a whole cluster for us, process the Spark job and when it’s over, deletes the cluster. Why is that? So costs plummet. We literally pay for what we use and nothing more.</p><p name="e30f" id="e30f" class="graf graf--p graf-after--p">So, let’s do it! Here’s what we’ll be discussing now:</p><figure name="abb5" id="abb5" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 437px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 62.4%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*Xt7QO2Bo3mzaEJC_14HImg.png" data-width="983" data-height="613" data-action="zoom" data-action-value="1*Xt7QO2Bo3mzaEJC_14HImg.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_Xt7QO2Bo3mzaEJC_14HImg.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="45"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*Xt7QO2Bo3mzaEJC_14HImg.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_Xt7QO2Bo3mzaEJC_14HImg(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*Xt7QO2Bo3mzaEJC_14HImg.png"></noscript></div></div></figure><p name="9527" id="9527" class="graf graf--p graf-after--figure">We already have our cron job receiver as well as the scheduler worker. This is the <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/worker.py" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/worker.py" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">code</a> we used to run all these operations:</p><figure name="940a" id="940a" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 49.714%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/272752c91dd81b49df345268c1215c80?postId=9c9fbbdc46cc" data-media-id="272752c91dd81b49df345268c1215c80" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/272752c91dd81b49df345268c1215c80.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/272752c91dd81b49df345268c1215c80?postId=9c9fbbdc46cc" data-media-id="272752c91dd81b49df345268c1215c80" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="5f91" id="5f91" class="graf graf--p graf-after--figure">What is happening here is: first our cron job will send a GET request to the URL <code class="markup--code markup--p-code">/run_job/run_dimsum/.</code> This in turn will schedule a task that is triggered by the URL <code class="markup--code markup--p-code">/dataproc_dimsum</code> which runs the function <code class="markup--code markup--p-code">dataproc_dimsum().</code></p><p name="101e" id="101e" class="graf graf--p graf-after--p">What this function does is:</p><ol class="postList"><li name="8221" id="8221" class="graf graf--li graf-after--p">Creates Spark cluster</li><li name="96b7" id="96b7" class="graf graf--li graf-after--li">Uploads the PySpark files required to run the jobs to GCS</li><li name="a0ea" id="a0ea" class="graf graf--li graf-after--li">Runs the PySpark job</li><li name="0c5f" id="0c5f" class="graf graf--li graf-after--li">Deletes the cluster</li><li name="b2f7" id="b2f7" class="graf graf--li graf-after--li">Schedule a task to start the Dataflow extraction from GCS to Datastore.</li></ol><p name="3baf" id="3baf" class="graf graf--p graf-after--li">With this in mind, we can dive into understanding the PySpark jobs.</p><h4 name="2595" id="2595" class="graf graf--h4 graf-after--p">4.1 PySpark</h4><p name="0617" id="0617" class="graf graf--p graf-after--h4">Here’s how we like to work with Dataproc. First we usually create a very small cluster with <code class="markup--code markup--p-code">n1-standard-1</code> machines with <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/create_cluster.sh" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/create_cluster.sh" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">this script</a> and run it like</p><p name="dc1a" id="dc1a" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">./create_cluster -n=cluster_name -b=bucket_name</code></p><p name="3b34" id="3b34" class="graf graf--p graf-after--p">Important catch here: if you pay close attention the the <code class="markup--code markup--p-code">gcloud</code> command, you’ll see that there’s a <code class="markup--code markup--p-code">jupyter.sh</code>initialization-action. What this does is prepare our cluster with a J<a href="http://jupyter.org/" data-href="http://jupyter.org/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">upyter-notebook</a> service ready to use to which we create a ssh tunnel (you can see how we do that in this <a href="https://github.com/WillianFuks/example_dataproc_twitter/tree/master/dataproc/bin" data-href="https://github.com/WillianFuks/example_dataproc_twitter/tree/master/dataproc/bin" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">folder</a> in files <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/utils.sh" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/utils.sh" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">utils.sh</a> and <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/launch_jupyter.sh" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/launch_jupyter.sh" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">launch_jupyter.sh</a>).</p><p name="87a5" id="87a5" class="graf graf--p graf-after--p"><a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/notebooks/df_naive.ipynb" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/notebooks/df_naive.ipynb" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">This is an example</a> of how our Notebook looked like when we completed the implementation:</p><figure name="28c3" id="28c3" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 557px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 79.5%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*gHMoqb5jS4QUQzTdmRe_xA.png" data-width="997" data-height="793" data-action="zoom" data-action-value="1*gHMoqb5jS4QUQzTdmRe_xA.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_gHMoqb5jS4QUQzTdmRe_xA.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="59"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*gHMoqb5jS4QUQzTdmRe_xA.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_gHMoqb5jS4QUQzTdmRe_xA(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*gHMoqb5jS4QUQzTdmRe_xA.png"></noscript></div></div></figure><p name="97df" id="97df" class="graf graf--p graf-after--figure">On the main repository used as basis for this post you can see in folder “dataproc” the folder “notebooks”. The cool thing about those is that you can see how helpful this tool can be when working with PySpark. I literally open up a pyspark-notebook and start testing everything possible: all testings, questions, observations, all at once one after the other.</p><p name="710c" id="710c" class="graf graf--p graf-after--p">This ends up being a huge time savior when developing as you test on the-fly quite easily and fast. If you check my notebooks you’ll see that I don’t even follow the lines, I start at one line, then I jump over to the bottom, then I come back to the beginning. It doesn’t really matter, what does matter is testing quickly, prototyping as fast as possible and then building the final code accordingly (still notice that all of our jobs are unit tested so we have some guarantees the code is working).</p><p name="81a9" id="81a9" class="graf graf--p graf-after--p">With that in mind, here’s how we approached the job development for our DIMSUM algorithm. First, we created a <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/jobs/base.py" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/jobs/base.py" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">base</a> file with general helper functions; here’s part of it:</p><figure name="a919" id="a919" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 133.857%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/de31d3c75aea617feb29daaa2d0c25fd?postId=9c9fbbdc46cc" data-media-id="de31d3c75aea617feb29daaa2d0c25fd" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/de31d3c75aea617feb29daaa2d0c25fd.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/de31d3c75aea617feb29daaa2d0c25fd?postId=9c9fbbdc46cc" data-media-id="de31d3c75aea617feb29daaa2d0c25fd" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="b559" id="b559" class="graf graf--p graf-after--figure">When working with Spark you usually start by creating a <code class="markup--code markup--p-code">SparkContext</code> which sets general guidelines about how Spark should run the jobs. Notice in the method <code class="markup--code markup--p-code">process_day_input</code> the MapReduce operations happening; first, we read from <code class="markup--code markup--p-code">textFile</code> source and then a set of map and reduce operations follows.</p><p name="887d" id="887d" class="graf graf--p graf-after--p">Remember that we mapped our customers behavior to “1” for browsing a given sku, “2” for when it was added to basket and “3” for when purchased happened? Well, here we transform those numbers into a final score that indicate to us implicitly how much a given customer is likely to enjoy a given item.</p><p name="49c1" id="49c1" class="graf graf--p graf-after--p">To do so, we make this mapping: <code class="markup--code markup--p-code">{"browsed": 0.5, "basket": 2., "purchase: 6.}</code> (in production at Dafiti we have different values which are obtained through <a href="https://en.wikipedia.org/wiki/Bayesian_optimization" data-href="https://en.wikipedia.org/wiki/Bayesian_optimization" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">Bayesian Black-Box Optimization</a>; as discussing these is not the main focus of this post, we’ll probably do that on another opportunity).</p><p name="b85c" id="b85c" class="graf graf--p graf-after--p">Each time a customer browses an item we add up 0.5 points; if it’s added to basket then 2 points and 6 points if purchased. This is a sample of the output we get:</p><figure name="c656" id="c656" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 328px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 46.9%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*JdwWlzDVUN2oWwwA2R32lg.png" data-width="1236" data-height="580" data-action="zoom" data-action-value="1*JdwWlzDVUN2oWwwA2R32lg.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_JdwWlzDVUN2oWwwA2R32lg.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="34"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*JdwWlzDVUN2oWwwA2R32lg.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_JdwWlzDVUN2oWwwA2R32lg(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*JdwWlzDVUN2oWwwA2R32lg.png"></noscript></div></div></figure><pre name="d33c" id="d33c" class="graf graf--pre graf-after--figure">{“user”:”8291743389332496534",”interactions”:[{“item”:”RE499APM08ZTZ”,”score”:0.5},{“item”:”RE499APM85DGC”,”score”:0.5}]}</pre><pre name="bca5" id="bca5" class="graf graf--pre graf-after--pre">{“user”:”5843584611541988560",”interactions”:[{“item”:”SA232SHF47ZZO”,”score”:0.5},{“item”:”SA232SHF89GXI”,”score”:1.0}]}</pre><pre name="dc08" id="dc08" class="graf graf--pre graf-after--pre">{“user”:”6935962925703084781",”interactions”:[{“item”:”DE996ACF83KYE”,”score”:0.5},{“item”:”CR177ACF76BIH”,”score”:0.5},{“item”:”MA318ACF62LRP”,”score”:0.5},{“item”:”DE996ACF23CIQ”,”score”:0.5},{“item”:”QU097ACF76IKL”,”score”:0.5},{“item”:”QU097ACF44IPN”,”score”:0.5},{“item”:”QU097ACF77IOG”,”score”:0.5},{“item”:”DE996ACF50CHP”,”score”:1.5}]}</pre><p name="9dc2" id="9dc2" class="graf graf--p graf-after--pre">With this process complete, we are ready to finally run the <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/jobs/dimsum.py" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/jobs/dimsum.py" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">DIMSUM</a> implementation:</p><figure name="383f" id="383f" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 202.429%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/b15466d4187297193ead7e12440b0e5c?postId=9c9fbbdc46cc" data-media-id="b15466d4187297193ead7e12440b0e5c" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/b15466d4187297193ead7e12440b0e5c.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/b15466d4187297193ead7e12440b0e5c?postId=9c9fbbdc46cc" data-media-id="b15466d4187297193ead7e12440b0e5c" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="766d" id="766d" class="graf graf--p graf-after--figure">This script basically scans through all the intermediary data we computed in the previous step aggregating all customers interactions into a single row (this is our matrix <strong class="markup--strong markup--p-strong">A</strong> we discussed in the beginning) and then executes the <code class="markup--code markup--p-code">run_DIMSUM</code> method. Notice first the broadcasting of <code class="markup--code markup--p-code">pq.</code> This is a computation for the probability of each product and their normalizing factor for the emission of the correlation (ai * bi). When we broadcast something in Spark, the object is serialized and spread over the net of workers so they have in their memory direct access to the object; we broadcast a dictionary with information of each sku to improve performance.</p><p name="8cb0" id="8cb0" class="graf graf--p graf-after--p">Notice the DIMSUM script basically loops through all interactions of our customers and emits the correlation when the probability of doing so outperforms the generation of a random number (the idea is trowing a dice and seeing whether to release the number or not).</p><p name="4192" id="4192" class="graf graf--p graf-after--p">And that’s basically all there’s to it. Despite of all the complicated equations, the final implementation ends up being quite simple. After that, result is uploaded to GCS; a quick sample:</p><figure name="c2b9" id="c2b9" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 327px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 46.7%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*LtnsrttNWjWLaGiWbmLAsw.png" data-width="1266" data-height="591" data-action="zoom" data-action-value="1*LtnsrttNWjWLaGiWbmLAsw.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_LtnsrttNWjWLaGiWbmLAsw.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="34"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*LtnsrttNWjWLaGiWbmLAsw.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_LtnsrttNWjWLaGiWbmLAsw(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*LtnsrttNWjWLaGiWbmLAsw.png"></noscript></div></div></figure><pre name="42f8" id="42f8" class="graf graf--pre graf-after--figure">{“item”:”LO611APF49EBY”,”similarity_items”:<br>    [{“item”:”DI944APF23XPS”,”similarity”:0.017922988},<br>     {“item”:”ME700ACF75HAQ”,”similarity”:0.035410713},<br>     {“item”:”LO611APF47ECA”,”similarity”:0.1254363},<br>     {“item”:”TR943APF03NGY”,”similarity”:0.024296477},<br>     {“item”:”CA700APF63DSU”,”similarity”:0.044455424},<br>     {“item”:”LO611APF43ECE”,”similarity”:0.33709994},<br>     {“item”:”LO611APF41ECG”,”similarity”:0.07137738},<br>     {“item”:”LO611APF80EAT”,”similarity”:0.02228836},<br>     {“item”:”LO611APF84EAP”,”similarity”:0.03180418},<br>     {“item”:”DE234APF58ION”,”similarity”:0.013907681}]}</pre><p name="3b95" id="3b95" class="graf graf--p graf-after--pre">Notice here we don’t sort the result by the similarity metric. This is done in our Dataflow pipeline, speaking of which…</p><h3 name="a50a" id="a50a" class="graf graf--h3 graf-after--p">5. Gotta Beam`em&nbsp;All!</h3><p name="0c3e" id="0c3e" class="graf graf--p graf-after--h3">Just after results are saved to GCS, a new task is scheduled to retrieve this data to Datastore. This is what we’ll be talking about now:</p><figure name="a5c9" id="a5c9" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 439px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 62.7%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*qVCCSiuqx8CswmLG-ckf8Q.png" data-width="973" data-height="610" data-action="zoom" data-action-value="1*qVCCSiuqx8CswmLG-ckf8Q.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_qVCCSiuqx8CswmLG-ckf8Q.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="45"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*qVCCSiuqx8CswmLG-ckf8Q.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_qVCCSiuqx8CswmLG-ckf8Q(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*qVCCSiuqx8CswmLG-ckf8Q.png"></noscript></div></div></figure><p name="b020" id="b020" class="graf graf--p graf-after--figure"><a href="https://cloud.google.com/datastore/" data-href="https://cloud.google.com/datastore/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Datastore</a> is a NoSQL database from Google and it has direct integration with AppEngine which makes things 100x easier and faster. What we want to do now is to upload results there in a key-value fashion so that when a request to our system arrives asking “What should I recommend to a customer that likes this red shoes?” our system can query over Datastore and retrieve all the similarities required to come up with an answer.</p><p name="ea8b" id="ea8b" class="graf graf--p graf-after--p">There’s one problem though: how to save results from GCS to Datastore?</p><p name="e17c" id="e17c" class="graf graf--p graf-after--p">That’s where <a href="https://cloud.google.com/dataflow/" data-href="https://cloud.google.com/dataflow/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Dataflow</a> comes into play! Dataflow is a Serverless framework ready to compute general ETL tasks by running a unified model for data processing (which means that it has the concept of an “engine” or “runner” and you can choose which engine to run: Dataflow, Apache Spark, Flink and any other tool that follows the unified model).</p><p name="1bdb" id="1bdb" class="graf graf--p graf-after--p"><a href="https://beam.apache.org/" data-href="https://beam.apache.org/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Apache Beam</a> is the tool required to create the pipeline operations. It’s an open source project and currently has support for Java and Python SDKs (even though unfortunately the Python implementation has been lagging behind Java’s, it still already offers lots of features).</p><p name="649f" id="649f" class="graf graf--p graf-after--p">Well, what we have to do now is implement a pipeline process that reads the results of DIMSUM saved in GCS, process it accordingly and saves results to Datastore. Here’s our pipeline <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataflow/build_datastore_template.py" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataflow/build_datastore_template.py" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">implementation</a>:</p><figure name="0ac1" id="0ac1" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 255.429%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/530f8682efab6a1fce9049a84d32564b?postId=9c9fbbdc46cc" data-media-id="530f8682efab6a1fce9049a84d32564b" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/530f8682efab6a1fce9049a84d32564b.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/530f8682efab6a1fce9049a84d32564b?postId=9c9fbbdc46cc" data-media-id="530f8682efab6a1fce9049a84d32564b" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="f28a" id="f28a" class="graf graf--p graf-after--figure">Here we used the concept of <a href="https://cloud.google.com/dataflow/docs/templates/overview" data-href="https://cloud.google.com/dataflow/docs/templates/overview" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">templated Dataflow</a>: basically all it does is create the necessary code and json metadata exporting it to a location path in GCS; the advantage is that any other client at any other time can run the template just by issuing a HTTP request pointing to the template location. That means that it’s not necessary to re-compile the code or to have the whole environment setup. This is quite valuable for us as we are working in Standard GAE (remember everything so far has been activated by crons) and the sandboxed environment would not allow us to run a beam pipeline there.</p><p name="cea2" id="cea2" class="graf graf--p graf-after--p">With the templates it really doesn’t matter what environment and restrictions we may have, we just issue a GET request to the job execution and it happens automatically; here’s an example of our processed pipeline.</p><figure name="9592" id="9592" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 316px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45.2%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*BpbzdI3GWL-gZjBG1AHOqw.png" data-width="1324" data-height="598" data-action="zoom" data-action-value="1*BpbzdI3GWL-gZjBG1AHOqw.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_BpbzdI3GWL-gZjBG1AHOqw.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="31"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*BpbzdI3GWL-gZjBG1AHOqw.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_BpbzdI3GWL-gZjBG1AHOqw(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*BpbzdI3GWL-gZjBG1AHOqw.png"></noscript></div></div></figure><p name="7fed" id="7fed" class="graf graf--p graf-after--figure">Cool thing to notice: we setup our pipeline execution to have at maximum 2 workers; Dataflow knows automatically when to spawn more workers so to optimize total costs in a viable time frame.</p><p name="029d" id="029d" class="graf graf--p graf-after--p">One thing you may notice though is the quite long time consumed when writing our entities to Datastore. I’m not sure why this is happening and luckily this is not a problem for us as this process runs at night, but I’d expect the writing step to be way faster than it currently is (if you know how to improve performance please let us know&nbsp;:)!). Maybe there’s some optimization step that we missed but as our deadline to deliver the product was reaching its end this is how we delivered the product so far.</p><p name="36a2" id="36a2" class="graf graf--p graf-after--p">With our data being ready to go, it’s time to serve the recommendations. We’re getting there!</p><h3 name="3ed6" id="3ed6" class="graf graf--h3 graf-after--p">Madame, Monsieur, ceci est pour&nbsp;vous.</h3><p name="7e46" id="7e46" class="graf graf--p graf-after--h3">(I don’t speak French so I just hope the Translator got it right) Here’s what we’ll be discussing now:</p><figure name="c116" id="c116" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 469px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 67%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*fWF2_NI0X-g2rw2LmaDqFQ.png" data-width="959" data-height="643" data-action="zoom" data-action-value="1*fWF2_NI0X-g2rw2LmaDqFQ.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_fWF2_NI0X-g2rw2LmaDqFQ.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="50"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*fWF2_NI0X-g2rw2LmaDqFQ.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_fWF2_NI0X-g2rw2LmaDqFQ(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*fWF2_NI0X-g2rw2LmaDqFQ.png"></noscript></div></div></figure><p name="8570" id="8570" class="graf graf--p graf-after--figure">So, let us recommend!</p><p name="0af2" id="0af2" class="graf graf--p graf-after--p">Remember from our introduction that this is how we compute the final recommendations:</p><figure name="0602" id="0602" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 307px; max-height: 104px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 33.900000000000006%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*jAXRKAqL8RGlF2fcxf61iQ.png" data-width="307" data-height="104" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_jAXRKAqL8RGlF2fcxf61iQ.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="25"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*jAXRKAqL8RGlF2fcxf61iQ.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_jAXRKAqL8RGlF2fcxf61iQ(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*jAXRKAqL8RGlF2fcxf61iQ.png"></noscript></div></div></figure><p name="e3c5" id="e3c5" class="graf graf--p graf-after--figure">In practice, we don’t make the normalization (the similarities summation in the denominator) as this is suggested by the literature.</p><p name="9e0f" id="9e0f" class="graf graf--p graf-after--p">This means that we can take all interactions customers had with items, come up with an implicit score metric “r” and multiply similarities between items and those scores to predict how much a given customer will enjoy a given product we may recommend. Seeing the code might make this easier to visualize. This is our first <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/main.py" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/main.py" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">implementation</a> to accomplish that:</p><figure name="80c5" id="80c5" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/4b77aa2e07024e9b498e34b0c054fb6d?postId=9c9fbbdc46cc" data-media-id="4b77aa2e07024e9b498e34b0c054fb6d" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/4b77aa2e07024e9b498e34b0c054fb6d.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/4b77aa2e07024e9b498e34b0c054fb6d?postId=9c9fbbdc46cc" data-media-id="4b77aa2e07024e9b498e34b0c054fb6d" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="f96c" id="f96c" class="graf graf--p graf-after--figure">And <code class="markup--code markup--p-code">process_recommendations</code> is given by:</p><figure name="1e95" id="1e95" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24.857%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/8a0a8fa385bc5cf4eb1a73b3c3409b9e?postId=9c9fbbdc46cc" data-media-id="8a0a8fa385bc5cf4eb1a73b3c3409b9e" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/8a0a8fa385bc5cf4eb1a73b3c3409b9e.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/8a0a8fa385bc5cf4eb1a73b3c3409b9e?postId=9c9fbbdc46cc" data-media-id="8a0a8fa385bc5cf4eb1a73b3c3409b9e" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="a31b" id="a31b" class="graf graf--p graf-after--figure">This is how it works: we receive input requests like this:</p><pre name="7b48" id="7b48" class="graf graf--pre graf-after--p">/make_recommendation?browsed=CA278SHF46UJH</pre><p name="6e9d" id="6e9d" class="graf graf--p graf-after--pre">Which means: “I have a customer who browsed on item CA278SHF46UJH, what are your recommendations here?”</p><p name="38f2" id="38f2" class="graf graf--p graf-after--p">And then we implement the equation by looping through all similarities that CA278SHF46UJH had as output from DIMSUM and order from best to worst and select only top “n”.</p><p name="8336" id="8336" class="graf graf--p graf-after--p">All this said, this is what we got:</p><figure name="8283" id="8283" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 394px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*0ZKRj66FAYCOW3s__-GWdw.png" data-width="1727" data-height="973" data-action="zoom" data-action-value="1*0ZKRj66FAYCOW3s__-GWdw.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_0ZKRj66FAYCOW3s__-GWdw.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="40"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*0ZKRj66FAYCOW3s__-GWdw.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_0ZKRj66FAYCOW3s__-GWdw(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*0ZKRj66FAYCOW3s__-GWdw.png"></noscript></div></div></figure><p name="719c" id="719c" class="graf graf--p graf-after--figure">Yeap, that’s right. A bizarre disaster...it took almost 1 entire second to process the recommendations. And from that 1s, <strong class="markup--strong markup--p-strong">800ms in just one single method!</strong> <code class="markup--code markup--p-code">process_recommendations</code> here ended up being a disaster.</p><p name="9e36" id="9e36" class="graf graf--p graf-after--p">Don’t get me wrong, this is a big failure. If you develop a recommender system that takes 1s to respond you won’t be attracting that many customers nor making them happy by waiting; this is ugly and ineffective.</p><p name="d8f6" id="d8f6" class="graf graf--p graf-after--p">Well, that would mean that all of our endeavor so far has failed greatly. But we had still one last trick up our sleeve: we’ve been using Standard environment all this time due its simplicity and capacity to scale down to zero instances if so required to. But this time, the sandboxed feature has been probably hurting more than helping and reality is a recommender system very likely will always be receiving requests; this is the case for Dafiti and many of our ventures so it doesn’t make much sense to keep using Standard.</p><p name="18da" id="18da" class="graf graf--p graf-after--p">Our time was short so we quickly migrated environments and started using Flexible Environment with another big trick being played: we decided to <a href="http://cython.readthedocs.io/en/latest/" data-href="http://cython.readthedocs.io/en/latest/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">cythonize</a> the <code class="markup--code markup--p-code">process_recommendation</code> operation.</p><p name="63d1" id="63d1" class="graf graf--p graf-after--p">Well, this is the beauty of Python: <em class="markup--em markup--p-em">“premature optimization is the source of all evil”</em>. This is a fundamental truth in code development. Python served us greatly so far and it made us as productive as possible. But in this particular method, it certainly didn’t do a very good job so a workaround for that is to use Cython to get some performances boosts; Cython is basically a language that is capable of mixing Python and C/C++.</p><p name="e2ac" id="e2ac" class="graf graf--p graf-after--p">The advantage here is, for the most part, that Python treats every single object as…well, an object. That means that the concept of “int” does not quite exist in Python. In practice, ints are encapsulated by an object that contains an int. This is amazing and bad, just depends on how you look at it (or rather how you use it). This gives Python all the flexibility it has and all the coding implementation speed it offers but the trade-off is performance. What we can do in Cython though is to remove those questions that Python has to make on each object like “ok object, what are you?” and we can just say beforehand: “This is an array of ints, you don’t have to ask what those are anymore”.</p><p name="62d3" id="62d3" class="graf graf--p graf-after--p"><a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/cythonized/c_funcs.pyx" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/cythonized/c_funcs.pyx" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">That’s what we implemented</a> in Cython:</p><figure name="8744" id="8744" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 65.286%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/56066ba7f262da56e93bb4d9c9a55d29?postId=9c9fbbdc46cc" data-media-id="56066ba7f262da56e93bb4d9c9a55d29" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/56066ba7f262da56e93bb4d9c9a55d29.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/56066ba7f262da56e93bb4d9c9a55d29?postId=9c9fbbdc46cc" data-media-id="56066ba7f262da56e93bb4d9c9a55d29" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="ac76" id="ac76" class="graf graf--p graf-after--figure">Here’s a Cython profiling on requests done to the Python-API:</p><figure name="18be" id="18be" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 311px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 44.5%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="0*K-DSPrpBE8nhS5KC.png" data-width="1272" data-height="566" data-action="zoom" data-action-value="0*K-DSPrpBE8nhS5KC.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_K-DSPrpBE8nhS5KC.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="31"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/0*K-DSPrpBE8nhS5KC.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_K-DSPrpBE8nhS5KC(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/0*K-DSPrpBE8nhS5KC.png"></noscript></div></div></figure><p name="e86d" id="e86d" class="graf graf--p graf-after--figure">Well….kinda….ok.</p><p name="9788" id="9788" class="graf graf--p graf-after--p">This code already made our processing <strong class="markup--strong markup--p-strong">7x</strong> faster on our local computer. That’s quite cool! But notice in the profiling the yellow lines: the stronger it gets the more requests to the Python-API is made. As our input is a list of dicts, Cython cannot convert it directly to any C structure. This means that those objects are still treated like so in Cython and we don’t get as much of a performance gain as it would be possible had those conversions being successfully made.</p><p name="2655" id="2655" class="graf graf--p graf-after--p">Still, no worries. We created then a separate <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/recommender.py" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/recommender.py" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">service</a> for the recommendations, this time in flexible environment:</p><figure name="9fbf" id="9fbf" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 115.143%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/resize" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/b4f5c39fe7488bfad36775680c4f074b?postId=9c9fbbdc46cc" data-media-id="b4f5c39fe7488bfad36775680c4f074b" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/b4f5c39fe7488bfad36775680c4f074b.html"></iframe></div><noscript class="js-progressiveMedia-inner"><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/b4f5c39fe7488bfad36775680c4f074b?postId=9c9fbbdc46cc" data-media-id="b4f5c39fe7488bfad36775680c4f074b" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&amp;key=a19fcc184b9711e1b4764040d3dc5c07" allowfullscreen frameborder="0"></IFRAME></div></noscript></div></div></figure><p name="820f" id="820f" class="graf graf--p graf-after--figure">Notice the <code class="markup--code markup--p-code">cy_process_recommendations.</code> This is where our call to the Cython script is being made.</p><p name="42d2" id="42d2" class="graf graf--p graf-after--p">Deploying to flexible in our case is just as simple as standard. We have our <a href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/requirements.txt" data-href="https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/requirements.txt" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">requirements.txt</a> file already defined so we just run:</p><p name="130a" id="130a" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">gcloud app deploy recommender.yaml</code></p><p name="7dea" id="7dea" class="graf graf--p graf-after--p">And now, these are the new results:</p><figure name="1cfd" id="1cfd" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 318px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45.4%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*-MGOInJWav8fz4fo7aNj0Q.png" data-width="1726" data-height="784" data-action="zoom" data-action-value="1*-MGOInJWav8fz4fo7aNj0Q.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_-MGOInJWav8fz4fo7aNj0Q.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="31"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*-MGOInJWav8fz4fo7aNj0Q.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_-MGOInJWav8fz4fo7aNj0Q(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*-MGOInJWav8fz4fo7aNj0Q.png"></noscript></div></div></figure><p name="ae60" id="ae60" class="graf graf--p graf-after--figure">Whole processing time went from 1 second to <strong class="markup--strong markup--p-strong">104ms.</strong> This is for quite an expensive request with several skus as input. Simpler inputs we get:</p><figure name="e4a1" id="e4a1" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 678px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 96.89999999999999%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*0Whs0n7OQU4G33TGz2lZgA.png" data-width="1024" data-height="992" data-action="zoom" data-action-value="1*0Whs0n7OQU4G33TGz2lZgA.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_0Whs0n7OQU4G33TGz2lZgA.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="70"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*0Whs0n7OQU4G33TGz2lZgA.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_0Whs0n7OQU4G33TGz2lZgA(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*0Whs0n7OQU4G33TGz2lZgA.png"></noscript></div></div></figure><p name="4f57" id="4f57" class="graf graf--p graf-after--figure">Somewhere around <strong class="markup--strong markup--p-strong">20ms </strong>(it’s important to note that Datastore standard deviation on response time is somewhat considerable but average and median remains around this value).</p><p name="a883" id="a883" class="graf graf--p graf-after--p">The main bottleneck now is retrieving the keys from Datastore and as the time consumed is totally acceptable, we could consider our mission accomplished by now (oooh yeeeah!!!)</p><p name="dd1f" id="dd1f" class="graf graf--p graf-after--p">One thing that happened here is the time to get entities from Datastore became much bigger; this happened because we had to change the client to make the connection and it uses HTTP instead of <a href="https://grpc.io/" data-href="https://grpc.io/" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">gRPC</a> which means we can make time decrease even lower with a more appropriate client.</p><p name="6ef1" id="6ef1" class="graf graf--p graf-after--p">This is an example of results we get for this input <code class="markup--code markup--p-code">/make_recommendation?browsed=DA923SHF25QXA</code>:</p><figure name="2dd6" id="2dd6" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 171px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24.4%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*NURT3hRy5RvY85UkcVXzPw.png" data-width="1017" data-height="248" data-action="zoom" data-action-value="1*NURT3hRy5RvY85UkcVXzPw.png" data-scroll="native"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_NURT3hRy5RvY85UkcVXzPw.png" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="18"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/880/1*NURT3hRy5RvY85UkcVXzPw.png" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_NURT3hRy5RvY85UkcVXzPw(1).png"><noscript class="js-progressiveMedia-inner"><img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/880/1*NURT3hRy5RvY85UkcVXzPw.png"></noscript></div></div></figure><h3 name="1b75" id="1b75" class="graf graf--h3 graf-after--figure">7. Show Me Da Money!&nbsp;(costs)</h3><p name="0615" id="0615" class="graf graf--p graf-after--h3">Costs are important, still, in practice what really matters is cost-income ratio, not just cost.</p><p name="b49b" id="b49b" class="graf graf--p graf-after--p">While I can’t make public Dafiti’s data and costs, let us see how a system like this would cost for a simulated eCommerce.</p><p name="b8f9" id="b8f9" class="graf graf--p graf-after--p">First of all, we have the Standard AppEngine cron service. This cost is basically negligible, it probably will be $1 per month. Now we have BigQuery making the data processing, which, assuming process 100 GB everyday, adds $15 in queries per month. Lets simulate a Dataproc cluster running everyday for roughly 2 hours, 3 machines of type n1-standard-4 which adds $36 a month. We also have the Dataflow machines but as the bottleneck is the writing operation we can use quite basic instances n1-standard-1 which, assuming 3 hours of work with 2 workers adds up $9 a month. Now we have Datastore. As each 100k writes is $0.18, assuming 300k ends up being around 16$ per month. Now let’s say the eCommerce is big and has around 5 million requests everyday. That would be $90 a month. There’s also price for storage. If we consume 5GBs that leads to just $1 at the end of the month. Finally we have the Flexible Environment machine. Here we choose a quite basic machine since we saw main bottleneck is Datastore. Considering we’ll be using 1 vCPU and 2GB of memory this gives us roughly $46.8.</p><p name="e973" id="e973" class="graf graf--p graf-after--p">This all adds up to <strong class="markup--strong markup--p-strong">$214 per month</strong> for an eCommerce receiving 5 million requests per day.</p><p name="a8a7" id="a8a7" class="graf graf--p graf-after--p">With one very important note: the system is totally Serverless, which means we have no expenses with an infrastructure team or devOps. We literally pay just for what we use and nothing more; there’s no extra costs into play here.</p><h3 name="c5f6" id="c5f6" class="graf graf--h3 graf-after--p">8. And Now We&nbsp;Improve</h3><p name="fb49" id="fb49" class="graf graf--p graf-after--h3">Well, there’s still some changes we can make to improve the system. At Dafiti, we don’t use Spark in production. Our similarities are extract with a BigQuery query that already computes all correlations for us.</p><p name="53c2" id="53c2" class="graf graf--p graf-after--p">Also, using Python to make the recommendations didn’t end up being very effective. A better alternative could be using <a href="https://golang.org/" data-href="https://golang.org/" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">GoLang</a> here. This would lead to the possibility of not having to export data to Datastore and each instance loads a file from GCS to its own local memory. Costs would probably be much less then <strong class="markup--strong markup--p-strong">$100 </strong>in this architecture for our simulated store.</p><p name="2651" id="2651" class="graf graf--p graf-after--p">As we had to make the delivery, we couldn’t further explore this approach but it’s definitely something we’ll be testing soon.</p><h3 name="cdb2" id="cdb2" class="graf graf--h3 graf-after--p">9. And That’s&nbsp;It!</h3><p name="f319" id="f319" class="graf graf--p graf-after--h3">What a journey…</p><p name="2051" id="2051" class="graf graf--p graf-after--p">When we started implementing this system we just couldn’t imagine how challenging and demanding it would end up being. It was exhausting, painful, we had to face bug after bug every single day in a tight deadline; it was quite quite quite challenging.</p><p name="11e3" id="11e3" class="graf graf--p graf-after--p">I remember seeing this phrase “The Best Sailors Are Not Made In Calm Seas”. I confess that this version of “no pain no gain” made me reconsider keep going through the all the hurdle this project implementation presented itself to be. I’m glad we successfully worked it through as we learned a lot throughout the process.</p><p name="b9a5" id="b9a5" class="graf graf--p graf-after--p">We managed to make it work and made the delivery just in time. We are very happy with the accomplishment and excited to see what’s coming next.</p><p name="b71a" id="b71a" class="graf graf--p graf-after--p">We have developed some knowledge now on how to implement quite demanding systems in production with a complete Serverless architecture that is cheap and effective. Hopefully, this will open us the doors to build even more complex systems fast, easy, Serverless and ready to interact with customers in no time.</p><p name="1d42" id="1d42" class="graf graf--p graf-after--p">Just until recently we thought it would be impossible to build a recommender system totally Serverless as the computing in each request can be quite demanding but as we could confirm, that’s quite possible and should be our main goal as developers now.</p><p name="6ee7" id="6ee7" class="graf graf--p graf-after--p">If you read it through all that, gosh you deserve it! Hopefully it was worth the read and you could learn something out of that. If you have suggestions or anything to comment, please let us know!</p><p name="67d5" id="67d5" class="graf graf--p graf-after--p">The whole code is available <a href="https://github.com/WillianFuks/example_dataproc_twitter" data-href="https://github.com/WillianFuks/example_dataproc_twitter" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">here</a>.</p><p name="07f1" id="07f1" class="graf graf--p graf-after--p">Well, we look forward to our next mission (you can play <a href="https://www.youtube.com/watch?v=KWdRKZ6QgcU" data-href="https://www.youtube.com/watch?v=KWdRKZ6QgcU" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Super Metroid Ending</a> soundtrack now, it’ll be epic, guaranteed).</p><p name="8572" id="8572" class="graf graf--p graf-after--p graf--trailing">Thanks a lot!<br>(Beam fires. Apache-beam, that is*)</p></div></div></section></div><footer class="u-paddingTop10"><div class="container u-maxWidth740"><div class="row"><div class="col u-size12of12"></div></div><div class="row"><div class="col u-size12of12 js-postTags"><div class="u-paddingBottom10"><ul class="tags tags--postTags tags--borderless"><li><a class="link u-baseColor--link" href="https://medium.com/tag/google-cloud-platform?source=post" data-action-source="post">Google Cloud Platform</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/machine-learning?source=post" data-action-source="post">Machine Learning</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/recommender-systems?source=post" data-action-source="post">Recommender Systems</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/serverless?source=post" data-action-source="post">Serverless</a></li></ul></div></div></div><div class="postActions js-postActionsFooter"><div class="u-flexCenter"><div class="u-flex1"><div class="multirecommend js-actionMultirecommend u-flexCenter u-width60" data-post-id="9c9fbbdc46cc" data-is-icon-29px="true" data-is-circle="true" data-has-recommend-list="true" data-source="post_actions_footer-----9c9fbbdc46cc---------------------clap_footer"><div class="u-relative u-foreground"><button class="button button--large button--circle button--withChrome u-baseColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--largePill u-relative u-foreground u-xs-paddingLeft13 u-width60 u-height60 u-accentColor--textNormal u-accentColor--buttonNormal clap-onboardingcollection" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/9c9fbbdc46cc" data-action-source="post_actions_footer-----9c9fbbdc46cc---------------------clap_footer" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33"><path d="M28.86 17.342l-3.64-6.402c-.292-.433-.712-.729-1.163-.8a1.124 1.124 0 0 0-.889.213c-.63.488-.742 1.181-.33 2.061l1.222 2.587 1.4 2.46c2.234 4.085 1.511 8.007-2.145 11.663-.26.26-.526.49-.797.707 1.42-.084 2.881-.683 4.292-2.094 3.822-3.823 3.565-7.876 2.05-10.395zm-6.252 11.075c3.352-3.35 3.998-6.775 1.978-10.469l-3.378-5.945c-.292-.432-.712-.728-1.163-.8a1.122 1.122 0 0 0-.89.213c-.63.49-.742 1.182-.33 2.061l1.72 3.638a.502.502 0 0 1-.806.568l-8.91-8.91a1.335 1.335 0 0 0-1.887 1.886l5.292 5.292a.5.5 0 0 1-.707.707l-5.292-5.292-1.492-1.492c-.503-.503-1.382-.505-1.887 0a1.337 1.337 0 0 0 0 1.886l1.493 1.492 5.292 5.292a.499.499 0 0 1-.353.854.5.5 0 0 1-.354-.147L5.642 13.96a1.338 1.338 0 0 0-1.887 0 1.338 1.338 0 0 0 0 1.887l2.23 2.228 3.322 3.324a.499.499 0 0 1-.353.853.502.502 0 0 1-.354-.146l-3.323-3.324a1.333 1.333 0 0 0-1.886 0 1.325 1.325 0 0 0-.39.943c0 .356.138.691.39.943l6.396 6.397c3.528 3.53 8.86 5.313 12.821 1.353zM12.73 9.26l5.68 5.68-.49-1.037c-.518-1.107-.426-2.13.224-2.89l-3.303-3.304a1.337 1.337 0 0 0-1.886 0 1.326 1.326 0 0 0-.39.944c0 .217.067.42.165.607zm14.787 19.184c-1.599 1.6-3.417 2.392-5.353 2.392-.349 0-.7-.03-1.058-.082a7.922 7.922 0 0 1-3.667.887c-3.049 0-6.115-1.626-8.359-3.87l-6.396-6.397A2.315 2.315 0 0 1 2 19.724a2.327 2.327 0 0 1 1.923-2.296l-.875-.875a2.339 2.339 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.647l-.139-.139c-.91-.91-.91-2.39 0-3.3.884-.884 2.421-.882 3.301 0l.138.14a2.335 2.335 0 0 1 3.948-1.24l.093.092c.091-.423.291-.828.62-1.157a2.336 2.336 0 0 1 3.3 0l3.384 3.386a2.167 2.167 0 0 1 1.271-.173c.534.086 1.03.354 1.441.765.11-.549.415-1.034.911-1.418a2.12 2.12 0 0 1 1.661-.41c.727.117 1.385.565 1.853 1.262l3.652 6.423c1.704 2.832 2.025 7.377-2.205 11.607zM13.217.484l-1.917.882 2.37 2.837-.454-3.719zm8.487.877l-1.928-.86-.44 3.697 2.368-2.837zM16.5 3.293L15.478-.005h2.044L16.5 3.293z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33"><g fill-rule="evenodd"><path d="M29.58 17.1l-3.854-6.78c-.365-.543-.876-.899-1.431-.989a1.491 1.491 0 0 0-1.16.281c-.42.327-.65.736-.7 1.207v.001l3.623 6.367c2.46 4.498 1.67 8.802-2.333 12.807-.265.265-.536.505-.81.728 1.973-.222 3.474-1.286 4.45-2.263 4.166-4.165 3.875-8.6 2.215-11.36zm-4.831.82l-3.581-6.3c-.296-.439-.725-.742-1.183-.815a1.105 1.105 0 0 0-.89.213c-.647.502-.755 1.188-.33 2.098l1.825 3.858a.601.601 0 0 1-.197.747.596.596 0 0 1-.77-.067L10.178 8.21c-.508-.506-1.393-.506-1.901 0a1.335 1.335 0 0 0-.393.95c0 .36.139.698.393.95v.001l5.61 5.61a.599.599 0 1 1-.848.847l-5.606-5.606c-.001 0-.002 0-.003-.002L5.848 9.375a1.349 1.349 0 0 0-1.902 0 1.348 1.348 0 0 0 0 1.901l1.582 1.582 5.61 5.61a.6.6 0 0 1-.848.848l-5.61-5.61c-.51-.508-1.393-.508-1.9 0a1.332 1.332 0 0 0-.394.95c0 .36.139.697.393.952l2.363 2.362c.002.001.002.002.002.003l3.52 3.52a.6.6 0 0 1-.848.847l-3.522-3.523h-.001a1.336 1.336 0 0 0-.95-.393 1.345 1.345 0 0 0-.949 2.295l6.779 6.78c3.715 3.713 9.327 5.598 13.49 1.434 3.527-3.528 4.21-7.13 2.086-11.015zM11.817 7.727c.06-.328.213-.64.466-.893.64-.64 1.755-.64 2.396 0l3.232 3.232c-.82.783-1.09 1.833-.764 2.992l-5.33-5.33z"></path><path d="M13.285.48l-1.916.881 2.37 2.837z"></path><path d="M21.719 1.361L19.79.501l-.44 3.697z"></path><path d="M16.502 3.298L15.481 0h2.043z"></path></g></svg></span></span></button><div class="clapUndo u-width60 u-round u-height32 u-absolute u-borderBox u-paddingRight5 u-transition--transform200Spring u-background--brandSageLighter js-clapUndo" style="top: 14px; padding: 2px;"><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon u-floatRight" data-action="multivote-undo" data-action-value="9c9fbbdc46cc"><span class="svgIcon svgIcon--removeThin svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M20.13 8.11l-5.61 5.61-5.609-5.61-.801.801 5.61 5.61-5.61 5.61.801.8 5.61-5.609 5.61 5.61.8-.801-5.609-5.61 5.61-5.61" fill-rule="evenodd"></path></svg></span></button></div></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft10"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton" data-action="show-recommends" data-action-value="9c9fbbdc46cc">1.1K</button></span></div></div><div class="buttonSet u-flex0"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon" data-action="scroll-to-responses" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"></path></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal" data-action="scroll-to-responses">8</button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon u-xs-hide" title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"></path></svg></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon u-xs-hide" title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"></path></svg></span></button><button class="button button--large button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon u-xs-show" title="Share this story on Twitter or Facebook" aria-label="Share this story on Twitter or Facebook" data-action="show-share-popover" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--share svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M20.385 8H19a.5.5 0 1 0 .011 1h1.39c.43 0 .84.168 1.14.473.31.305.48.71.48 1.142v10.77c0 .43-.17.837-.47 1.142-.3.305-.71.473-1.14.473H8.62c-.43 0-.84-.168-1.144-.473a1.603 1.603 0 0 1-.473-1.142v-10.77c0-.43.17-.837.48-1.142A1.599 1.599 0 0 1 8.62 9H10a.502.502 0 0 0 0-1H8.615c-.67 0-1.338.255-1.85.766-.51.51-.765 1.18-.765 1.85v10.77c0 .668.255 1.337.766 1.848.51.51 1.18.766 1.85.766h11.77c.668 0 1.337-.255 1.848-.766.51-.51.766-1.18.766-1.85v-10.77c0-.668-.255-1.337-.766-1.848A2.61 2.61 0 0 0 20.384 8zm-8.67-2.508L14 3.207v8.362c0 .27.224.5.5.5s.5-.23.5-.5V3.2l2.285 2.285a.49.49 0 0 0 .704-.001.511.511 0 0 0 0-.708l-3.14-3.14a.504.504 0 0 0-.71 0L11 4.776a.501.501 0 0 0 .71.706" fill-rule="evenodd"></path></svg></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon js-moreActionsButton" title="More actions" aria-label="More actions" data-action="more-actions"><span class="svgIcon svgIcon--more svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="-480.5 272.5 21 21"><path d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z"></path></svg></span></button></div></div></div></div><div class="u-maxWidth740 u-paddingTop20 u-marginTop20 u-borderTopLightest container u-paddingBottom20 u-xs-paddingBottom10 js-postAttributionFooterContainer"><div class="row js-postFooterInfo"><div class="col u-size6of12 u-xs-size12of12"><li class="uiScale uiScale-ui--small uiScale-caption--regular u-block u-paddingBottom18 js-cardUser"><div class="u-marginLeft20 u-floatRight"><span class="followState js-followState" data-user-id="e9c35a095d0d"><button class="button button--small u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc" data-action-source="footer_card"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/e9c35a095d0d" data-action-source="footer_card-e9c35a095d0d-------------------------follow_footer"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="u-tableCell"><a class="link u-baseColor--link avatar" href="https://medium.com/@willian.fuks?source=footer_card" title="Go to the profile of Will Fuks" aria-label="Go to the profile of Will Fuks" data-action-source="footer_card" data-user-id="e9c35a095d0d" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_KKOPcg6qjT9LWFRohbOwjQ.jpeg" class="avatar-image avatar-image--small" alt="Go to the profile of Will Fuks"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="ui-h3 u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal" href="https://medium.com/@willian.fuks" property="cc:attributionName" title="Go to the profile of Will Fuks" aria-label="Go to the profile of Will Fuks" rel="author cc:attributionUrl" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a></h3><p class="ui-body u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">Working as a Data Scientist at Dafiti Group</p></div></li></div><div class="col u-size6of12 u-xs-size12of12 u-xs-marginTop30"><li class="uiScale uiScale-ui--small uiScale-caption--regular u-block u-paddingBottom18 js-cardCollection"><div class="u-marginLeft20 u-floatRight"><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal js-relationshipButton" data-action="sign-up-prompt" data-sign-in-action="toggle-follow-collection" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/collection/google-cloud" data-action-source="----e52cf94d98af----------------------follow_footer" data-collection-id="e52cf94d98af"><span class="button-label  js-buttonLabel">Follow</span></button></div><div class="u-tableCell "><a class="link u-baseColor--link avatar avatar--roundedRectangle" href="https://medium.com/google-cloud?source=footer_card" title="Go to Google Cloud Platform - Community" aria-label="Go to Google Cloud Platform - Community" data-action-source="footer_card"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_FUjLiCANvATKeaJEeg20Rw(1).png" class="avatar-image u-size60x60" alt="Google Cloud Platform - Community"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="ui-h3 u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal" href="https://medium.com/google-cloud?source=footer_card" rel="collection" data-action-source="footer_card">Google Cloud Platform - Community</a></h3><p class="ui-body u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">A collection of technical articles published or curated by Google Cloud Platform Developer Advocates. The views expressed are those of the authors and don't necessarily reflect those of Google.</p><div class="buttonSet"></div></div></li></div></div></div><div class="js-postFooterPlacements"><div class="streamItem streamItem--placementCardGrid js-streamItem"><div class="u-clearfix u-backgroundGrayLightest"><div class="row u-marginAuto u-maxWidth1000 u-paddingTop30 u-paddingBottom40"><div class="col u-padding8 u-xs-size12of12 u-size4of12"><div class="uiScale uiScale-ui--small uiScale-caption--regular u-height280 u-width100pct u-backgroundWhite u-borderCardBorder u-boxShadow u-borderBox u-borderRadius4 js-trackedPost" data-post-id="19dd07e19824" data-source="placement_card_footer_grid---------0-41" data-tracking-context="placement" data-scroll="native"><a class="link link--noUnderline u-baseColor--link" href="https://medium.com/google-cloud/deploying-a-python-serverless-function-in-minutes-with-gcp-19dd07e19824?source=placement_card_footer_grid---------0-41" data-action-source="placement_card_footer_grid---------0-41"><div class="u-backgroundCover u-backgroundColorGrayLight u-height100 u-width100pct u-borderBottomLight u-borderRadiusTop4" style="background-image: url(&quot;https://cdn-images-1.medium.com/fit/c/440/132/1*txTmKRON9wWSlwwXbeuk9Q.gif&quot;); background-position: 50% 50% !important;"></div></a><div class="u-padding15 u-borderBox u-flexColumn u-height180"><a class="link link--noUnderline u-baseColor--link u-flex1" href="https://medium.com/google-cloud/deploying-a-python-serverless-function-in-minutes-with-gcp-19dd07e19824?source=placement_card_footer_grid---------0-41" data-action-source="placement_card_footer_grid---------0-41"><div class="uiScale uiScale-ui--regular uiScale-caption--small u-textColorNormal u-marginBottom7">More from Google Cloud Platform - Community</div><div class="ui-h3 ui-clamp2 u-textColorDarkest u-contentSansBold u-fontSize24 u-maxHeight2LineHeightTighter u-lineClamp2 u-textOverflowEllipsis u-letterSpacingTight u-paddingBottom2">Deploying a Python serverless function in minutes with GCP</div></a><div class="u-paddingBottom10 u-flex0 u-flexCenter"><div class="u-flex1 u-minWidth0 u-marginRight10"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@PicardParis" data-action="show-user-card" data-action-value="6be63961431c" data-action-type="hover" data-user-id="6be63961431c" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_OMNmXavx5hd7qUUZxNYLhA.jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Laurent Picard"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--darker" href="https://medium.com/@PicardParis?source=placement_card_footer_grid---------0-41" data-action="show-user-card" data-action-source="placement_card_footer_grid---------0-41" data-action-value="6be63961431c" data-action-type="hover" data-user-id="6be63961431c" dir="auto">Laurent Picard</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><span class="readingTime u-textColorNormal" title="7 min read"></span></div></div></div></div><div class="u-flex0 u-flexCenter"><div class="buttonSet"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="19dd07e19824" data-is-label-padded="true" data-source="placement_card_footer_grid-----19dd07e19824----0-41----------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/19dd07e19824" data-action-source="placement_card_footer_grid-----19dd07e19824----0-41----------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-disablePointerEvents u-marginLeft4" data-action="show-recommends" data-action-value="19dd07e19824">183</button></span></div></div><div class="u-height20 u-borderRightLighter u-inlineBlock u-relative u-marginRight10 u-marginLeft12"></div><div class="buttonSet"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/19dd07e19824" data-action-source="placement_card_footer_grid-----19dd07e19824----0-41----------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div><div class="col u-padding8 u-xs-size12of12 u-size4of12"><div class="uiScale uiScale-ui--small uiScale-caption--regular u-height280 u-width100pct u-backgroundWhite u-borderCardBorder u-boxShadow u-borderBox u-borderRadius4 js-trackedPost" data-post-id="cf753fa173a4" data-source="placement_card_footer_grid---------1-41" data-tracking-context="placement" data-scroll="native"><a class="link link--noUnderline u-baseColor--link" href="https://medium.com/google-cloud/share-data-with-confidence-cell-level-access-controls-in-bigquery-and-data-studio-cf753fa173a4?source=placement_card_footer_grid---------1-41" data-action-source="placement_card_footer_grid---------1-41"><div class="u-backgroundCover u-backgroundColorGrayLight u-height100 u-width100pct u-borderBottomLight u-borderRadiusTop4" style="background-image: url(&quot;https://cdn-images-1.medium.com/fit/c/440/132/0*bnQXzhp4yxWCVfnR&quot;); background-position: 50% 50% !important;"></div></a><div class="u-padding15 u-borderBox u-flexColumn u-height180"><a class="link link--noUnderline u-baseColor--link u-flex1" href="https://medium.com/google-cloud/share-data-with-confidence-cell-level-access-controls-in-bigquery-and-data-studio-cf753fa173a4?source=placement_card_footer_grid---------1-41" data-action-source="placement_card_footer_grid---------1-41"><div class="uiScale uiScale-ui--regular uiScale-caption--small u-textColorNormal u-marginBottom7">More from Google Cloud Platform - Community</div><div class="ui-h3 ui-clamp2 u-textColorDarkest u-contentSansBold u-fontSize24 u-maxHeight2LineHeightTighter u-lineClamp2 u-textOverflowEllipsis u-letterSpacingTight u-paddingBottom2">Share Data with Confidence: Cell-level Access Controls in BigQuery and Data Studio</div></a><div class="u-paddingBottom10 u-flex0 u-flexCenter"><div class="u-flex1 u-minWidth0 u-marginRight10"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@richkadel" data-action="show-user-card" data-action-value="9dbfbc0d4a6d" data-action-type="hover" data-user-id="9dbfbc0d4a6d" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_LW33z13sBQgGrGuw" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Rich Kadel"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--darker" href="https://medium.com/@richkadel?source=placement_card_footer_grid---------1-41" data-action="show-user-card" data-action-source="placement_card_footer_grid---------1-41" data-action-value="9dbfbc0d4a6d" data-action-type="hover" data-user-id="9dbfbc0d4a6d" dir="auto">Rich Kadel</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><span class="readingTime u-textColorNormal" title="14 min read"></span></div></div></div></div><div class="u-flex0 u-flexCenter"><div class="buttonSet"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="cf753fa173a4" data-is-label-padded="true" data-source="placement_card_footer_grid-----cf753fa173a4----1-41----------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/cf753fa173a4" data-action-source="placement_card_footer_grid-----cf753fa173a4----1-41----------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-disablePointerEvents u-marginLeft4" data-action="show-recommends" data-action-value="cf753fa173a4">150</button></span></div></div><div class="u-height20 u-borderRightLighter u-inlineBlock u-relative u-marginRight10 u-marginLeft12"></div><div class="buttonSet"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/cf753fa173a4" data-action-source="placement_card_footer_grid-----cf753fa173a4----1-41----------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div><div class="col u-padding8 u-xs-size12of12 u-size4of12"><div class="uiScale uiScale-ui--small uiScale-caption--regular u-height280 u-width100pct u-backgroundWhite u-borderCardBorder u-boxShadow u-borderBox u-borderRadius4 js-trackedPost" data-post-id="65e2f684594b" data-source="placement_card_footer_grid---------2-41" data-tracking-context="placement" data-scroll="native"><a class="link link--noUnderline u-baseColor--link" href="https://medium.com/google-cloud/bigquery-optimized-cluster-your-tables-65e2f684594b?source=placement_card_footer_grid---------2-41" data-action-source="placement_card_footer_grid---------2-41"><div class="u-backgroundCover u-backgroundColorGrayLight u-height100 u-width100pct u-borderBottomLight u-borderRadiusTop4" style="background-image: url(&quot;https://cdn-images-1.medium.com/fit/c/440/132/0*nf_KEEMd65dsPj_W&quot;); background-position: 50% 50% !important;"></div></a><div class="u-padding15 u-borderBox u-flexColumn u-height180"><a class="link link--noUnderline u-baseColor--link u-flex1" href="https://medium.com/google-cloud/bigquery-optimized-cluster-your-tables-65e2f684594b?source=placement_card_footer_grid---------2-41" data-action-source="placement_card_footer_grid---------2-41"><div class="uiScale uiScale-ui--regular uiScale-caption--small u-textColorNormal u-marginBottom7">More from Google Cloud Platform - Community</div><div class="ui-h3 ui-clamp2 u-textColorDarkest u-contentSansBold u-fontSize24 u-maxHeight2LineHeightTighter u-lineClamp2 u-textOverflowEllipsis u-letterSpacingTight u-paddingBottom2">Optimizing BigQuery: Cluster your tables</div></a><div class="u-paddingBottom10 u-flex0 u-flexCenter"><div class="u-flex1 u-minWidth0 u-marginRight10"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@hoffa" data-action="show-user-card" data-action-value="279fe54c149a" data-action-type="hover" data-user-id="279fe54c149a" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_ahXIMiIgudZTyqJS.jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Felipe Hoffa"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--darker" href="https://medium.com/@hoffa?source=placement_card_footer_grid---------2-41" data-action="show-user-card" data-action-source="placement_card_footer_grid---------2-41" data-action-value="279fe54c149a" data-action-type="hover" data-user-id="279fe54c149a" dir="auto">Felipe Hoffa</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><span class="readingTime u-textColorNormal" title="7 min read"></span></div></div></div></div><div class="u-flex0 u-flexCenter"><div class="buttonSet"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="65e2f684594b" data-is-label-padded="true" data-source="placement_card_footer_grid-----65e2f684594b----2-41----------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/65e2f684594b" data-action-source="placement_card_footer_grid-----65e2f684594b----2-41----------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-disablePointerEvents u-marginLeft4" data-action="show-recommends" data-action-value="65e2f684594b">704</button></span></div></div><div class="u-height20 u-borderRightLighter u-inlineBlock u-relative u-marginRight10 u-marginLeft12"></div><div class="buttonSet"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/65e2f684594b" data-action-source="placement_card_footer_grid-----65e2f684594b----2-41----------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div></div></div></div></div><div class="u-padding0 u-clearfix u-backgroundGrayLightest u-print-hide supplementalPostContent js-responsesWrapper" data-action-scope="_actionscope_6"><div class="container u-maxWidth740"><div class="responsesStreamWrapper u-maxWidth640 js-responsesStreamWrapper"><div class="container responsesStream-title u-paddingTop15"><div class="row"><header class="heading"><div class="u-clearfix"><div class="heading-content u-floatLeft"><span class="heading-title heading-title--semibold">Responses</span></div></div></header></div></div><div class="responsesStream-editor cardChromeless u-marginBottom20 u-paddingLeft20 u-paddingRight20 js-responsesStreamEditor"><div class="u-paddingTop30 u-paddingBottom30 u-paddingLeft0 u-paddingRight0 u-borderBottomLightest js-responsesLoggedOutPrompt"><button class="button button--chromeless is-touchIconBlackPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--withIconAndLabel button--loggedOutPrompt" data-action="sign-up-prompt" data-redirect="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc#--respond" data-skip-onboarding="true" data-action-source="logged_out_response_prompt--------------------------respond_box"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"></path></svg></span><span class="button-label  js-buttonLabel">Write a response…</span></button></div></div><div class="responsesStream js-responsesStream"><div class="streamItem streamItem--conversation js-streamItem" data-action-scope="_actionscope_7"><div class="streamItemConversation"><div class="u-marginLeft20"><div class="streamItemConversation-divider"></div><header class="heading heading--light heading--simple"><div class="u-clearfix"><div class="heading-content u-floatLeft"><span class="heading-title">Conversation with <a class="link link--accent u-accentColor--textNormal u-baseColor--link" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a>.</span></div></div></header></div><div class="streamItemConversation-inner cardChromeless"><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="bead79b24dc1" data-source="responses---------0---------------------" data-action-scope="_actionscope_8" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@matus.cimerman" data-action="show-user-card" data-action-value="8a81d7a4bf6e" data-action-type="hover" data-user-id="8a81d7a4bf6e" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_t_E8es4e2_DEXGN2JOQC0w.jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Matúš Cimerman"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@matus.cimerman?source=responses---------0---------------------" data-action="show-user-card" data-action-source="responses---------0---------------------" data-action-value="8a81d7a4bf6e" data-action-type="hover" data-user-id="8a81d7a4bf6e" dir="auto">Matúš Cimerman</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@matus.cimerman/hi-will-bead79b24dc1?source=responses---------0---------------------" data-action="open-post" data-action-value="https://medium.com/@matus.cimerman/hi-will-bead79b24dc1?source=responses---------0---------------------" data-action-source="preview-listing"><time datetime="2018-01-28T11:23:10.650Z">Jan 28</time></a><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="1 min read"></span></div></div></div></div></div><div class="js-inlineExpandBody"><a class="" href="https://medium.com/@matus.cimerman/hi-will-bead79b24dc1?source=responses---------0---------------------" data-action="expand-inline"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="e6c2" id="e6c2" class="graf graf--p graf--leading">Hi Will,</p><p name="99e2" id="99e2" class="graf graf--p graf-after--p">first of all, thanks for great and inspiring article! Definitely something to learn from.</p><p name="bca8" id="bca8" class="graf graf--p graf-after--p graf--trailing">I'm curious why did you choose to use Datastore instead of BigTable? Sure, for such small e-commerce as in your example, it wouldn't be viable. But, if you start hitting at least 30k requests/sec…</p></div></div></section></div></a></div><div class="postArticle-readMore"><button class="button button--smaller button--link u-baseColor--buttonNormal" data-action="expand-inline">Read more…</button></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="bead79b24dc1" data-is-flush-left="true" data-source="listing-----bead79b24dc1---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/bead79b24dc1" data-action-source="listing-----bead79b24dc1---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><a class="button button--chromeless u-baseColor--buttonNormal" href="https://medium.com/@matus.cimerman/hi-will-bead79b24dc1?source=responses---------0---------------------#--responses" data-action-source="responses---------0---------------------">1 response</a><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/bead79b24dc1" data-action-source="listing-----bead79b24dc1---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="d2c2fcef5405" data-source="responses---------0---------------------" data-action-scope="_actionscope_9" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_KKOPcg6qjT9LWFRohbOwjQ(1).jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Will Fuks"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@willian.fuks?source=responses---------0---------------------" data-action="show-user-card" data-action-source="responses---------0---------------------" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@willian.fuks/hello-mat%C3%BAs-d2c2fcef5405?source=responses---------0---------------------" data-action="open-post" data-action-value="https://medium.com/@willian.fuks/hello-mat%C3%BAs-d2c2fcef5405?source=responses---------0---------------------" data-action-source="preview-listing"><time datetime="2018-02-06T00:25:12.952Z">Feb 5</time></a><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="2 min read"></span></div></div></div></div></div><div class="js-inlineExpandBody"><a class="" href="https://medium.com/@willian.fuks/hello-mat%C3%BAs-d2c2fcef5405?source=responses---------0---------------------" data-action="expand-inline"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="7a36" id="7a36" class="graf graf--p graf--leading">Hello Matús,</p><p name="109f" id="109f" class="graf graf--p graf-after--p">Glad to know you’ve learned something from it&nbsp;:)!</p><p name="2ef0" id="2ef0" class="graf graf--p graf-after--p graf--trailing">We did consider BigTable and played around with it but in the end Datastore showed up to be cheaper and easier for our use case (in Standard Environment you also have the NDB library to interact with Datastore which is a pretty awesome…</p></div></div></section></div></a></div><div class="postArticle-readMore"><button class="button button--smaller button--link u-baseColor--buttonNormal" data-action="expand-inline">Read more…</button></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="d2c2fcef5405" data-is-flush-left="true" data-source="listing-----d2c2fcef5405---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/d2c2fcef5405" data-action-source="listing-----d2c2fcef5405---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-disablePointerEvents" data-action="show-recommends" data-action-value="d2c2fcef5405">18</button></span></div></div><div class="buttonSet u-floatRight"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/d2c2fcef5405" data-action-source="listing-----d2c2fcef5405---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div></div><div class="streamItem streamItem--conversation js-streamItem" data-action-scope="_actionscope_10"><div class="streamItemConversation"><div class="u-marginLeft20"><div class="streamItemConversation-divider"></div><header class="heading heading--light heading--simple"><div class="u-clearfix"><div class="heading-content u-floatLeft"><span class="heading-title">Conversation with <a class="link link--accent u-accentColor--textNormal u-baseColor--link" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a>.</span></div></div></header></div><div class="streamItemConversation-inner cardChromeless"><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="31816358725f" data-source="responses---------1---------------------" data-action-scope="_actionscope_11" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@ramurti" data-action="show-user-card" data-action-value="163ff0fc3ff0" data-action-type="hover" data-user-id="163ff0fc3ff0" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_YY8Qw2UD1PwXpeoQ" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Ramurti de Alencar Barbosa"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@ramurti?source=responses---------1---------------------" data-action="show-user-card" data-action-source="responses---------1---------------------" data-action-value="163ff0fc3ff0" data-action-type="hover" data-user-id="163ff0fc3ff0" dir="auto">Ramurti de Alencar Barbosa</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@ramurti/hi-will-31816358725f?source=responses---------1---------------------" data-action="open-post" data-action-value="https://medium.com/@ramurti/hi-will-31816358725f?source=responses---------1---------------------" data-action-source="preview-listing"><time datetime="2018-02-21T03:08:34.921Z">Feb 20</time></a><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="1 min read"></span></div></div></div></div></div><div class="js-inlineExpandBody"><a class="" href="https://medium.com/@ramurti/hi-will-31816358725f?source=responses---------1---------------------" data-action="expand-inline"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="3141" id="3141" class="graf graf--p graf--leading">Hi Will,</p><p name="7ceb" id="7ceb" class="graf graf--p graf-after--p">Thanks for the excellent article.</p><p name="98c5" id="98c5" class="graf graf--p graf-after--p graf--trailing">Would you mind clarifying the part where you said “At Dafiti, we don’t use Spark in production. Our similarities are extract with a BigQuery query that already computes all correlations for us.”</p></div></div></section></div></a></div><div class="postArticle-readMore"><button class="button button--smaller button--link u-baseColor--buttonNormal" data-action="expand-inline">Read more…</button></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="31816358725f" data-is-flush-left="true" data-source="listing-----31816358725f---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/31816358725f" data-action-source="listing-----31816358725f---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><a class="button button--chromeless u-baseColor--buttonNormal" href="https://medium.com/@ramurti/hi-will-31816358725f?source=responses---------1---------------------#--responses" data-action-source="responses---------1---------------------">1 response</a><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/31816358725f" data-action-source="listing-----31816358725f---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="d16e652af5fe" data-source="responses---------1---------------------" data-action-scope="_actionscope_12" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_KKOPcg6qjT9LWFRohbOwjQ(1).jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Will Fuks"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@willian.fuks?source=responses---------1---------------------" data-action="show-user-card" data-action-source="responses---------1---------------------" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@willian.fuks/hello-ramurti-d16e652af5fe?source=responses---------1---------------------" data-action="open-post" data-action-value="https://medium.com/@willian.fuks/hello-ramurti-d16e652af5fe?source=responses---------1---------------------" data-action-source="preview-listing"><time datetime="2018-03-01T09:47:44.016Z">Mar 1</time></a><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="1 min read"></span></div></div></div></div></div><div class="js-inlineExpandBody"><a class="" href="https://medium.com/@willian.fuks/hello-ramurti-d16e652af5fe?source=responses---------1---------------------" data-action="expand-inline"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="cabd" id="cabd" class="graf graf--p graf--leading">Hello Ramurti,</p><p name="02bd" id="02bd" class="graf graf--p graf-after--p">We implemented DIMSUM through a query in BigQuery; literally.</p><p name="f812" id="f812" class="graf graf--p graf-after--p graf--trailing">As crazy as it might sound but if you think about it you’ll realize that it’s actually not that hard to do so (it was quite challenging for us at first but once we grasped some of the concepts of BigQuery’s Standard SQL then…</p></div></div></section></div></a></div><div class="postArticle-readMore"><button class="button button--smaller button--link u-baseColor--buttonNormal" data-action="expand-inline">Read more…</button></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="d16e652af5fe" data-is-flush-left="true" data-source="listing-----d16e652af5fe---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/d16e652af5fe" data-action-source="listing-----d16e652af5fe---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/d16e652af5fe" data-action-source="listing-----d16e652af5fe---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div></div><div class="streamItem streamItem--conversation js-streamItem" data-action-scope="_actionscope_13"><div class="streamItemConversation"><div class="u-marginLeft20"><div class="streamItemConversation-divider"></div><header class="heading heading--light heading--simple"><div class="u-clearfix"><div class="heading-content u-floatLeft"><span class="heading-title">Conversation with <a class="link link--accent u-accentColor--textNormal u-baseColor--link" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a>.</span></div></div></header></div><div class="streamItemConversation-inner cardChromeless"><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="52b06b1438ce" data-source="responses---------2---------------------" data-action-scope="_actionscope_14" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@bogumil.bialous" data-action="show-user-card" data-action-value="b144a4a86e91" data-action-type="hover" data-user-id="b144a4a86e91" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_8JiiEtoV2H-tx7tj" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of bogumil bialous"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@bogumil.bialous?source=responses---------2---------------------" data-action="show-user-card" data-action-source="responses---------2---------------------" data-action-value="b144a4a86e91" data-action-type="hover" data-user-id="b144a4a86e91" dir="auto">bogumil bialous</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@bogumil.bialous/great-article-thanks-52b06b1438ce?source=responses---------2---------------------" data-action="open-post" data-action-value="https://medium.com/@bogumil.bialous/great-article-thanks-52b06b1438ce?source=responses---------2---------------------" data-action-source="preview-listing"><time datetime="2018-01-18T22:45:15.732Z">Jan 18</time></a></div></div></div></div></div><div><a class="" href="https://medium.com/@bogumil.bialous/great-article-thanks-52b06b1438ce?source=responses---------2---------------------"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="76c0" id="76c0" class="graf graf--p graf--leading">Great article! Thanks.</p><p name="f3c4" id="f3c4" class="graf graf--p graf-after--p graf--trailing">Just to clarify GA part.. are you using <span class="markup--anchor markup--p-anchor" data-action="open-inner-link" data-action-value="https://www.google.com/analytics/360-suite/">Analytics 360 Suite</span> for raw data when using BQ?</p></div></div></section></div></a></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="52b06b1438ce" data-is-flush-left="true" data-source="listing-----52b06b1438ce---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/52b06b1438ce" data-action-source="listing-----52b06b1438ce---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><a class="button button--chromeless u-baseColor--buttonNormal" href="https://medium.com/@bogumil.bialous/great-article-thanks-52b06b1438ce?source=responses---------2---------------------#--responses" data-action-source="responses---------2---------------------">1 response</a><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/52b06b1438ce" data-action-source="listing-----52b06b1438ce---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="c042ce0aec10" data-source="responses---------2---------------------" data-action-scope="_actionscope_15" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_KKOPcg6qjT9LWFRohbOwjQ(1).jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Will Fuks"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@willian.fuks?source=responses---------2---------------------" data-action="show-user-card" data-action-source="responses---------2---------------------" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@willian.fuks/hi-bogumil-c042ce0aec10?source=responses---------2---------------------" data-action="open-post" data-action-value="https://medium.com/@willian.fuks/hi-bogumil-c042ce0aec10?source=responses---------2---------------------" data-action-source="preview-listing"><time datetime="2018-01-23T12:59:07.179Z">Jan 23</time></a></div></div></div></div></div><div><a class="" href="https://medium.com/@willian.fuks/hi-bogumil-c042ce0aec10?source=responses---------2---------------------"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="9f58" id="9f58" class="graf graf--p graf--leading">Hi bogumil,</p><p name="7c73" id="7c73" class="graf graf--p graf-after--p">Thanks for the feedback&nbsp;:)</p><p name="3840" id="3840" class="graf graf--p graf-after--p graf--trailing">Yeap, we used Analytics 360 Suite. At Dafiti we took Google Analytics tracking quite seriously so currently it’s one of our main sources of data for developing new algorithms or getting insights.</p></div></div></section></div></a></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="c042ce0aec10" data-is-flush-left="true" data-source="listing-----c042ce0aec10---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/c042ce0aec10" data-action-source="listing-----c042ce0aec10---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/c042ce0aec10" data-action-source="listing-----c042ce0aec10---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div></div><div class="streamItem streamItem--conversation js-streamItem" data-action-scope="_actionscope_16"><div class="streamItemConversation"><div class="u-marginLeft20"><div class="streamItemConversation-divider"></div><header class="heading heading--light heading--simple"><div class="u-clearfix"><div class="heading-content u-floatLeft"><span class="heading-title">Conversation with <a class="link link--accent u-accentColor--textNormal u-baseColor--link" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a>.</span></div></div></header></div><div class="streamItemConversation-inner cardChromeless"><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="44d9ee09d8e" data-source="responses---------3---------------------" data-action-scope="_actionscope_17" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@mfeldman143" data-action="show-user-card" data-action-value="38b0fb98faeb" data-action-type="hover" data-user-id="38b0fb98faeb" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_kQhefzvOa1gJ4CwN" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Michael Feldman"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@mfeldman143?source=responses---------3---------------------" data-action="show-user-card" data-action-source="responses---------3---------------------" data-action-value="38b0fb98faeb" data-action-type="hover" data-user-id="38b0fb98faeb" dir="auto">Michael Feldman</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@mfeldman143/cython-and-super-metroid-for-the-win-44d9ee09d8e?source=responses---------3---------------------" data-action="open-post" data-action-value="https://medium.com/@mfeldman143/cython-and-super-metroid-for-the-win-44d9ee09d8e?source=responses---------3---------------------" data-action-source="preview-listing"><time datetime="2018-01-11T22:10:12.532Z">Jan 11</time></a></div></div></div></div></div><div><a class="" href="https://medium.com/@mfeldman143/cython-and-super-metroid-for-the-win-44d9ee09d8e?source=responses---------3---------------------"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="8388" id="8388" class="graf graf--p graf--leading">Cython and super metroid for the win&nbsp;:)</p><p name="c401" id="c401" class="graf graf--p graf-after--p">Glad you were able to use all those GCP products and document progress. My experince has been phenomenal with bq commands.</p><p name="1dad" id="1dad" class="graf graf--p graf-after--p graf--trailing">Let’s see AB testing DIMSUM vs ML Engine algorithms in part2</p></div></div></section></div></a></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="44d9ee09d8e" data-is-flush-left="true" data-source="listing-----44d9ee09d8e---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/44d9ee09d8e" data-action-source="listing-----44d9ee09d8e---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><a class="button button--chromeless u-baseColor--buttonNormal" href="https://medium.com/@mfeldman143/cython-and-super-metroid-for-the-win-44d9ee09d8e?source=responses---------3---------------------#--responses" data-action-source="responses---------3---------------------">1 response</a><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/44d9ee09d8e" data-action-source="listing-----44d9ee09d8e---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="9124309e8c9a" data-source="responses---------3---------------------" data-action-scope="_actionscope_18" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_KKOPcg6qjT9LWFRohbOwjQ(1).jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Will Fuks"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@willian.fuks?source=responses---------3---------------------" data-action="show-user-card" data-action-source="responses---------3---------------------" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@willian.fuks/hooray-thats-a-great-idea-9124309e8c9a?source=responses---------3---------------------" data-action="open-post" data-action-value="https://medium.com/@willian.fuks/hooray-thats-a-great-idea-9124309e8c9a?source=responses---------3---------------------" data-action-source="preview-listing"><time datetime="2018-01-12T00:01:39.614Z">Jan 11</time></a></div></div></div></div></div><div><a class="" href="https://medium.com/@willian.fuks/hooray-thats-a-great-idea-9124309e8c9a?source=responses---------3---------------------"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="23b1" id="23b1" class="graf graf--p graf--leading">hooray that’s a great idea! I’m working on implementing some new tools and hopefully will get the chance to use ML Engine soon!</p><p name="9541" id="9541" class="graf graf--p graf-after--p graf--trailing">Glad you liked the post and the metroid references&nbsp;:)!</p></div></div></section></div></a></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="9124309e8c9a" data-is-flush-left="true" data-source="listing-----9124309e8c9a---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/9124309e8c9a" data-action-source="listing-----9124309e8c9a---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/9124309e8c9a" data-action-source="listing-----9124309e8c9a---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div></div><div class="streamItem streamItem--conversation js-streamItem" data-action-scope="_actionscope_19"><div class="streamItemConversation"><div class="u-marginLeft20"><div class="streamItemConversation-divider"></div><header class="heading heading--light heading--simple"><div class="u-clearfix"><div class="heading-content u-floatLeft"><span class="heading-title">Conversation with <a class="link link--accent u-accentColor--textNormal u-baseColor--link" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a>.</span></div></div></header></div><div class="streamItemConversation-inner cardChromeless"><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="c9e574eccae2" data-source="responses---------4---------------------" data-action-scope="_actionscope_20" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@dalyea" data-action="show-user-card" data-action-value="882e38c3a0be" data-action-type="hover" data-user-id="882e38c3a0be" dir="auto"><div class="u-relative u-inlineBlock u-flex0"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/0_1W6I5T4nLPm4I_V3" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of David Alyea"><div class="avatar-halo u-absolute u-textColorGreenNormal svgIcon" style="width: calc(100% + 10px); height: calc(100% + 10px); top:-5px; left:-5px"><svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M3.44615311,11.6601601 C6.57294867,5.47967718 12.9131553,1.5 19.9642857,1.5 C27.0154162,1.5 33.3556228,5.47967718 36.4824183,11.6601601 L37.3747245,11.2087295 C34.0793076,4.69494641 27.3961457,0.5 19.9642857,0.5 C12.5324257,0.5 5.84926381,4.69494641 2.55384689,11.2087295 L3.44615311,11.6601601 Z"></path><path d="M36.4824183,28.2564276 C33.3556228,34.4369105 27.0154162,38.4165876 19.9642857,38.4165876 C12.9131553,38.4165876 6.57294867,34.4369105 3.44615311,28.2564276 L2.55384689,28.7078582 C5.84926381,35.2216412 12.5324257,39.4165876 19.9642857,39.4165876 C27.3961457,39.4165876 34.0793076,35.2216412 37.3747245,28.7078582 L36.4824183,28.2564276 Z"></path></svg></div></div></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@dalyea?source=responses---------4---------------------" data-action="show-user-card" data-action-source="responses---------4---------------------" data-action-value="882e38c3a0be" data-action-type="hover" data-user-id="882e38c3a0be" dir="auto">David Alyea</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@dalyea/thanks-for-the-writeup-even-if-it-was-a-few-years-back-c9e574eccae2?source=responses---------4---------------------" data-action="open-post" data-action-value="https://medium.com/@dalyea/thanks-for-the-writeup-even-if-it-was-a-few-years-back-c9e574eccae2?source=responses---------4---------------------" data-action-source="preview-listing"><time datetime="2018-03-21T00:26:10.981Z">Mar 20</time></a></div></div></div></div></div><div><a class="" href="https://medium.com/@dalyea/thanks-for-the-writeup-even-if-it-was-a-few-years-back-c9e574eccae2?source=responses---------4---------------------"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="5412" id="5412" class="graf graf--p graf--leading graf--trailing">Thanks for the writeup, even if it was a few years back! About the definition of Xijk in the explanation section, I believe the definition has a typo - can you check akj * akj?</p></div></div></section></div></a></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="c9e574eccae2" data-is-flush-left="true" data-source="listing-----c9e574eccae2---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/c9e574eccae2" data-action-source="listing-----c9e574eccae2---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><a class="button button--chromeless u-baseColor--buttonNormal" href="https://medium.com/@dalyea/thanks-for-the-writeup-even-if-it-was-a-few-years-back-c9e574eccae2?source=responses---------4---------------------#--responses" data-action-source="responses---------4---------------------">1 response</a><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/c9e574eccae2" data-action-source="listing-----c9e574eccae2---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="65b7f885361" data-source="responses---------4---------------------" data-action-scope="_actionscope_21" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@willian.fuks" data-action="show-user-card" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_KKOPcg6qjT9LWFRohbOwjQ(1).jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Will Fuks"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@willian.fuks?source=responses---------4---------------------" data-action="show-user-card" data-action-source="responses---------4---------------------" data-action-value="e9c35a095d0d" data-action-type="hover" data-user-id="e9c35a095d0d" dir="auto">Will Fuks</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@willian.fuks/hello-david-65b7f885361?source=responses---------4---------------------" data-action="open-post" data-action-value="https://medium.com/@willian.fuks/hello-david-65b7f885361?source=responses---------4---------------------" data-action-source="preview-listing"><time datetime="2018-03-21T16:49:25.911Z">Mar 21</time></a></div></div></div></div></div><div><a class="" href="https://medium.com/@willian.fuks/hello-david-65b7f885361?source=responses---------4---------------------"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="6761" id="6761" class="graf graf--p graf--leading">Hello David,</p><p name="0b35" id="0b35" class="graf graf--p graf-after--p">You are right, well spotted! There’s indeed a typo. Problem is I took those equations from the paper this post is based on, where the typo comes from as well&nbsp;:)</p><p name="9ebb" id="9ebb" class="graf graf--p graf-after--p">I’ll try taking some time to write these equations properly and update the post.</p><p name="d168" id="d168" class="graf graf--p graf-after--p graf--trailing">Thanks for the comment!</p></div></div></section></div></a></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="65b7f885361" data-is-flush-left="true" data-source="listing-----65b7f885361---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/65b7f885361" data-action-source="listing-----65b7f885361---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/65b7f885361" data-action-source="listing-----65b7f885361---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div></div></div><div class="container js-showOtherResponses"><div class="row"><button class="button button--primary button--withChrome u-accentColor--buttonNormal responsesStream-showOtherResponses cardChromeless u-width100pct u-marginVertical20 u-heightAuto" data-action="show-other-responses">Show all responses</button></div></div><div class="responsesStream js-responsesStreamOther"></div></div></div></div><div class="supplementalPostContent js-heroPromo"></div></footer></article></main><aside class="u-marginAuto u-maxWidth1000 js-postLeftSidebar"><div class="u-foreground u-top0 u-fixed u-sm-hide u-marginLeftNegative12 js-postShareWidget u-transition--fadeOut300" data-scroll="fixed" style="transform: translateY(150px);"><ul><li class="u-textAlignCenter u-marginVertical10"><div class="multirecommend js-actionMultirecommend u-flexColumn u-marginBottom10 u-width60" data-post-id="9c9fbbdc46cc" data-is-icon-29px="true" data-is-vertical="true" data-is-circle="true" data-has-recommend-list="true" data-source="post_share_widget-----9c9fbbdc46cc---------------------clap_sidebar"><div class="u-relative u-foreground"><button class="button button--large button--circle button--withChrome u-baseColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--largePill u-relative u-foreground u-xs-paddingLeft13 u-width60 u-height60 u-accentColor--textNormal u-accentColor--buttonNormal" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/9c9fbbdc46cc" data-action-source="post_share_widget-----9c9fbbdc46cc---------------------clap_sidebar" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33"><path d="M28.86 17.342l-3.64-6.402c-.292-.433-.712-.729-1.163-.8a1.124 1.124 0 0 0-.889.213c-.63.488-.742 1.181-.33 2.061l1.222 2.587 1.4 2.46c2.234 4.085 1.511 8.007-2.145 11.663-.26.26-.526.49-.797.707 1.42-.084 2.881-.683 4.292-2.094 3.822-3.823 3.565-7.876 2.05-10.395zm-6.252 11.075c3.352-3.35 3.998-6.775 1.978-10.469l-3.378-5.945c-.292-.432-.712-.728-1.163-.8a1.122 1.122 0 0 0-.89.213c-.63.49-.742 1.182-.33 2.061l1.72 3.638a.502.502 0 0 1-.806.568l-8.91-8.91a1.335 1.335 0 0 0-1.887 1.886l5.292 5.292a.5.5 0 0 1-.707.707l-5.292-5.292-1.492-1.492c-.503-.503-1.382-.505-1.887 0a1.337 1.337 0 0 0 0 1.886l1.493 1.492 5.292 5.292a.499.499 0 0 1-.353.854.5.5 0 0 1-.354-.147L5.642 13.96a1.338 1.338 0 0 0-1.887 0 1.338 1.338 0 0 0 0 1.887l2.23 2.228 3.322 3.324a.499.499 0 0 1-.353.853.502.502 0 0 1-.354-.146l-3.323-3.324a1.333 1.333 0 0 0-1.886 0 1.325 1.325 0 0 0-.39.943c0 .356.138.691.39.943l6.396 6.397c3.528 3.53 8.86 5.313 12.821 1.353zM12.73 9.26l5.68 5.68-.49-1.037c-.518-1.107-.426-2.13.224-2.89l-3.303-3.304a1.337 1.337 0 0 0-1.886 0 1.326 1.326 0 0 0-.39.944c0 .217.067.42.165.607zm14.787 19.184c-1.599 1.6-3.417 2.392-5.353 2.392-.349 0-.7-.03-1.058-.082a7.922 7.922 0 0 1-3.667.887c-3.049 0-6.115-1.626-8.359-3.87l-6.396-6.397A2.315 2.315 0 0 1 2 19.724a2.327 2.327 0 0 1 1.923-2.296l-.875-.875a2.339 2.339 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.647l-.139-.139c-.91-.91-.91-2.39 0-3.3.884-.884 2.421-.882 3.301 0l.138.14a2.335 2.335 0 0 1 3.948-1.24l.093.092c.091-.423.291-.828.62-1.157a2.336 2.336 0 0 1 3.3 0l3.384 3.386a2.167 2.167 0 0 1 1.271-.173c.534.086 1.03.354 1.441.765.11-.549.415-1.034.911-1.418a2.12 2.12 0 0 1 1.661-.41c.727.117 1.385.565 1.853 1.262l3.652 6.423c1.704 2.832 2.025 7.377-2.205 11.607zM13.217.484l-1.917.882 2.37 2.837-.454-3.719zm8.487.877l-1.928-.86-.44 3.697 2.368-2.837zM16.5 3.293L15.478-.005h2.044L16.5 3.293z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33"><g fill-rule="evenodd"><path d="M29.58 17.1l-3.854-6.78c-.365-.543-.876-.899-1.431-.989a1.491 1.491 0 0 0-1.16.281c-.42.327-.65.736-.7 1.207v.001l3.623 6.367c2.46 4.498 1.67 8.802-2.333 12.807-.265.265-.536.505-.81.728 1.973-.222 3.474-1.286 4.45-2.263 4.166-4.165 3.875-8.6 2.215-11.36zm-4.831.82l-3.581-6.3c-.296-.439-.725-.742-1.183-.815a1.105 1.105 0 0 0-.89.213c-.647.502-.755 1.188-.33 2.098l1.825 3.858a.601.601 0 0 1-.197.747.596.596 0 0 1-.77-.067L10.178 8.21c-.508-.506-1.393-.506-1.901 0a1.335 1.335 0 0 0-.393.95c0 .36.139.698.393.95v.001l5.61 5.61a.599.599 0 1 1-.848.847l-5.606-5.606c-.001 0-.002 0-.003-.002L5.848 9.375a1.349 1.349 0 0 0-1.902 0 1.348 1.348 0 0 0 0 1.901l1.582 1.582 5.61 5.61a.6.6 0 0 1-.848.848l-5.61-5.61c-.51-.508-1.393-.508-1.9 0a1.332 1.332 0 0 0-.394.95c0 .36.139.697.393.952l2.363 2.362c.002.001.002.002.002.003l3.52 3.52a.6.6 0 0 1-.848.847l-3.522-3.523h-.001a1.336 1.336 0 0 0-.95-.393 1.345 1.345 0 0 0-.949 2.295l6.779 6.78c3.715 3.713 9.327 5.598 13.49 1.434 3.527-3.528 4.21-7.13 2.086-11.015zM11.817 7.727c.06-.328.213-.64.466-.893.64-.64 1.755-.64 2.396 0l3.232 3.232c-.82.783-1.09 1.833-.764 2.992l-5.33-5.33z"></path><path d="M13.285.48l-1.916.881 2.37 2.837z"></path><path d="M21.719 1.361L19.79.501l-.44 3.697z"></path><path d="M16.502 3.298L15.481 0h2.043z"></path></g></svg></span></span></button><div class="clapUndo u-width60 u-round u-height32 u-absolute u-borderBox u-paddingRight5 u-transition--transform200Spring u-background--brandSageLighter js-clapUndo" style="top: 14px; padding: 2px;"><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon u-floatRight" data-action="multivote-undo" data-action-value="9c9fbbdc46cc"><span class="svgIcon svgIcon--removeThin svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M20.13 8.11l-5.61 5.61-5.609-5.61-.801.801 5.61 5.61-5.61 5.61.801.8 5.61-5.609 5.61 5.61.8-.801-5.609-5.61 5.61-5.61" fill-rule="evenodd"></path></svg></span></button></div></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-flexOrderNegative1 u-height20 u-marginBottom7"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-block u-marginAuto" data-action="show-recommends" data-action-value="9c9fbbdc46cc">1.1K</button></span></div></li><li class="u-textAlignCenter u-marginVertical10"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon" title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_share_widget"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"></path></svg></span></button></li><li class="u-textAlignCenter u-marginVertical10"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon" title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_share_widget"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"></path></svg></span></button></li><li class="u-textAlignCenter u-marginVertical10"><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/9c9fbbdc46cc" data-action-source="post_share_widget-----9c9fbbdc46cc---------------------bookmark_sidebar"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"></path></svg></span></span></button></li></ul></div></aside><div class="u-fixed u-bottom0 u-width100pct u-backgroundWhite u-boxShadowTop u-borderBox u-paddingTop10 u-paddingBottom10 u-zIndexMetabar u-xs-paddingLeft10 u-xs-paddingRight10 js-stickyFooter"><div class="u-maxWidth700 u-marginAuto u-flexCenter"><div class="u-fontSize16 u-flex1 u-flexCenter"><div class="u-flex0 u-inlineBlock u-paddingRight20 u-xs-paddingRight10"><a class="link u-baseColor--link avatar avatar--roundedRectangle" href="https://medium.com/google-cloud" title="Go to Google Cloud Platform - Community" aria-label="Go to Google Cloud Platform - Community"><img src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/1_FUjLiCANvATKeaJEeg20Rw(2).png" class="avatar-image avatar-image--smaller" alt="Google Cloud Platform - Community"></a></div><div class="u-flex1 u-inlineBlock"><div class="u-xs-hide">Never miss a story from<strong> Google Cloud Platform - Community</strong>, when you sign up for Medium. <a class="link u-baseColor--link link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@Medium/personalize-your-medium-experience-with-users-publications-tags-26a41ab1ee0c#.hx4zuv3mg" data-action-source="sticky_footer">Learn more</a></div><div class="u-xs-show">Never miss a story from<strong> Google Cloud Platform - Community</strong></div></div></div><div class="u-marginLeft50 u-xs-marginAuto"><button class="button button--primary button--dark is-active u-noUserSelect button--withChrome u-accentColor--buttonDark u-uiTextSemibold u-textUppercase u-fontSize12 button--followCollection js-followCollectionButton" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-collection" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/collection/google-cloud" data-action-source="sticky_footer----e52cf94d98af----------------------follow_metabar"><span class="button-label  button-defaultState js-buttonLabel">Get updates</span><span class="button-label button-activeState">Get updates</span></button></div></div></div><style class="js-collectionStyle">
.u-accentColor--borderLight {border-color: #02B875 !important;}
.u-accentColor--borderNormal {border-color: #02B875 !important;}
.u-accentColor--borderDark {border-color: #1C9963 !important;}
.u-accentColor--iconLight .svgIcon,.u-accentColor--iconLight.svgIcon {fill: #02B875 !important;}
.u-accentColor--iconNormal .svgIcon,.u-accentColor--iconNormal.svgIcon {fill: #02B875 !important;}
.u-accentColor--iconDark .svgIcon,.u-accentColor--iconDark.svgIcon {fill: #1C9963 !important;}
.u-accentColor--textNormal {color: #1C9963 !important;}
.u-accentColor--hoverTextNormal:hover {color: #1C9963 !important;}
.u-accentColor--textNormal.u-accentColor--textDarken:hover {color: #1C9963 !important;}
.u-accentColor--textDark {color: #1C9963 !important;}
.u-accentColor--backgroundLight {background-color: #02B875 !important;}
.u-accentColor--backgroundNormal {background-color: #02B875 !important;}
.u-accentColor--backgroundDark {background-color: #1C9963 !important;}
.u-accentColor--buttonDark {border-color: #1C9963 !important; color: #1C9963 !important;}
.u-accentColor--buttonDark:hover {border-color: #1C9963 !important;}
.u-accentColor--buttonDark .icon:before,.u-accentColor--buttonDark .svgIcon{color: #1C9963 !important; fill: #1C9963 !important;}
.u-accentColor--buttonNormal:not(.clapButton--largePill) {border-color: #02B875 !important; color: #1C9963 !important;}
.u-accentColor--buttonNormal:hover {border-color: #1C9963 !important;}
.u-accentColor--buttonNormal .icon:before,.u-accentColor--buttonNormal .svgIcon{color: #02B875 !important; fill: #02B875 !important;}
.u-accentColor--buttonNormal.button--filled .icon:before,.u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-accentColor--buttonDark.button--filled,.u-accentColor--buttonDark.button--withChrome.is-active,.u-accentColor--fillWhenActive.is-active {background-color: #1C9963 !important; border-color: #1C9963 !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-accentColor--buttonNormal.button--filled:not(.clapButton--largePill),.u-accentColor--buttonNormal.button--withChrome.is-active:not(.clapButton--largePill) {background-color: #02B875 !important; border-color: #02B875 !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.postArticle.is-withAccentColors .markup--user,.postArticle.is-withAccentColors .markup--query {color: #1C9963 !important;}
.u-accentColor--highlightFaint {background-color: rgba(233, 253, 240, 1) !important;}
.u-accentColor--highlightStrong.is-active .svgIcon {fill: rgba(125, 255, 179, 1) !important;}
.postArticle.is-withAccentColors .markup--quote.is-other {background-color: rgba(233, 253, 240, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-other {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(233, 253, 240, 1), rgba(233, 253, 240, 1));}
.postArticle.is-withAccentColors .markup--quote.is-me {background-color: rgba(173, 255, 207, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-me {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(173, 255, 207, 1), rgba(173, 255, 207, 1));}
.postArticle.is-withAccentColors .markup--quote.is-targeted {background-color: rgba(125, 255, 179, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-targeted {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(125, 255, 179, 1), rgba(125, 255, 179, 1));}
.postArticle.is-withAccentColors .markup--quote.is-selected {background-color: rgba(125, 255, 179, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-selected {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(125, 255, 179, 1), rgba(125, 255, 179, 1));}
.postArticle.is-withAccentColors .markup--highlight {background-color: rgba(125, 255, 179, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--highlight {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(125, 255, 179, 1), rgba(125, 255, 179, 1));}.u-baseColor--iconNormal.avatar-halo {fill: rgba(0, 0, 0, 0.4980392156862745) !important;}</style><style class="js-collectionStyleConstant">.u-imageBgColor {background-color: rgba(0, 0, 0, 0.24705882352941178);}
.u-imageSpectrum .u-baseColor--borderLight {border-color: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .u-baseColor--borderNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-baseColor--borderDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--iconLight .svgIcon,.u-imageSpectrum .u-baseColor--iconLight.svgIcon {fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-baseColor--iconNormal .svgIcon,.u-imageSpectrum .u-baseColor--iconNormal.svgIcon {fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--iconDark .svgIcon,.u-imageSpectrum .u-baseColor--iconDark.svgIcon {fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--textNormal {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--textNormal.u-baseColor--textDarken:hover {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--textDark {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--textDarker {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--backgroundLight {background-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-baseColor--backgroundNormal {background-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--backgroundDark {background-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonLight {border-color: rgba(255, 255, 255, 0.6980392156862745) !important; color: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-baseColor--buttonLight:hover {border-color: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .u-baseColor--buttonLight .icon:before,.u-imageSpectrum .u-baseColor--buttonLight .svgIcon {color: rgba(255, 255, 255, 0.8) !important; fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-baseColor--buttonDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonDark:hover {border-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonDark .icon:before,.u-imageSpectrum .u-baseColor--buttonDark .svgIcon {color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important; color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal:hover {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal .icon:before,.u-imageSpectrum .u-baseColor--buttonNormal .svgIcon {color: rgba(255, 255, 255, 0.9490196078431372) !important; fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--buttonDark.button--filled,.u-imageSpectrum .u-baseColor--buttonDark.button--withChrome.is-active {background-color: rgba(255, 255, 255, 1) !important; border-color: rgba(255, 255, 255, 1) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal.button--filled,.u-imageSpectrum .u-baseColor--buttonNormal.button--withChrome.is-active {background-color: rgba(255, 255, 255, 0.9490196078431372) !important; border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-baseColor--link {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--link.link--darkenOnHover:hover {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--darken:hover,.u-imageSpectrum .u-baseColor--link.link--darken:focus,.u-imageSpectrum .u-baseColor--link.link--darken:active {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--dark {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--dark.link--darken:hover,.u-imageSpectrum .u-baseColor--link.link--dark.link--darken:focus,.u-imageSpectrum .u-baseColor--link.link--dark.link--darken:active {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--darker {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--placeholderNormal ::-webkit-input-placeholder {color: rgba(255, 255, 255, 0.8);}
.u-imageSpectrum .u-baseColor--placeholderNormal ::-moz-placeholder {color: rgba(255, 255, 255, 0.8);}
.u-imageSpectrum .u-baseColor--placeholderNormal :-ms-input-placeholder {color: rgba(255, 255, 255, 0.8);}
.u-imageSpectrum .svgIcon--logoWordmark {stroke: none !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .svgIcon--logoMonogram {stroke: none !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum  .ui-h1,.u-imageSpectrum  .ui-h2,.u-imageSpectrum  .ui-h3,.u-imageSpectrum  .ui-h4,.u-imageSpectrum  .ui-brand1,.u-imageSpectrum  .ui-brand2,.u-imageSpectrum  .ui-captionStrong {color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum  .ui-body,.u-imageSpectrum  .ui-caps {color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum  .ui-summary,.u-imageSpectrum  .ui-caption {color: rgba(255, 255, 255, 0.8) !important; fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-accentColor--borderLight {border-color: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .u-accentColor--borderNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-accentColor--borderDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--iconLight .svgIcon,.u-imageSpectrum .u-accentColor--iconLight.svgIcon {fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-accentColor--iconNormal .svgIcon,.u-imageSpectrum .u-accentColor--iconNormal.svgIcon {fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--iconDark .svgIcon,.u-imageSpectrum .u-accentColor--iconDark.svgIcon {fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--textNormal {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--hoverTextNormal:hover {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--textNormal.u-accentColor--textDarken:hover {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--textDark {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--backgroundLight {background-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-accentColor--backgroundNormal {background-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--backgroundDark {background-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonDark:hover {border-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonDark .icon:before,.u-imageSpectrum .u-accentColor--buttonDark .svgIcon{color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal:not(.clapButton--largePill) {border-color: rgba(255, 255, 255, 0.8980392156862745) !important; color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal:hover {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal .icon:before,.u-imageSpectrum .u-accentColor--buttonNormal .svgIcon{color: rgba(255, 255, 255, 0.9490196078431372) !important; fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal.button--filled .icon:before,.u-imageSpectrum .u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-accentColor--buttonDark.button--filled,.u-imageSpectrum .u-accentColor--buttonDark.button--withChrome.is-active,.u-imageSpectrum .u-accentColor--fillWhenActive.is-active {background-color: rgba(255, 255, 255, 1) !important; border-color: rgba(255, 255, 255, 1) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal.button--filled:not(.clapButton--largePill),.u-imageSpectrum .u-accentColor--buttonNormal.button--withChrome.is-active:not(.clapButton--largePill) {background-color: rgba(255, 255, 255, 0.9490196078431372) !important; border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .postArticle.is-withAccentColors .markup--user,.u-imageSpectrum .postArticle.is-withAccentColors .markup--query {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--highlightFaint {background-color: rgba(255, 255, 255, 0.2) !important;}
.u-imageSpectrum .u-accentColor--highlightStrong.is-active .svgIcon {fill: rgba(255, 255, 255, 0.6) !important;}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-other {background-color: rgba(255, 255, 255, 0.2) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-other {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.2));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-me {background-color: rgba(255, 255, 255, 0.4) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-me {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.4));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-targeted {background-color: rgba(255, 255, 255, 0.6) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-targeted {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-selected {background-color: rgba(255, 255, 255, 0.6) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-selected {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--highlight {background-color: rgba(255, 255, 255, 0.6) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--highlight {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));}.u-resetSpectrum .u-tintBgColor {background-color: rgba(255, 255, 255, 1) !important;}.u-resetSpectrum .u-tintBgColor .u-fadeLeft:before {background-image: linear-gradient(to right, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0) 100%) !important;}.u-resetSpectrum .u-tintBgColor .u-fadeRight:after {background-image: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100%) !important;}
.u-resetSpectrum .u-baseColor--borderLight {border-color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--borderNormal {border-color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--borderDark {border-color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--iconLight .svgIcon,.u-resetSpectrum .u-baseColor--iconLight.svgIcon {fill: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--iconNormal .svgIcon,.u-resetSpectrum .u-baseColor--iconNormal.svgIcon {fill: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--iconDark .svgIcon,.u-resetSpectrum .u-baseColor--iconDark.svgIcon {fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--textNormal {color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--textNormal.u-baseColor--textDarken:hover {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--textDark {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--textDarker {color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--backgroundLight {background-color: rgba(0, 0, 0, 0.09803921568627451) !important;}
.u-resetSpectrum .u-baseColor--backgroundNormal {background-color: rgba(0, 0, 0, 0.2) !important;}
.u-resetSpectrum .u-baseColor--backgroundDark {background-color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonLight {border-color: rgba(0, 0, 0, 0.2980392156862745) !important; color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonLight:hover {border-color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonLight .icon:before,.u-resetSpectrum .u-baseColor--buttonLight .svgIcon {color: rgba(0, 0, 0, 0.2980392156862745) !important; fill: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonDark {border-color: rgba(0, 0, 0, 0.6) !important; color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--buttonDark:hover {border-color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--buttonDark .icon:before,.u-resetSpectrum .u-baseColor--buttonDark .svgIcon {color: rgba(0, 0, 0, 0.6) !important; fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal {border-color: rgba(0, 0, 0, 0.4980392156862745) !important; color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal:hover {border-color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal .icon:before,.u-resetSpectrum .u-baseColor--buttonNormal .svgIcon {color: rgba(0, 0, 0, 0.4980392156862745) !important; fill: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonDark.button--filled,.u-resetSpectrum .u-baseColor--buttonDark.button--withChrome.is-active {background-color: rgba(0, 0, 0, 0.2980392156862745) !important; border-color: rgba(0, 0, 0, 0.2980392156862745) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal.button--filled,.u-resetSpectrum .u-baseColor--buttonNormal.button--withChrome.is-active {background-color: rgba(0, 0, 0, 0.2) !important; border-color: rgba(0, 0, 0, 0.2) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-baseColor--link {color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--link.link--darkenOnHover:hover {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--link.link--darken:hover,.u-resetSpectrum .u-baseColor--link.link--darken:focus,.u-resetSpectrum .u-baseColor--link.link--darken:active {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--link.link--dark {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--link.link--dark.link--darken:hover,.u-resetSpectrum .u-baseColor--link.link--dark.link--darken:focus,.u-resetSpectrum .u-baseColor--link.link--dark.link--darken:active {color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--link.link--darker {color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--placeholderNormal ::-webkit-input-placeholder {color: rgba(0, 0, 0, 0.2980392156862745);}
.u-resetSpectrum .u-baseColor--placeholderNormal ::-moz-placeholder {color: rgba(0, 0, 0, 0.2980392156862745);}
.u-resetSpectrum .u-baseColor--placeholderNormal :-ms-input-placeholder {color: rgba(0, 0, 0, 0.2980392156862745);}
.u-resetSpectrum .svgIcon--logoWordmark {stroke: none !important; fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .svgIcon--logoMonogram {stroke: none !important; fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum  .ui-h1,.u-resetSpectrum  .ui-h2,.u-resetSpectrum  .ui-h3,.u-resetSpectrum  .ui-h4,.u-resetSpectrum  .ui-brand1,.u-resetSpectrum  .ui-brand2,.u-resetSpectrum  .ui-captionStrong {color: rgba(0, 0, 0, 0.8) !important; fill: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum  .ui-body,.u-resetSpectrum  .ui-caps {color: rgba(0, 0, 0, 0.6) !important; fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum  .ui-summary,.u-resetSpectrum  .ui-caption {color: rgba(0, 0, 0, 0.2980392156862745) !important; fill: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-accentColor--borderLight {border-color: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--borderNormal {border-color: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--borderDark {border-color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--iconLight .svgIcon,.u-resetSpectrum .u-accentColor--iconLight.svgIcon {fill: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--iconNormal .svgIcon,.u-resetSpectrum .u-accentColor--iconNormal.svgIcon {fill: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--iconDark .svgIcon,.u-resetSpectrum .u-accentColor--iconDark.svgIcon {fill: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--textNormal {color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--hoverTextNormal:hover {color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--textNormal.u-accentColor--textDarken:hover {color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--textDark {color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--backgroundLight {background-color: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--backgroundNormal {background-color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--backgroundDark {background-color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark {border-color: rgba(0, 171, 107, 1) !important; color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark:hover {border-color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark .icon:before,.u-resetSpectrum .u-accentColor--buttonDark .svgIcon{color: rgba(28, 153, 99, 1) !important; fill: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal:not(.clapButton--largePill) {border-color: rgba(2, 184, 117, 1) !important; color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal:hover {border-color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal .icon:before,.u-resetSpectrum .u-accentColor--buttonNormal .svgIcon{color: rgba(0, 171, 107, 1) !important; fill: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal.button--filled .icon:before,.u-resetSpectrum .u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark.button--filled,.u-resetSpectrum .u-accentColor--buttonDark.button--withChrome.is-active,.u-resetSpectrum .u-accentColor--fillWhenActive.is-active {background-color: rgba(28, 153, 99, 1) !important; border-color: rgba(28, 153, 99, 1) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal.button--filled:not(.clapButton--largePill),.u-resetSpectrum .u-accentColor--buttonNormal.button--withChrome.is-active:not(.clapButton--largePill) {background-color: rgba(0, 171, 107, 1) !important; border-color: rgba(0, 171, 107, 1) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .postArticle.is-withAccentColors .markup--user,.u-resetSpectrum .postArticle.is-withAccentColors .markup--query {color: rgba(0, 171, 107, 1) !important;}</style><div class="highlightMenu highlightMenu--active" data-action-scope="_actionscope_3" style="left: 540px; top: 181px;"><div class="highlightMenu-inner"><div class="buttonSet"><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--highlightMenu u-accentColor--highlightStrong js-highlightMenuQuoteButton" data-action="sign-up-prompt" data-sign-in-action="quote" data-requires-token="true" data-skip-onboarding="true" data-redirect-type="quote" data-action-source="quote_menu--------------------------highlight_text"><span class="svgIcon svgIcon--highlighter svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M13.7 15.964l5.204-9.387-4.726-2.62-5.204 9.387 4.726 2.62zm-.493.885l-1.313 2.37-1.252.54-.702 1.263-3.796-.865 1.228-2.213-.202-1.35 1.314-2.37 4.722 2.616z" fill-rule="evenodd"></path></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--highlightMenu" data-action="sign-up-prompt" data-sign-in-action="quote-respond" data-redirect="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc" data-skip-onboarding="true" data-action-source="quote_menu--------------------------respond_text"><span class="svgIcon svgIcon--responseFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M19.074 21.117c-1.244 0-2.432-.37-3.532-1.096a7.792 7.792 0 0 1-.703-.52c-.77.21-1.57.32-2.38.32-4.67 0-8.46-3.5-8.46-7.8C4 7.7 7.79 4.2 12.46 4.2c4.662 0 8.457 3.5 8.457 7.803 0 2.058-.85 3.984-2.403 5.448.023.17.06.35.118.55.192.69.537 1.38 1.026 2.04.15.21.172.48.058.7a.686.686 0 0 1-.613.38h-.03z" fill-rule="evenodd"></path></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--highlightMenu" data-action="twitter" data-action-source="quote_menu" data-skip-onboarding="true"><span class="svgIcon svgIcon--twitterFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><path d="M21.725 5.338c-.744.47-1.605.804-2.513 1.006a3.978 3.978 0 0 0-2.942-1.293c-2.22 0-4.02 1.81-4.02 4.02 0 .32.034.63.07.94-3.31-.18-6.27-1.78-8.255-4.23a4.544 4.544 0 0 0-.574 2.01c.04 1.43.74 2.66 1.8 3.38-.63-.01-1.25-.19-1.79-.5v.08c0 1.93 1.38 3.56 3.23 3.95-.34.07-.7.12-1.07.14-.25-.02-.5-.04-.72-.07.49 1.58 1.97 2.74 3.74 2.8a8.49 8.49 0 0 1-5.02 1.72c-.3-.03-.62-.04-.93-.07A11.447 11.447 0 0 0 8.88 21c7.386 0 11.43-6.13 11.414-11.414.015-.21.01-.38 0-.578a7.604 7.604 0 0 0 2.01-2.08 7.27 7.27 0 0 1-2.297.645 3.856 3.856 0 0 0 1.72-2.23"></path></svg></span></button><div class="buttonSet-separator"></div><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--highlightMenu" data-action="sign-up-prompt" data-sign-in-action="highlight" data-redirect="https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc" data-skip-onboarding="true" data-action-source="quote_menu--------------------------privatenote_text"><span class="svgIcon svgIcon--privatenoteFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"><g fill-rule="evenodd"><path d="M17.662 4.552H7.346A4.36 4.36 0 0 0 3 8.898v5.685c0 2.168 1.614 3.962 3.697 4.28v2.77c0 .303.35.476.59.29l3.904-2.994h6.48c2.39 0 4.35-1.96 4.35-4.35V8.9c0-2.39-1.95-4.346-4.34-4.346zM16 14.31a.99.99 0 0 1-1.003.99h-4.994C9.45 15.3 9 14.85 9 14.31v-3.02a.99.99 0 0 1 1-.99v-.782a2.5 2.5 0 0 1 2.5-2.51c1.38 0 2.5 1.13 2.5 2.51v.782c.552.002 1 .452 1 .99v3.02z"></path><path d="M14 9.81c0-.832-.674-1.68-1.5-1.68-.833 0-1.5.84-1.5 1.68v.49h3v-.49z"></path></g></svg></span></button></div></div><div class="highlightMenu-arrowClip"><span class="highlightMenu-arrow"></span></div></div></div></div></div><div class="loadingBar"></div><script>// <![CDATA[
window["obvInit"] = function (opt_embedded) {window["obvInit"]["embedded"] = opt_embedded; window["obvInit"]["ready"] = true;}
// ]]></script><script>// <![CDATA[
var GLOBALS = {"audioUrl":"https://d1fcbxp97j4nb2.cloudfront.net","baseUrl":"https://medium.com","buildLabel":"35307","currentUser":{"userId":"lo_dnt_IwTGKK4Ik4yn","isVerified":false,"subscriberEmail":"","hasPastMemberships":false,"isEnrolledInHightower":false,"isEligibleForHightower":false,"hightowerLastLockedAt":0,"isWriterProgramEnrolled":false,"isWriterProgramInvited":false,"isWriterProgramOptedOut":false,"writerProgramVersion":0,"writerProgramEnrolledAt":0},"currentUserHasUnverifiedEmail":false,"isAuthenticated":false,"isCurrentUserVerified":false,"language":"en-us","miroUrl":"https://cdn-images-1.medium.com","moduleUrls":{"base":"https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.DriHnOl5qMKpR8tHbofmcA.js","common-async":"https://cdn-static-1.medium.com/_/fp/gen-js/main-common-async.bundle.ybn8pINumuGVGI-wY651qA.js","hightower":"https://cdn-static-1.medium.com/_/fp/gen-js/main-hightower.bundle.RdmouXxzpnD6Di-AAPUFXg.js","home-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-home-screens.bundle.C1bohrv3d8mYSVO18qh1Ow.js","misc-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-misc-screens.bundle.0Ri1F4jkO2OK26eWElMpZg.js","notes":"https://cdn-static-1.medium.com/_/fp/gen-js/main-notes.bundle.4Hcf4I6qAbwXHFjEyhPyAg.js","payments":"https://cdn-static-1.medium.com/_/fp/gen-js/main-payments.bundle.5yJlJWytjSGaFCSBc6yR4A.js","posters":"https://cdn-static-1.medium.com/_/fp/gen-js/main-posters.bundle.BW0TiDBWHCWGHNn1dQ4L_w.js","power-readers":"https://cdn-static-1.medium.com/_/fp/gen-js/main-power-readers.bundle.I2GpRgPVJYyqYWo-_Rs2dA.js","pubs":"https://cdn-static-1.medium.com/_/fp/gen-js/main-pubs.bundle.YDIr1fQWRjDWZWEmhruWzQ.js","stats":"https://cdn-static-1.medium.com/_/fp/gen-js/main-stats.bundle.gQ-c6dyV_oLWqn-obN1SYg.js"},"previewConfig":{"weightThreshold":1,"weightImageParagraph":0.51,"weightIframeParagraph":0.8,"weightTextParagraph":0.08,"weightEmptyParagraph":0,"weightP":0.003,"weightH":0.005,"weightBq":0.003,"minPTextLength":60,"truncateBoundaryChars":20,"detectTitle":true,"detectTitleLevThreshold":0.15},"productName":"Medium","supportsEdit":true,"termsUrl":"//medium.com/policy/9db0094a1e0f","textshotHost":"textshot.medium.com","transactionId":"1539586053466:dc90fefd3641","useragent":{"browser":"chrome","family":"chrome","os":"mac","version":69,"supportsDesktopEdit":true,"supportsInteract":true,"supportsView":true,"isMobile":false,"isTablet":false,"isNative":false,"supportsFileAPI":true,"isTier1":true,"clientVersion":"","unknownParagraphsBad":false,"clientChannel":"","supportsRealScrollEvents":true,"supportsVhUnits":true,"ruinsViewportSections":false,"supportsHtml5Video":true,"supportsMagicUnderlines":true,"isWebView":false,"isFacebookWebView":false,"supportsProgressiveMedia":true,"supportsPromotedPosts":true,"isBot":false,"isNativeIphone":false,"supportsCssVariables":true,"supportsVideoSections":true,"emojiSupportLevel":5,"isSearchBot":false,"isSyndicationBot":false,"isNativeAndroid":false,"supportsScrollableMetabar":true},"variants":{"allow_access":true,"allow_signup":true,"allow_test_auth":"disallow","signin_services":"twitter,facebook,google,email,google-fastidv","signup_services":"twitter,facebook,google,email,google-fastidv","android_rating_prompt_recommend_threshold":5,"google_sign_in_android":true,"reengagement_notification_duration":3,"browsable_stream_config_bucket":"curated-topics","enable_dedicated_series_tab_api_ios":true,"enable_post_import":true,"available_monthly_plan":"60e220181034","available_annual_plan":"2c754bcc2995","disable_ios_resume_reading_toast":true,"is_not_medium_subscriber":true,"glyph_font_set":"m2","enable_branding":true,"enable_branding_fonts":true,"enable_paypal_delinquency_handling":true,"enable_post_monger_v2":true,"enable_post_monger_v3":true,"enable_star_meter_ui":true,"max_premium_content_per_user_under_metering":3,"enable_metered_out_email":true,"enable_automated_mission_control_triggers":true,"enable_top_stories_for_you":true,"enable_ios_member_post_labeling":true,"enable_lite_profile":true,"enable_signin_wall_custom_domain":true,"app_download_email_template":"control","enable_topic_lifecycle_email":true,"enable_marketing_emails":true,"enable_truncated_rss_for_tags_and_topics":true,"enable_rex_service_featured_posts":true,"enable_parsely":true,"enable_branch_io":true,"enable_synchronous_parsely":true,"enable_post_stats_page":true,"enable_ios_post_stats":true,"enable_reader_interests":true,"enable_post_stats_page_new_milestones":true,"enable_prepublish_flow_2_everyone":true,"enable_lite_topics":true,"enable_lite_stories":true,"enable_lite_billing_history":true,"redis_read_write_splitting":true,"enable_tipalti_onboarding":true,"enable_sift_integration":true,"enable_sift_science_webhook":true,"enable_quality_assurance_queue":true,"enable_writer_controls":true,"enable_partner_dashboard_tax_link":true},"xsrfToken":"","iosAppId":"828256236","supportEmail":"yourfriends@medium.com","fp":{"/icons/monogram-mask.svg":"https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg","/icons/favicon-dev-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-dev-editor.YKKRxBO8EMvIqhyCwIiJeQ.ico","/icons/favicon-hatch-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-hatch-editor.BuEyHIqlyh2s_XEk4Rl32Q.ico","/icons/favicon-medium-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrl":"https://medium.com","imageUploadSizeMb":25,"isAuthDomainRequest":true,"algoliaApiEndpoint":"https://MQ57UUUQZ2-dsn.algolia.net","algoliaAppId":"MQ57UUUQZ2","algoliaSearchOnlyApiKey":"394474ced050e3911ae2249ecc774921","iosAppStoreUrl":"https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8","iosAppLinkBaseUrl":"medium:","algoliaIndexPrefix":"medium_","androidPlayStoreUrl":"https://play.google.com/store/apps/details?id=com.medium.reader","googleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","androidPackage":"com.medium.reader","androidPlayStoreMarketScheme":"market://details?id=com.medium.reader","googleAuthUri":"https://accounts.google.com/o/oauth2/auth","androidScheme":"medium","layoutData":{"useDynamicScripts":false,"googleAnalyticsTrackingCode":"UA-24232453-2","jsShivUrl":"https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js","useDynamicCss":false,"faviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico","faviconImageId":"1*8I-HPL0bfoIzGied-dzOvA.png","fontSets":[{"id":8,"url":"https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css"},{"id":11,"url":"https://glyph.medium.com/css/m2.css"},{"id":9,"url":"https://glyph.medium.com/css/mkt.css"},{"id":10,"url":"https://glyph.medium.com/css/elv8.css"}],"editorFaviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium-editor.3Y6xpZ-0FSdWDnPM3hSBIA.ico","glyphUrl":"https://glyph.medium.com"},"authBaseUrlRev":"moc.muidem//:sptth","isDnt":true,"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","archiveUploadSizeMb":100,"paymentData":{"currencies":{"1":{"label":"US Dollar","external":"usd"}},"countries":{"1":{"label":"United States of America","external":"US"}},"accountTypes":{"1":{"label":"Individual","external":"individual"},"2":{"label":"Company","external":"company"}}},"previewConfig2":{"weightThreshold":1,"weightImageParagraph":0.05,"raiseImage":true,"enforceHeaderHierarchy":true,"isImageInsetRight":true},"isAmp":false,"iosScheme":"medium","isSwBoot":false,"facebook":{"key":"542599432471018","namespace":"medium-com","scope":{"default":["public_profile","email"],"connect":["public_profile","email"],"login":["public_profile","email"],"share":["public_profile","email"]}},"editorsPicksTopicId":"3985d2a191c5","popularOnMediumTopicId":"9d34e48ecf94","memberContentTopicId":"13d7efd82fb2","audioContentTopicId":"3792abbd134","brandedSequenceId":"7d337ddf1941","isDoNotAuth":false,"goldfinchUrl":"https://goldfinch.medium.com","buggle":{"url":"https://buggle.medium.com","videoUrl":"https://cdn-videos-1.medium.com","audioUrl":"https://cdn-audio-1.medium.com"},"referrerType":4,"isMeteredOut":false,"meterConfig":{"maxUnlockCount":3,"windowLength":"MONTHLY"},"partnerProgramEmail":"partnerprogram@medium.com","userResearchPrompts":[{"promptId":"lo_post_page_4","type":0,"url":"www.calendly.com"},{"promptId":"lo_home_page","type":1,"url":"www.calendly.com"},{"promptId":"lo_profile_page","type":2,"url":"www.calendly.com"}],"recaptchaKey":"6LdAokEUAAAAAC7seICd4vtC8chDb3jIXDQulyUJ","paypalClientMode":"production","signinWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"countryCode":"US","bypassMeter":false,"branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm"}
// ]]></script><script charset="UTF-8" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/main-base.bundle.DriHnOl5qMKpR8tHbofmcA.js" async=""></script><script>// <![CDATA[
window["obvInit"]({"value":{"id":"9c9fbbdc46cc","versionId":"b691937615fd","creatorId":"e9c35a095d0d","creator":{"userId":"e9c35a095d0d","name":"Will Fuks","username":"willian.fuks","createdAt":1446065422885,"lastPostCreatedAt":1521650887588,"imageId":"1*KKOPcg6qjT9LWFRohbOwjQ.jpeg","backgroundImageId":"","bio":"Working as a Data Scientist at Dafiti Group","twitterScreenName":"","socialStats":{"userId":"e9c35a095d0d","usersFollowedCount":30,"usersFollowedByCount":79,"type":"SocialStats"},"social":{"userId":"lo_dnt_IwTGKK4Ik4yn","targetUserId":"e9c35a095d0d","type":"Social"},"facebookAccountId":"","allowNotes":1,"mediumMemberAt":0,"isNsfw":false,"isPartnerProgramEnrolled":false,"type":"User"},"homeCollection":{"id":"e52cf94d98af","name":"Google Cloud Platform - Community","slug":"google-cloud","tags":["GOOGLE CLOUD PLATFORM","DEVELOPERS","CLOUD COMPUTING","DEVOPS","TECHNOLOGY"],"creatorId":"a535baed6389","description":"A collection of technical articles published or curated by Google Cloud Platform Developer Advocates. The views expressed are those of the authors and don't necessarily reflect those of Google.","shortDescription":"A collection of technical articles published or curated by…","image":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":16105,"activeAt":1539008070407},"virtuals":{"permissions":{"canPublish":false,"canPublishAll":false,"canRepublish":false,"canRemove":false,"canManageAll":false,"canSubmit":false,"canEditPosts":false,"canAddWriters":false,"canViewStats":false,"canSendNewsletter":false,"canViewLockedPosts":false,"canViewCloaked":false,"canEditOwnPosts":false,"canBeAssignedAuthor":false,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false},"isSubscribed":false,"isNewsletterSubscribed":false,"memberOfMembershipPlanId":"","isEnrolledInHightower":false,"isEligibleForHightower":false},"logo":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"twitterUsername":"gcpcloud","facebookPageName":"googlecloud","collectionMastheadId":"536cf63fce6","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":3,"layout":4,"number":10,"postIds":["2b0031e2c3b5","57e4af9b10da","429775bd6d11","79dc217b916","3e68396378b4","3ba9a8d8fc03","a76e72e45026","426e5f4c8a36","9870d41fcee3","cf753fa173a4"]}},{"type":1,"postListMetadata":{"source":2,"layout":4,"number":7,"postIds":[],"sectionHeader":"Trending"}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":11,"postIds":[],"sectionHeader":"Latest"}},{"type":1,"postListMetadata":{"source":1,"layout":6,"number":5,"postIds":[]}}],"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF02B875","point":0},{"color":"#FF00AB6B","point":0.1},{"color":"#FF1C9963","point":0.2},{"color":"#FF092E20","point":1}],"backgroundColor":"#FFFFFFFF"},"highlightSpectrum":{"colorPoints":[{"color":"#FFFFFFFF","point":0},{"color":"#FFE9FDF0","point":0.1},{"color":"#FFE2FAEE","point":0.2},{"color":"#FFADFFCF","point":0.6},{"color":"#FF7DFFB3","point":1}],"backgroundColor":"#FFFFFFFF"}},"navItems":[{"type":4,"title":"This Week in GCP","url":"https://medium.com/google-cloud/weekly/home","topicId":"af575ce9e5c7","source":"topicId"},{"type":1,"title":"Containers","tagSlug":"kubernetes","url":"https://medium.com/google-cloud/tagged/kubernetes","source":"tagSlug"},{"type":1,"title":"Virtualization","tagSlug":"google-compute-engine","url":"https://medium.com/google-cloud/tagged/google-compute-engine","source":"tagSlug"},{"type":1,"title":"Platform as a Service","tagSlug":"google-app-engine","url":"https://medium.com/google-cloud/tagged/google-app-engine","source":"tagSlug"},{"type":1,"title":"Data","tagSlug":"bigquery","url":"https://medium.com/google-cloud/tagged/bigquery","source":"tagSlug"},{"type":1,"title":"Machine Learning","tagSlug":"machine-learning","url":"https://medium.com/google-cloud/tagged/machine-learning","source":"tagSlug"},{"type":3,"title":"More","url":"https://cloud.google.com/blog/"}],"colorBehavior":1,"instantArticlesState":0,"acceleratedMobilePagesState":0,"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5},"type":"Collection"},"homeCollectionId":"e52cf94d98af","title":"How We Implemented a Fully Serverless Recommender System Using GCP","detectedLanguage":"en","latestVersion":"b691937615fd","latestPublishedVersion":"b691937615fd","hasUnpublishedEdits":false,"latestRev":8486,"createdAt":1507900522596,"updatedAt":1529507198817,"acceptedAt":0,"firstPublishedAt":1513087982577,"latestPublishedAt":1515719493139,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"Just recently we were faced with a quite exciting challenge by our company and I’d like to take the opportunity to write down about it and…","bodyModel":{"paragraphs":[{"name":"11c0","type":3,"text":"How We Implemented a Fully Serverless Recommender System Using GCP","markups":[]},{"name":"f59b","type":1,"text":"Just recently we were faced with a quite exciting challenge by our company and I’d like to take the opportunity to write down about it and what we’ve learned along the way.","markups":[]},{"name":"bcb3","type":1,"text":"Our main goal was to work together with our central team at GFG Group to develop a Recommender System capable of interacting effectively with our customers for our different ventures, with one catch: it should be built on top of Apache-Spark; reason being that the team already had a know-how on Spark systems and its management in production environment.","markups":[{"type":3,"start":60,"end":69,"href":"http://global-fashion-group.com/","title":"","rel":"","anchorType":0},{"type":3,"start":229,"end":241,"href":"https://spark.apache.org/","title":"","rel":"","anchorType":0}]},{"name":"2e0c","type":1,"text":"So, in this post, I’d like to write about what implementation we came up with. We had two months to implement something and the final solution ended up being a fully Serverless system built on top of Google Cloud Platform (GCP).","markups":[]},{"name":"4727","type":1,"text":"The final algorithm implemented is known as “DIMSUM” and is the one currently running at Twitter as well. Here’s an overview of the implemented architecture of what we’ll be discussing in this post:","markups":[]},{"name":"26db","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*axNxklrne21SY_N6pyXp-w.png","originalWidth":795,"originalHeight":520}},{"name":"55b2","type":1,"text":"In a nutshell: AppEngine orchestrates calls (triggered by crons) that loads data to our Cloud Storage, builds a Dataproc cluster, process our main algorithm, saves results to Storage again and finally we have a Dataflow pipeline execution that loads the results to Datastore so that Appengine has direct access and can serve recommendations to our customers.","markups":[]},{"name":"4171","type":1,"text":"Ok, that was quite of a hell of a nutshell.","markups":[]},{"name":"1447","type":1,"text":"Don’t worry about all these operations for now, notice though that we have different colors connecting different elements and those will be discussed separately as they constitute the main blocks of our system. Themes covered in this post will be:","markups":[]},{"name":"1426","type":10,"text":"Understanding the Algorithm","markups":[]},{"name":"cb1e","type":10,"text":"Getting the Data","markups":[]},{"name":"786d","type":10,"text":"Cron Jobs in AppEngine","markups":[]},{"name":"c8ec","type":10,"text":"Dataproc Execution","markups":[]},{"name":"efba","type":10,"text":"Pipeline Process with Dataflow","markups":[]},{"name":"fb63","type":10,"text":"Making Recommendations","markups":[]},{"name":"2d25","type":10,"text":"Costs Estimation","markups":[]},{"name":"d48a","type":10,"text":"Future Work","markups":[]},{"name":"3edd","type":10,"text":"Conclusion","markups":[]},{"name":"17a6","type":1,"text":"With no further ado, let’s go!","markups":[]},{"name":"f6d5","type":3,"text":"1. Understanding the Algorithm (DIMSUM)","markups":[]},{"name":"7905","type":1,"text":"Our first approach was trying to implement the neighborhood algorithm, a very successful implementation very popular in the Recommender Systems literature, specially in the field of Collaborative Filtering.","markups":[{"type":3,"start":47,"end":69,"href":"http://yifanhu.net/PUB/cf.pdf","title":"","rel":"","anchorType":0},{"type":3,"start":182,"end":205,"href":"https://en.wikipedia.org/wiki/Collaborative_filtering","title":"","rel":"","anchorType":0}]},{"name":"2d9d","type":1,"text":"It works by basically finding similarity scores between different items (and items here can be products, customers, music, anything in which you can extract some sense of correlation between elements) and uses these scores to predict how much customers will enjoy a given each item.","markups":[]},{"name":"5824","type":1,"text":"In eCommerce, for the most part, we don’t know exactly whether a given customer liked an item or not; that means that all we can do is compute general interactions from customers such as “how many times he or she visited this product? Did he put this to basket? Did she purchased it? If so, we try to add values that indicates some sense of likability for that particular item, as implicit as it may be, we still try to extract signal from those actions.","markups":[]},{"name":"fa90","type":1,"text":"To make it more clear, let’s say we observed 4 customers and their interactions with 2 distinct products (1 means customer browsed the product page):","markups":[]},{"name":"043a","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*kDtbdE5olB81in5lrDICQQ.png","originalWidth":510,"originalHeight":183}},{"name":"dca3","type":1,"text":"To find a correlation between these two shoes, we use the cosine similarity given by the formula:","markups":[]},{"name":"df73","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*IPV2VURSJG13NAa4-N7Blw.png","originalWidth":557,"originalHeight":182}},{"name":"dc31","type":1,"text":"All the equation is saying is the similarity metric is the summation of intersections between products for each customer normalized by those interactions.","markups":[]},{"name":"5176","type":1,"text":"If, say, every single customer interacts with both products then the result will be exactly 1 which means both products are 100% similar. Customers who likes one are expected to like just the same the other; if they interact with just one of the skus and not the other then final result will be 0 which leads to the notion that if a customer likes one there’s no expectation that he or she will like the other.","markups":[]},{"name":"07f2","type":1,"text":"In the previous example we have:","markups":[]},{"name":"1850","type":1,"text":"A = [1, 0, 1, 1]; B = [0, 0, 1, 1]","markups":[{"type":1,"start":0,"end":1},{"type":1,"start":18,"end":19}]},{"name":"d488","type":1,"text":"Applying the similarity score equation we get:","markups":[]},{"name":"7357","type":1,"text":"similarity = (1 * 0 + 0 * 0 + 1 * 1 + 1 * 1) / √(1² + 0² + 1² + 1²) * √(0² + 0² + 1² + 1²) ≈ 0.82","markups":[{"type":2,"start":0,"end":10}]},{"name":"3274","type":1,"text":"As you can see, it’s literally an extraction of intersections between products normalized by the all the values on that product.","markups":[]},{"name":"5f09","type":1,"text":"With these similarities scores we can make predictions of how much customers might enjoy items not seem so far. Let’s take our previous example: if we know that the similarity between red shoes and beige is 82% and suppose we know a customer liked one of them; we can infer that there’s a 82% chance that he will like the other given their similarity score. We can express this notion of making predictions to new items mathematically by:","markups":[]},{"name":"4279","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*jAXRKAqL8RGlF2fcxf61iQ.png","originalWidth":307,"originalHeight":104}},{"name":"f90e","type":1,"text":"Time to introduce some notation: in the above equation, “u” identifies a given customer at our website; “i” and “j” are identifiers for items, the “r” is a metric that tells us how user u interacted with an item so in our previous example it’s the 1s and 0s. The “s” is the similarity we just computed, so “s_ij” is the similarity between item “i” with “j” (in our example, “i” could be the red shoes and “j” the beige one).","markups":[{"type":2,"start":186,"end":187}]},{"name":"7f0d","type":1,"text":"So all the formula is saying: to predict how much user “u” will like item “i”, expressed by the “r” with the “^” symbol, we observe all items that he or she interacted with; we observe the similarities between those and the one we want to make the prediction, multiply all the interactions by the similarities and sum everything up (the division is a way of normalizing the equation and in practice we don’t apply it as recommended by the literature). I know it sounds confusing, but given that an image is worth a thousand words, here’s a depiction of how it works:","markups":[]},{"name":"dbaa","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*hGNfIt4q9lK588AQE_eMhg.png","originalWidth":1020,"originalHeight":330}},{"name":"b1ac","type":1,"text":"In this case, our customer interacted “1.5” points with first sku, 2 with second and 2.5 with third. The similarities between those same products and the one we want to make the prediction is 56%, 21% and 67% respectively. Therefore, for us to predict how much this customer will enjoy the fourth product we multiply the interactions and similarities of each sku we know about the customer, sum everything up and normalize by the similarity scores which results in 2.42. This is an expectation of how much we predict our customer will enjoy this particular item.","markups":[]},{"name":"2449","type":1,"text":"And that’s pretty much it! In summary, neighborhood observes all interactions of customers and items and extract these similarities metrics between them which allows us to predict how customers will enjoy new items.","markups":[]},{"name":"1f8d","type":1,"text":"There’s one problem though and here is where the challenge begins: at Dafiti (one of the ventures from GFG), we have millions of customers visiting our website everyday and they can potentially interact with some other hundreds of thousands of available products.","markups":[]},{"name":"ab37","type":1,"text":"If you take Dafiti’s data and try to find all interactions of customers and items and then try to build all similarities between all products you’ll find your computer/cluster exploding and burning into flames after a few seconds in. And if you do that in some shared cluster make sure to leave the building ASAP (remove digital prints before doing so*).","markups":[]},{"name":"56de","type":1,"text":"Well, as it turns out, there’s smarter ways of doing it and here’s where we started making some considerable progress in our challenge.","markups":[]},{"name":"5e5a","type":13,"text":"1.1 The DIMSUM Approach","markups":[]},{"name":"edfc","type":1,"text":"As using Spark was a mandatory request for this project, we searched for ways on how to implement cosines computation in a MapReduce fashion; what we found is that the framework is basically a pipeline of steps where you can map your input value to new values and reduce it (if you ever need so) to aggregate results into some final metric. Main idea therefore is: apply map to transform data and if you need some aggregation (you normally do) then use some reduce operation.","markups":[]},{"name":"e0c2","type":1,"text":"And if you think it through, you’ll end up realizing that it’s actually quite simple to implement some neighborhood approach in a MapReduce framework: we have our training data which contains users and their interactions with products (we’ll discuss more about those later) so we can arrange it like:","markups":[]},{"name":"7b52","type":8,"text":"{“user”: “user_0”, “items”: [{“sku”: “sku_0”, “r”: 1},\n                             {“sku”: “sku_1”, “r”: 2}]}\n{“user”: “user_1”, “items”: [{“sku”: “sku_0”, “r”: 2},\n                             {“sku”: “sku_2”, “r”: 1}]}","markups":[]},{"name":"422d","type":8,"text":"(...)","markups":[]},{"name":"ad94","type":8,"text":"{“user”: “user_m”, “items”: [{“sku”: “sku_0”, “r”: 2},\n                             {“sku”: “sku_n”, “r”: 1}]}","markups":[]},{"name":"891f","type":1,"text":"In other words, we can arrange it to m users and their interactions for potentially n items (remember that we do not save “zero” values as this would consume huge amounts of memory unnecessarily).","markups":[{"type":2,"start":37,"end":38},{"type":2,"start":84,"end":85}]},{"name":"b09b","type":1,"text":"As the cosine metric looks for correlations between products on a customer level (if a customer interacts with both items then their intersection grows), we can use this simple algorithm to extract similarities:","markups":[]},{"name":"6c8d","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*DlaWO0yR3UGrxbE2roOtzg.png","originalWidth":526,"originalHeight":272}},{"name":"8346","type":1,"text":"Notice that this algorithm is not extracting the cosine similarity per say as it’s not normalizing by the norm of each sku vector of interactions; in practice, we still need to make this normalization (this is quite simple and we’ll show you how we did it). Visually, it’s something like this:","markups":[]},{"name":"9d20","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*2xxu6CgUdqC_pi8Sli83Hg.png","originalWidth":667,"originalHeight":220}},{"name":"3239","type":1,"text":"For each customer we have this double “for” corresponding to each “ai” and “aj” where we scan through the vector emitting ai * aj.","markups":[]},{"name":"c2ed","type":1,"text":"We took this algorithm from Reza Zadeh’s paper discussing the DIMSUM implementation at Twitter (it’s quite an amazing read and if you are a Data Scientist or enjoys this area in computer science I highly recommend the read, it’s certainly worth it).","markups":[{"type":3,"start":28,"end":46,"href":"https://stanford.edu/~rezab/papers/dimsum.pdf","title":"","rel":"","anchorType":0}]},{"name":"2f99","type":1,"text":"Well, this algorithm is called the “NaiveMapper” (for a good reason). For each row representing a customer, we make a cross-product between all items. Say, for instance, a given customer interacted with skus 0, 1 and 2; we might end up with (just an example, the numbers were written randomly):","markups":[]},{"name":"4faa","type":1,"text":"[((sku0, sku0), 1),\n ((sku0, sku1), 2),\n ((sku0, sku2), 0),\n ((sku1, sku0), 2),\n ((sku1, sku1), 2),\n ((sku1, sku2), 1),\n((sku2, sku0), 0),\n((sku2, sku1), 1),\n((sku2, sku2), 1)]","markups":[]},{"name":"ee90","type":1,"text":"The step of extracting all these correlations for each customer is our mapping phase (or “Shuffle Phase”) whose BigO is O(mL²) (“L” is the maximum number of interactions a customer had in our whole training set). Well, if you are a developer you certainly already know what happens when we have O(n²): smooooke on the waaaaateeeer…","markups":[{"type":2,"start":90,"end":104},{"type":2,"start":120,"end":121},{"type":2,"start":295,"end":296}]},{"name":"cfd4","type":1,"text":"Not good. Not necessarily infeasible but mainly not that…cool. As in Dafiti L can be potentially thousands of skus and m is millions, you see the problem we have in hands. Well, DIMSUM is the way to break this problem into a more tractable one by implementing this new algorithm:","markups":[{"type":2,"start":76,"end":78},{"type":2,"start":119,"end":120}]},{"name":"b83a","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*KmpoikBn3rVp-3SZ.","originalWidth":513,"originalHeight":419}},{"name":"29b5","type":1,"text":"It’s the same idea with one smart change: now we have this scalar “γ” that works as a sampling rate for the emission of correlations in the shuffle phase. But it’s not just adding a simple scalar and “voilá”, it’s done! We need some rigorous mathematical analysis to understand what are the trade-offs of having this sampling happening!","markups":[]},{"name":"bc04","type":1,"text":"I’ll take the time now to explain a bit further how it works but the next mini-session is totally “skip-able”.","markups":[]},{"name":"dabc","type":1,"text":"(I’ll be following Rezab’s paper notation thoroughly). As we already discussed, let A be the matrix whose rows are customers and columns are products and values in each cell corresponds to some implicit metric of how much our customers enjoyed a given item (say each time he browsed a product we add 1 point for instance).","markups":[{"type":1,"start":84,"end":85}]},{"name":"f528","type":1,"text":"As previously discussed, for each row we iterate over all products interactions building combinations and emitting those values to the Reduce phase. Now that we have a sampling rate for the emission, it must follow for each intersection:","markups":[]},{"name":"2199","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*qwP0TOf-DaoQep2AYP8T1A.png","originalWidth":395,"originalHeight":73}},{"name":"1c96","type":1,"text":"And:","markups":[]},{"name":"55e2","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*pAvtxnyipG_wQM2OVDtiYg.png","originalWidth":245,"originalHeight":58}},{"name":"f9ae","type":1,"text":"The “‖ci‖” is the norm of the product vector “i”. That means that the more interactions a product has the less likely we are to emit its values; the reasoning is that we already have lots of information about it so we can afford to emit a bit less information and still converge to the real similarity value within a bounded error.","markups":[]},{"name":"32d2","type":1,"text":"X is a random variable since it follows now a probability distribution and the final similarity score is the normalized summation of these Xs which gives us:","markups":[{"type":3,"start":7,"end":22,"href":"https://www.khanacademy.org/math/statistics-probability/random-variables-stats-library/random-variables-discrete/v/random-variables","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":1}]},{"name":"0c8b","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*YV6tWstZ9RjlL7dw1YzAVw.png","originalWidth":175,"originalHeight":83}},{"name":"dc35","type":1,"text":"Ok, I confess, I just couldn’t understand where the “γ” came from; as it turns out, it’s quite simple: the similarity is the summation of the “X” normalized by the norms of each product vector (as we discussed in the beginning of this post). But given that we are emitting these values with a given probability, the expected value will be multiplied by this probability as well.","markups":[]},{"name":"57fc","type":1,"text":"That means that if we do not correct for this effect, we’ll end up with something like “p * similarity” as for the final result. This being the case, we need to divide by “p” so that the expected value converges to the real value. But given our equation for probability, if we divide the cosine by “p” we cancel out the norms of the skus and the “γ” will remain in the denominator.","markups":[]},{"name":"262a","type":1,"text":"It’s possible to deduce the following: if γ = Ω(n/ε²) (that is, the sampling rate is proportional to the amount of products in training data divided by the squared expected relative error between true value and estimated one) then:","markups":[]},{"name":"e4df","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*WHJ1R_QNSJcl9fdqKj4ogw.png","originalWidth":227,"originalHeight":81}},{"name":"f412","type":1,"text":"With probability of at least 50%. B is our similarity matrix and D is a diagonal matrix whose each value in the diagonal is the norm a correspondent product. The deduction is somewhat extensive and we won’t go through here, still the paper has a thorough deduction of each step).","markups":[{"type":1,"start":34,"end":36},{"type":1,"start":65,"end":66}]},{"name":"942b","type":1,"text":"This formulation also leads us to the following: if γ ≥ α/\u000fε for a given α ∈ ℝ¹ then:","markups":[]},{"name":"e754","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*zp82Al2mGPAyTD3DrC6nxw.png","originalWidth":563,"originalHeight":90}},{"name":"5815","type":1,"text":"And:","markups":[]},{"name":"8933","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*emxrbsUujsFy-9fjDhLqEg.png","originalWidth":524,"originalHeight":45}},{"name":"d396","type":1,"text":"This gives us a upper and lower limit for how wrong we may end up being in our computation given the value we’ve chosen for γ. The bigger α is the lower are the chances of computed value being too far away from true value, for a given bounded error ε.","markups":[]},{"name":"9216","type":1,"text":"The beauty of this all: our shuffle phase ends up having O(nLγ/H²) where “H” is the smallest nonzero entry in A after we scale it to be between 0 and 1.","markups":[{"type":1,"start":110,"end":111},{"type":2,"start":57,"end":58}]},{"name":"ed48","type":1,"text":"This is the reason the algorithm is called “DIMSUM” which extends for “Dimension Independent Matrix Square Using MapReduce”: notice that, before, this value was O(mL²) and now it’s completely unrelated to how many customers we have in our training data! The “m” is gone and now we basically have a linear O which allows us to process huge amounts of data, build our similarity matrix and have some guarantees that obtained values are converging to real values given defined boundaries.","markups":[{"type":1,"start":71,"end":122},{"type":2,"start":161,"end":162},{"type":2,"start":305,"end":306}]},{"name":"e5c3","type":1,"text":"The Reduce phase will be just a summation so the best strategy here is avoiding to emit too many values to this phase.","markups":[]},{"name":"c298","type":1,"text":"And that hopefully is a good enough of an introduction to how we compute these algorithms using MapReduce framework. There’s definitely some heavy mathematics behind it but still it’ll allow us to make all sorts of linear algebra operations on matrices as effectively as possible, given bounded errors we’ll be trading-off.","markups":[]},{"name":"b4c9","type":1,"text":"What changes therefore is the following: remember our previous example on the emissions for each customer? If we take the same example, now with DIMSUM we might end up with something like this:","markups":[]},{"name":"5f26","type":1,"text":"[((sku0, sku0), 1),\n\n ((sku0, sku2), 0),\n\n\n ((sku1, sku2), 1),\n((sku2, sku0), 0),\n\n((sku2, sku2), 1)]","markups":[]},{"name":"5ac4","type":1,"text":"The absent values are no longer being emitted as now we have a probability of emitting each correlation.","markups":[]},{"name":"8201","type":1,"text":"When implementing the algorithm we’ll be making a small adaptation to the mapping phase, like so:","markups":[]},{"name":"bca6","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*ai6VwHZrmNuSu3M4GHtf_Q.png","originalWidth":554,"originalHeight":280}},{"name":"0877","type":1,"text":"Which reduces not only the emissions but also the computation required as the second “aik” is computed only if the first “aij” has been accepted in the sampling scheme.","markups":[]},{"name":"8aa4","type":1,"text":"And that’s pretty much it! We basically need to extract correlations between products for each customers but doing so in big data is unfeasible for the most part. We, therefore, use sampling techniques to bring the O to much lower value ranges so we can implement all sorts of linear algebra operations to data.","markups":[{"type":2,"start":215,"end":216}]},{"name":"45a9","type":1,"text":"Well, we are ready to start implementing DIMSUM!","markups":[]},{"name":"a9fa","type":1,"text":"Kinda…","markups":[]},{"name":"1dad","type":1,"text":"We still need data to feed the algorithm! Data is the new gold so…let’s dig for it!","markups":[]},{"name":"24a1","type":3,"text":"2. Show Me The Data","markups":[]},{"name":"ec52","type":1,"text":"This is what we’ll be talking about right now:","markups":[]},{"name":"0ab4","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*kaQ0VibMjNMxBCf2SghsMw.png","originalWidth":962,"originalHeight":640}},{"name":"e4eb","type":1,"text":"First tools we used to come up with our Serverless implementation were AppEngine, BigQuery and Cloud Storage.","markups":[]},{"name":"96e3","type":1,"text":"BigQuery is basically a genius implementation of a new concept for a database that is designed to work with big data as easily as possible. There’s no indexes nor any infrastructure you need to take care of. You just load your data there and it just process everything you need, on-demand, on-the-fly, on-freaking-awesome.","markups":[{"type":3,"start":0,"end":8,"href":"https://cloud.google.com/products/big-data/?hl=pt-br&utm_source=google&utm_medium=cpc&utm_campaign=latam-BR-all-pt-dr-bkws-all-all-trial-b-latam-1002243-LUAC0000358&utm_content=text-ad-none-any-DEV_c-CRE_204833483167-ADGP_BKWS+%7C+Multi+~+Bigquery+Google-KWID_43700022301561115-kwd-302438885959-userloc_1001773&utm_term=KW_%2Bbigquery%20%2Bgoogle-ST_%2Bbigquery+%2Bgoogle&dclid=CL_tiJTPgNgCFQcchwodeagASQ","title":"","rel":"","anchorType":0}]},{"name":"b2a2","type":1,"text":"We used BQ to transform our data from Google Analytics to a format that our algorithm in Spark could work with; as we were working with our central team at GFG, we used the same input schema as theirs for production environment. Here’s an example of the data we feed our algorithm with:","markups":[{"type":3,"start":38,"end":54,"href":"https://support.google.com/analytics/answer/3437719?hl=en","title":"","rel":"","anchorType":0}]},{"name":"98b5","type":8,"text":"user,productSku,type\n95106786645166913,AG672APF78UCF,1\n8897887309145128270,FI911APF10HUZ,2\n1153521620412862249,CO515APM42GTT,2\n1819629928011287314,FI911SHM06PUF,1\n1133082218947946503,JO546APM50KFT,3","markups":[]},{"name":"aa28","type":1,"text":"Some points to make: remember from our previous discussion that we track signs from customers to implicitly infer how much a given customer enjoys a given item? So, here’s how we make it: “1” means that the customer browsed a given product; “2” the product was added to basket and finally “3”: the product was purchased.","markups":[]},{"name":"1dfa","type":1,"text":"We infer therefore that user 95106786645166913 browsed on product AG672APF78UCF , user 8897... added FI911APF10HUZ to basket and so on.","markups":[{"type":10,"start":29,"end":46},{"type":10,"start":66,"end":79},{"type":10,"start":87,"end":94},{"type":10,"start":101,"end":114}]},{"name":"5699","type":1,"text":"For now, this is just an indication for us. A customer browsing an item does not mean at all that he or she likes it. But it’s also an implicit signal that we don’t want to get rid off; if the same customer adds the same item to basket we have something more meaningful than just “a browsing” and the same goes for purchasing. Notice that a customer buying a product still does not mean that he or she likes it. Maybe it was a gift for somebody else, maybe he returns the item later on, maybe he’s in a hurry and had to buy what he found first...this is the query we run to extract these values:","markups":[]},{"name":"9859","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"5939191449b11081764a98a376919be4","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"d5a1","type":1,"text":"So far so good! But if we want a Serverless solution, we need somehow to trigger this query execution automatically, without having a machine with a cron service running.","markups":[]},{"name":"755f","type":1,"text":"This is where AppEngine comes into play.","markups":[{"type":3,"start":14,"end":23,"href":"https://console.cloud.google.com/appengine?src=ac","title":"","rel":"","anchorType":0}]},{"name":"adf2","type":3,"text":"3. Bless the Crons","markups":[]},{"name":"bdd9","type":1,"text":"Google AppEngine is, in a nutshell, a Serverless WSGI server where you can upload routes, their associated functions and directive rules; just build the code associated to each route and deploy to GAE and it will just work: auto-scaling, traffic allocation, logging, authentication, memcache and many other features.","markups":[{"type":3,"start":38,"end":53,"href":"http://wsgi.readthedocs.io/en/latest/what.html","title":"","rel":"","anchorType":0}]},{"name":"2e1c","type":1,"text":"I’d like to right now already show you an example of one of our code deployed for managing the crons we’ll be talking soon. This is known as our main.py service:","markups":[{"type":1,"start":145,"end":152}]},{"name":"e5d4","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"77293472103add32d3b5cb9d76c2d2cb","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"3448","type":1,"text":"Notice this is a Flask application with one route rule specified: for requests having a URL with pattern /run_job/job_name/ will trigger the run_job() function (where later on we’ll be scheduling our tasks in GCP). This is basically the code you deploy to GAE and it take care of the rest.","markups":[{"type":10,"start":105,"end":123},{"type":10,"start":141,"end":150},{"type":3,"start":17,"end":22,"href":"http://flask.pocoo.org/","title":"","rel":"","anchorType":0}]},{"name":"4368","type":1,"text":"If you read GAE docs, you’ll notice there’s two types of environment where you can upload your code: Standard vs Flexible.","markups":[]},{"name":"62a3","type":1,"text":"Main difference is: Standard runs in a sandboxed environment that blocks several things such as running user C code, multi-threading/processing, writing to disk and so on. What you get in return is the possibility of scaling down to zero machines, as well as a set of tools only available in this option, such as the NDB library (designed by BDFL Guido Van Rossum).","markups":[{"type":3,"start":39,"end":48,"href":"https://en.wikipedia.org/wiki/Sandbox_(software_development)","title":"","rel":"","anchorType":0},{"type":3,"start":317,"end":320,"href":"https://cloud.google.com/appengine/docs/standard/python/ndb/","title":"","rel":"","anchorType":0}]},{"name":"ba54","type":1,"text":"Flexible Environment, on the other hand, receives a Docker image where you expose a port that routes traffic to an internal WSGI server (for Python, gunicorn is quite popular and will be used later on in this post) which guarantees you can install pretty much anything. The downside for the flexibility is that creating a new instance for the auto-scaling is more time consuming and thanks to that there’s always going to be at least one machine running all the time, i.e, you can’t scale down to zero instances in this option.","markups":[{"type":3,"start":149,"end":157,"href":"http://gunicorn.org/","title":"","rel":"","anchorType":0}]},{"name":"f1cf","type":1,"text":"So a good rule of thumb we use is: if what we are designing will have large periods of inactivity (no requests) then we go with Standard; if more advanced coding is required (such as multiprocessing and C based processing) and is always receiving requests non-stop, go with Flexible.","markups":[]},{"name":"2653","type":1,"text":"Well, you might be asking: “What this all has to do with us being able to run cron jobs for the queries in BigQuery”?","markups":[]},{"name":"f7ac","type":1,"text":"No worries. Let’s talk about that!","markups":[]},{"name":"7606","type":1,"text":"This is what we’ll be discussing now:","markups":[]},{"name":"382d","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*ozaycfRcwnGjn6rSeS3Z4w.png","originalWidth":942,"originalHeight":663}},{"name":"ce1c","type":1,"text":"GAE has native support for Serverless CRON triggers. All you have to do is specifiy a URL that will receive a GET request and you just code whatever you need in that URL. You’ll have to deploy a cron.yaml file specifying routes and rules; here’s one example from the official docs:","markups":[{"type":3,"start":195,"end":204,"href":"https://cloud.google.com/appengine/docs/standard/python/config/cronref","title":"","rel":"noopener","anchorType":0}]},{"name":"525b","type":8,"text":"#cron.yaml\ncron:\n- description: \"daily summary job\"\n  url: /tasks/summary\n  schedule: every 24 hours","markups":[{"type":10,"start":0,"end":100}]},{"name":"80ba","type":1,"text":"This means every 24 hours a GET request will be issued to the URL /tasks/summary.","markups":[{"type":10,"start":66,"end":81}]},{"name":"d51c","type":1,"text":"There’s one important requirement in GAE: requests must be completed within a 60 seconds time frame as otherwise you’ll have to schedule the operation to join a queue and the task will be processed as a background one, outside of the input request.","markups":[{"type":3,"start":161,"end":166,"href":"https://cloud.google.com/appengine/docs/standard/python/taskqueue/","title":"","rel":"noopener","anchorType":0}]},{"name":"1841","type":1,"text":"We want our cron to run a query in BigQuery and then export results to GCS; this can potentially take more than 60s so we created a scheduler for the cron to initiate when the specified time trigger occurs.","markups":[{"type":3,"start":132,"end":141,"href":"https://cloud.google.com/appengine/docs/standard/python/taskqueue/","title":"","rel":"noopener","anchorType":0}]},{"name":"35e8","type":1,"text":"Basically, what happens then is: our cron issues a GET to our main router which in turn adds a task to our scheduler defined by (we used the concept of push queues in this case):","markups":[{"type":3,"start":152,"end":163,"href":"https://cloud.google.com/appengine/docs/standard/python/taskqueue/push/","title":"","rel":"noopener","anchorType":0}]},{"name":"656c","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"057ee9eede8cb7171934ef446000f98c","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"56f9","type":1,"text":"So far we have: a cron that issues a GET request to /run_job/job_name which in turn adds to our task queue a job associated to URL /export_customers which in turn runs our query and extraction operations. Gosh that is confusing! Maybe a picture helps a bit here:","markups":[{"type":10,"start":52,"end":69},{"type":10,"start":131,"end":148}]},{"name":"1928","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*GkowJRk8EaIsFu80sqVdiA.png","originalWidth":988,"originalHeight":437}},{"name":"ca26","type":1,"text":"Our main service is defined by this yaml file:","markups":[{"type":3,"start":36,"end":40,"href":"https://cloud.google.com/appengine/docs/standard/python/config/appref","title":"","rel":"","anchorType":0}]},{"name":"a408","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"06e7c2f42773cbaa44ec579ac4a312e6","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"b7a9","type":1,"text":"This is where our discussion about Standard vs Flexible comes into play: we don’t need those machines up and running all the time. Only when they are processing the scheduled tasks; if we don’t specify an environment in this ymal file, then standard is deployed by default.","markups":[]},{"name":"f5d0","type":1,"text":"So now we can setup a cron that looks for the service “dataproc-twitter” and find in the handlers definition where to redirect the request, that is, the application called “app” inside the file called “main.py”. This is our yaml definition for the workers that will run our scheduled processes in background:","markups":[]},{"name":"0243","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"be3e8af4e3068dd8d7bf596f389f6adf","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"07c4","type":1,"text":"We also need to define a rate at which our queue will be processed. This is simple, for our project we did it like:","markups":[{"type":3,"start":43,"end":48,"href":"https://cloud.google.com/appengine/docs/standard/python/config/queueref","title":"","rel":"","anchorType":0}]},{"name":"e301","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"4b69fdf2c29c5c0c4e4fa1c041caaffb","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"d64d","type":1,"text":"And finally, our cron:","markups":[]},{"name":"d3b4","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"84aa383c747ec5abcf88d2d309808340","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"b6e9","type":1,"text":"Deploying to GAE is quite simple; gcloud is required to be installed, after that, we just run:","markups":[{"type":3,"start":34,"end":40,"href":"https://cloud.google.com/sdk/downloads","title":"","rel":"","anchorType":0}]},{"name":"693d","type":1,"text":"gcloud app deploy main.yaml worker.yaml","markups":[{"type":10,"start":0,"end":39}]},{"name":"9017","type":1,"text":"And that’s it. The other deploys goes like:","markups":[]},{"name":"ba4f","type":8,"text":"gcloud app deploy queue.yaml\ngcloud app deploy cron.yaml","markups":[]},{"name":"f47c","type":1,"text":"In GCP dashboard there’s an update to everything that is happening:","markups":[]},{"name":"f1ac","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*3wKrr10BTkooWcfhNJzQ_A.png","originalWidth":1436,"originalHeight":520}},{"name":"531f","type":1,"text":"As well as information about the crons that we just installed:","markups":[]},{"name":"293f","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*isXpb_KmM2rfSDKW1jqrYQ.png","originalWidth":1438,"originalHeight":503}},{"name":"a84a","type":1,"text":"(The cron “run_dimsum” will be explained later).","markups":[]},{"name":"88c2","type":1,"text":"Well, now we already know how to run Serverless cron jobs in GCP. Let’s go to the Spark implementation then!","markups":[]},{"name":"d863","type":3,"text":"4. Dataproc PySpark To Heaven","markups":[]},{"name":"2f3d","type":1,"text":"In a nutshell, Dataproc is a Google fully managed cluster that already have Spark builtin ready to go. You basically specify how many workers you want and pretty much it, hit the play and wait a few minutes for the cluster to be created.","markups":[]},{"name":"2a4c","type":1,"text":"Well, as previously discussed, we aimed to implement the DIMSUM algorithm in Spark. First thing we created was a cron based trigger that when initiated builds a whole cluster for us, process the Spark job and when it’s over, deletes the cluster. Why is that? So costs plummet. We literally pay for what we use and nothing more.","markups":[]},{"name":"e30f","type":1,"text":"So, let’s do it! Here’s what we’ll be discussing now:","markups":[]},{"name":"abb5","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*Xt7QO2Bo3mzaEJC_14HImg.png","originalWidth":983,"originalHeight":613}},{"name":"9527","type":1,"text":"We already have our cron job receiver as well as the scheduler worker. This is the code we used to run all these operations:","markups":[{"type":3,"start":83,"end":87,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/worker.py","title":"","rel":"","anchorType":0}]},{"name":"940a","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"272752c91dd81b49df345268c1215c80","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"5f91","type":1,"text":"What is happening here is: first our cron job will send a GET request to the URL /run_job/run_dimsum/. This in turn will schedule a task that is triggered by the URL /dataproc_dimsum which runs the function dataproc_dimsum().","markups":[{"type":10,"start":81,"end":102},{"type":10,"start":166,"end":182},{"type":10,"start":207,"end":225}]},{"name":"101e","type":1,"text":"What this function does is:","markups":[]},{"name":"8221","type":10,"text":"Creates Spark cluster","markups":[]},{"name":"96b7","type":10,"text":"Uploads the PySpark files required to run the jobs to GCS","markups":[]},{"name":"a0ea","type":10,"text":"Runs the PySpark job","markups":[]},{"name":"0c5f","type":10,"text":"Deletes the cluster","markups":[]},{"name":"b2f7","type":10,"text":"Schedule a task to start the Dataflow extraction from GCS to Datastore.","markups":[]},{"name":"3baf","type":1,"text":"With this in mind, we can dive into understanding the PySpark jobs.","markups":[]},{"name":"2595","type":13,"text":"4.1 PySpark","markups":[]},{"name":"0617","type":1,"text":"Here’s how we like to work with Dataproc. First we usually create a very small cluster with n1-standard-1 machines with this script and run it like","markups":[{"type":10,"start":92,"end":105},{"type":3,"start":120,"end":131,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/create_cluster.sh","title":"","rel":"","anchorType":0}]},{"name":"dc1a","type":1,"text":"./create_cluster -n=cluster_name -b=bucket_name","markups":[{"type":10,"start":0,"end":47}]},{"name":"3b34","type":1,"text":"Important catch here: if you pay close attention the the gcloud command, you’ll see that there’s a jupyter.shinitialization-action. What this does is prepare our cluster with a Jupyter-notebook service ready to use to which we create a ssh tunnel (you can see how we do that in this folder in files utils.sh and launch_jupyter.sh).","markups":[{"type":10,"start":57,"end":63},{"type":10,"start":99,"end":109},{"type":3,"start":178,"end":193,"href":"http://jupyter.org/","title":"","rel":"","anchorType":0},{"type":3,"start":283,"end":289,"href":"https://github.com/WillianFuks/example_dataproc_twitter/tree/master/dataproc/bin","title":"","rel":"","anchorType":0},{"type":3,"start":299,"end":307,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/utils.sh","title":"","rel":"","anchorType":0},{"type":3,"start":312,"end":329,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/launch_jupyter.sh","title":"","rel":"","anchorType":0}]},{"name":"87a5","type":1,"text":"This is an example of how our Notebook looked like when we completed the implementation:","markups":[{"type":3,"start":0,"end":18,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/notebooks/df_naive.ipynb","title":"","rel":"","anchorType":0}]},{"name":"28c3","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*gHMoqb5jS4QUQzTdmRe_xA.png","originalWidth":997,"originalHeight":793}},{"name":"97df","type":1,"text":"On the main repository used as basis for this post you can see in folder “dataproc” the folder “notebooks”. The cool thing about those is that you can see how helpful this tool can be when working with PySpark. I literally open up a pyspark-notebook and start testing everything possible: all testings, questions, observations, all at once one after the other.","markups":[]},{"name":"710c","type":1,"text":"This ends up being a huge time savior when developing as you test on the-fly quite easily and fast. If you check my notebooks you’ll see that I don’t even follow the lines, I start at one line, then I jump over to the bottom, then I come back to the beginning. It doesn’t really matter, what does matter is testing quickly, prototyping as fast as possible and then building the final code accordingly (still notice that all of our jobs are unit tested so we have some guarantees the code is working).","markups":[]},{"name":"81a9","type":1,"text":"With that in mind, here’s how we approached the job development for our DIMSUM algorithm. First, we created a base file with general helper functions; here’s part of it:","markups":[{"type":3,"start":110,"end":114,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/jobs/base.py","title":"","rel":"","anchorType":0}]},{"name":"a919","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"de31d3c75aea617feb29daaa2d0c25fd","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"b559","type":1,"text":"When working with Spark you usually start by creating a SparkContext which sets general guidelines about how Spark should run the jobs. Notice in the method process_day_input the MapReduce operations happening; first, we read from textFile source and then a set of map and reduce operations follows.","markups":[{"type":10,"start":56,"end":68},{"type":10,"start":157,"end":174},{"type":10,"start":231,"end":239}]},{"name":"887d","type":1,"text":"Remember that we mapped our customers behavior to “1” for browsing a given sku, “2” for when it was added to basket and “3” for when purchased happened? Well, here we transform those numbers into a final score that indicate to us implicitly how much a given customer is likely to enjoy a given item.","markups":[]},{"name":"49c1","type":1,"text":"To do so, we make this mapping: {\"browsed\": 0.5, \"basket\": 2., \"purchase: 6.} (in production at Dafiti we have different values which are obtained through Bayesian Black-Box Optimization; as discussing these is not the main focus of this post, we’ll probably do that on another opportunity).","markups":[{"type":10,"start":32,"end":77},{"type":3,"start":155,"end":186,"href":"https://en.wikipedia.org/wiki/Bayesian_optimization","title":"","rel":"noopener","anchorType":0}]},{"name":"b85c","type":1,"text":"Each time a customer browses an item we add up 0.5 points; if it’s added to basket then 2 points and 6 points if purchased. This is a sample of the output we get:","markups":[]},{"name":"c656","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*JdwWlzDVUN2oWwwA2R32lg.png","originalWidth":1236,"originalHeight":580}},{"name":"d33c","type":8,"text":"{“user”:”8291743389332496534\",”interactions”:[{“item”:”RE499APM08ZTZ”,”score”:0.5},{“item”:”RE499APM85DGC”,”score”:0.5}]}","markups":[]},{"name":"bca5","type":8,"text":"{“user”:”5843584611541988560\",”interactions”:[{“item”:”SA232SHF47ZZO”,”score”:0.5},{“item”:”SA232SHF89GXI”,”score”:1.0}]}","markups":[]},{"name":"dc08","type":8,"text":"{“user”:”6935962925703084781\",”interactions”:[{“item”:”DE996ACF83KYE”,”score”:0.5},{“item”:”CR177ACF76BIH”,”score”:0.5},{“item”:”MA318ACF62LRP”,”score”:0.5},{“item”:”DE996ACF23CIQ”,”score”:0.5},{“item”:”QU097ACF76IKL”,”score”:0.5},{“item”:”QU097ACF44IPN”,”score”:0.5},{“item”:”QU097ACF77IOG”,”score”:0.5},{“item”:”DE996ACF50CHP”,”score”:1.5}]}","markups":[]},{"name":"9dc2","type":1,"text":"With this process complete, we are ready to finally run the DIMSUM implementation:","markups":[{"type":3,"start":60,"end":66,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/jobs/dimsum.py","title":"","rel":"","anchorType":0}]},{"name":"383f","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"b15466d4187297193ead7e12440b0e5c","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"766d","type":1,"text":"This script basically scans through all the intermediary data we computed in the previous step aggregating all customers interactions into a single row (this is our matrix A we discussed in the beginning) and then executes the run_DIMSUM method. Notice first the broadcasting of pq. This is a computation for the probability of each product and their normalizing factor for the emission of the correlation (ai * bi). When we broadcast something in Spark, the object is serialized and spread over the net of workers so they have in their memory direct access to the object; we broadcast a dictionary with information of each sku to improve performance.","markups":[{"type":10,"start":227,"end":237},{"type":10,"start":279,"end":282},{"type":1,"start":172,"end":173}]},{"name":"8cb0","type":1,"text":"Notice the DIMSUM script basically loops through all interactions of our customers and emits the correlation when the probability of doing so outperforms the generation of a random number (the idea is trowing a dice and seeing whether to release the number or not).","markups":[]},{"name":"4192","type":1,"text":"And that’s basically all there’s to it. Despite of all the complicated equations, the final implementation ends up being quite simple. After that, result is uploaded to GCS; a quick sample:","markups":[]},{"name":"c2b9","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*LtnsrttNWjWLaGiWbmLAsw.png","originalWidth":1266,"originalHeight":591}},{"name":"42f8","type":8,"text":"{“item”:”LO611APF49EBY”,”similarity_items”:\n    [{“item”:”DI944APF23XPS”,”similarity”:0.017922988},\n     {“item”:”ME700ACF75HAQ”,”similarity”:0.035410713},\n     {“item”:”LO611APF47ECA”,”similarity”:0.1254363},\n     {“item”:”TR943APF03NGY”,”similarity”:0.024296477},\n     {“item”:”CA700APF63DSU”,”similarity”:0.044455424},\n     {“item”:”LO611APF43ECE”,”similarity”:0.33709994},\n     {“item”:”LO611APF41ECG”,”similarity”:0.07137738},\n     {“item”:”LO611APF80EAT”,”similarity”:0.02228836},\n     {“item”:”LO611APF84EAP”,”similarity”:0.03180418},\n     {“item”:”DE234APF58ION”,”similarity”:0.013907681}]}","markups":[]},{"name":"3b95","type":1,"text":"Notice here we don’t sort the result by the similarity metric. This is done in our Dataflow pipeline, speaking of which…","markups":[]},{"name":"a50a","type":3,"text":"5. Gotta Beam`em All!","markups":[]},{"name":"0c3e","type":1,"text":"Just after results are saved to GCS, a new task is scheduled to retrieve this data to Datastore. This is what we’ll be talking about now:","markups":[]},{"name":"a5c9","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*qVCCSiuqx8CswmLG-ckf8Q.png","originalWidth":973,"originalHeight":610}},{"name":"b020","type":1,"text":"Datastore is a NoSQL database from Google and it has direct integration with AppEngine which makes things 100x easier and faster. What we want to do now is to upload results there in a key-value fashion so that when a request to our system arrives asking “What should I recommend to a customer that likes this red shoes?” our system can query over Datastore and retrieve all the similarities required to come up with an answer.","markups":[{"type":3,"start":0,"end":9,"href":"https://cloud.google.com/datastore/","title":"","rel":"","anchorType":0}]},{"name":"ea8b","type":1,"text":"There’s one problem though: how to save results from GCS to Datastore?","markups":[]},{"name":"e17c","type":1,"text":"That’s where Dataflow comes into play! Dataflow is a Serverless framework ready to compute general ETL tasks by running a unified model for data processing (which means that it has the concept of an “engine” or “runner” and you can choose which engine to run: Dataflow, Apache Spark, Flink and any other tool that follows the unified model).","markups":[{"type":3,"start":13,"end":21,"href":"https://cloud.google.com/dataflow/","title":"","rel":"","anchorType":0}]},{"name":"1bdb","type":1,"text":"Apache Beam is the tool required to create the pipeline operations. It’s an open source project and currently has support for Java and Python SDKs (even though unfortunately the Python implementation has been lagging behind Java’s, it still already offers lots of features).","markups":[{"type":3,"start":0,"end":11,"href":"https://beam.apache.org/","title":"","rel":"","anchorType":0}]},{"name":"649f","type":1,"text":"Well, what we have to do now is implement a pipeline process that reads the results of DIMSUM saved in GCS, process it accordingly and saves results to Datastore. Here’s our pipeline implementation:","markups":[{"type":3,"start":183,"end":197,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataflow/build_datastore_template.py","title":"","rel":"","anchorType":0}]},{"name":"0ac1","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"530f8682efab6a1fce9049a84d32564b","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"f28a","type":1,"text":"Here we used the concept of templated Dataflow: basically all it does is create the necessary code and json metadata exporting it to a location path in GCS; the advantage is that any other client at any other time can run the template just by issuing a HTTP request pointing to the template location. That means that it’s not necessary to re-compile the code or to have the whole environment setup. This is quite valuable for us as we are working in Standard GAE (remember everything so far has been activated by crons) and the sandboxed environment would not allow us to run a beam pipeline there.","markups":[{"type":3,"start":28,"end":46,"href":"https://cloud.google.com/dataflow/docs/templates/overview","title":"","rel":"noopener","anchorType":0}]},{"name":"cea2","type":1,"text":"With the templates it really doesn’t matter what environment and restrictions we may have, we just issue a GET request to the job execution and it happens automatically; here’s an example of our processed pipeline.","markups":[]},{"name":"9592","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*BpbzdI3GWL-gZjBG1AHOqw.png","originalWidth":1324,"originalHeight":598}},{"name":"7fed","type":1,"text":"Cool thing to notice: we setup our pipeline execution to have at maximum 2 workers; Dataflow knows automatically when to spawn more workers so to optimize total costs in a viable time frame.","markups":[]},{"name":"029d","type":1,"text":"One thing you may notice though is the quite long time consumed when writing our entities to Datastore. I’m not sure why this is happening and luckily this is not a problem for us as this process runs at night, but I’d expect the writing step to be way faster than it currently is (if you know how to improve performance please let us know :)!). Maybe there’s some optimization step that we missed but as our deadline to deliver the product was reaching its end this is how we delivered the product so far.","markups":[]},{"name":"36a2","type":1,"text":"With our data being ready to go, it’s time to serve the recommendations. We’re getting there!","markups":[]},{"name":"3ed6","type":3,"text":"Madame, Monsieur, ceci est pour vous.","markups":[]},{"name":"7e46","type":1,"text":"(I don’t speak French so I just hope the Translator got it right) Here’s what we’ll be discussing now:","markups":[]},{"name":"c116","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*fWF2_NI0X-g2rw2LmaDqFQ.png","originalWidth":959,"originalHeight":643}},{"name":"8570","type":1,"text":"So, let us recommend!","markups":[]},{"name":"0af2","type":1,"text":"Remember from our introduction that this is how we compute the final recommendations:","markups":[]},{"name":"0602","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*jAXRKAqL8RGlF2fcxf61iQ.png","originalWidth":307,"originalHeight":104}},{"name":"e3c5","type":1,"text":"In practice, we don’t make the normalization (the similarities summation in the denominator) as this is suggested by the literature.","markups":[]},{"name":"9e0f","type":1,"text":"This means that we can take all interactions customers had with items, come up with an implicit score metric “r” and multiply similarities between items and those scores to predict how much a given customer will enjoy a given product we may recommend. Seeing the code might make this easier to visualize. This is our first implementation to accomplish that:","markups":[{"type":3,"start":323,"end":337,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/main.py","title":"","rel":"noopener","anchorType":0}]},{"name":"80c5","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"4b77aa2e07024e9b498e34b0c054fb6d","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"f96c","type":1,"text":"And process_recommendations is given by:","markups":[{"type":10,"start":4,"end":27}]},{"name":"1e95","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"8a0a8fa385bc5cf4eb1a73b3c3409b9e","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"a31b","type":1,"text":"This is how it works: we receive input requests like this:","markups":[]},{"name":"7b48","type":8,"text":"/make_recommendation?browsed=CA278SHF46UJH","markups":[]},{"name":"6e9d","type":1,"text":"Which means: “I have a customer who browsed on item CA278SHF46UJH, what are your recommendations here?”","markups":[]},{"name":"38f2","type":1,"text":"And then we implement the equation by looping through all similarities that CA278SHF46UJH had as output from DIMSUM and order from best to worst and select only top “n”.","markups":[]},{"name":"8336","type":1,"text":"All this said, this is what we got:","markups":[]},{"name":"8283","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*0ZKRj66FAYCOW3s__-GWdw.png","originalWidth":1727,"originalHeight":973}},{"name":"719c","type":1,"text":"Yeap, that’s right. A bizarre disaster...it took almost 1 entire second to process the recommendations. And from that 1s, 800ms in just one single method! process_recommendations here ended up being a disaster.","markups":[{"type":10,"start":155,"end":178},{"type":1,"start":122,"end":154}]},{"name":"9e36","type":1,"text":"Don’t get me wrong, this is a big failure. If you develop a recommender system that takes 1s to respond you won’t be attracting that many customers nor making them happy by waiting; this is ugly and ineffective.","markups":[]},{"name":"d8f6","type":1,"text":"Well, that would mean that all of our endeavor so far has failed greatly. But we had still one last trick up our sleeve: we’ve been using Standard environment all this time due its simplicity and capacity to scale down to zero instances if so required to. But this time, the sandboxed feature has been probably hurting more than helping and reality is a recommender system very likely will always be receiving requests; this is the case for Dafiti and many of our ventures so it doesn’t make much sense to keep using Standard.","markups":[]},{"name":"18da","type":1,"text":"Our time was short so we quickly migrated environments and started using Flexible Environment with another big trick being played: we decided to cythonize the process_recommendation operation.","markups":[{"type":10,"start":159,"end":181},{"type":3,"start":145,"end":154,"href":"http://cython.readthedocs.io/en/latest/","title":"","rel":"","anchorType":0}]},{"name":"63d1","type":1,"text":"Well, this is the beauty of Python: “premature optimization is the source of all evil”. This is a fundamental truth in code development. Python served us greatly so far and it made us as productive as possible. But in this particular method, it certainly didn’t do a very good job so a workaround for that is to use Cython to get some performances boosts; Cython is basically a language that is capable of mixing Python and C/C++.","markups":[{"type":2,"start":36,"end":86}]},{"name":"e2ac","type":1,"text":"The advantage here is, for the most part, that Python treats every single object as…well, an object. That means that the concept of “int” does not quite exist in Python. In practice, ints are encapsulated by an object that contains an int. This is amazing and bad, just depends on how you look at it (or rather how you use it). This gives Python all the flexibility it has and all the coding implementation speed it offers but the trade-off is performance. What we can do in Cython though is to remove those questions that Python has to make on each object like “ok object, what are you?” and we can just say beforehand: “This is an array of ints, you don’t have to ask what those are anymore”.","markups":[]},{"name":"62d3","type":1,"text":"That’s what we implemented in Cython:","markups":[{"type":3,"start":0,"end":26,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/cythonized/c_funcs.pyx","title":"","rel":"","anchorType":0}]},{"name":"8744","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"56066ba7f262da56e93bb4d9c9a55d29","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"ac76","type":1,"text":"Here’s a Cython profiling on requests done to the Python-API:","markups":[]},{"name":"18be","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*K-DSPrpBE8nhS5KC.png","originalWidth":1272,"originalHeight":566}},{"name":"e86d","type":1,"text":"Well….kinda….ok.","markups":[]},{"name":"9788","type":1,"text":"This code already made our processing 7x faster on our local computer. That’s quite cool! But notice in the profiling the yellow lines: the stronger it gets the more requests to the Python-API is made. As our input is a list of dicts, Cython cannot convert it directly to any C structure. This means that those objects are still treated like so in Cython and we don’t get as much of a performance gain as it would be possible had those conversions being successfully made.","markups":[{"type":1,"start":38,"end":40}]},{"name":"2655","type":1,"text":"Still, no worries. We created then a separate service for the recommendations, this time in flexible environment:","markups":[{"type":3,"start":46,"end":53,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/recommender.py","title":"","rel":"","anchorType":0}]},{"name":"9fbf","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"b4f5c39fe7488bfad36775680c4f074b","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4665485%3Fs%3D400%26v%3D4&key=a19fcc184b9711e1b4764040d3dc5c07"}},{"name":"820f","type":1,"text":"Notice the cy_process_recommendations. This is where our call to the Cython script is being made.","markups":[{"type":10,"start":11,"end":38}]},{"name":"42d2","type":1,"text":"Deploying to flexible in our case is just as simple as standard. We have our requirements.txt file already defined so we just run:","markups":[{"type":3,"start":77,"end":93,"href":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/requirements.txt","title":"","rel":"","anchorType":0}]},{"name":"130a","type":1,"text":"gcloud app deploy recommender.yaml","markups":[{"type":10,"start":0,"end":34}]},{"name":"7dea","type":1,"text":"And now, these are the new results:","markups":[]},{"name":"1cfd","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*-MGOInJWav8fz4fo7aNj0Q.png","originalWidth":1726,"originalHeight":784}},{"name":"ae60","type":1,"text":"Whole processing time went from 1 second to 104ms. This is for quite an expensive request with several skus as input. Simpler inputs we get:","markups":[{"type":1,"start":44,"end":50}]},{"name":"e4a1","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*0Whs0n7OQU4G33TGz2lZgA.png","originalWidth":1024,"originalHeight":992}},{"name":"4f57","type":1,"text":"Somewhere around 20ms (it’s important to note that Datastore standard deviation on response time is somewhat considerable but average and median remains around this value).","markups":[{"type":1,"start":17,"end":22}]},{"name":"a883","type":1,"text":"The main bottleneck now is retrieving the keys from Datastore and as the time consumed is totally acceptable, we could consider our mission accomplished by now (oooh yeeeah!!!)","markups":[]},{"name":"dd1f","type":1,"text":"One thing that happened here is the time to get entities from Datastore became much bigger; this happened because we had to change the client to make the connection and it uses HTTP instead of gRPC which means we can make time decrease even lower with a more appropriate client.","markups":[{"type":3,"start":193,"end":197,"href":"https://grpc.io/","title":"","rel":"noopener","anchorType":0}]},{"name":"6ef1","type":1,"text":"This is an example of results we get for this input /make_recommendation?browsed=DA923SHF25QXA:","markups":[{"type":10,"start":52,"end":94}]},{"name":"2dd6","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*NURT3hRy5RvY85UkcVXzPw.png","originalWidth":1017,"originalHeight":248}},{"name":"1b75","type":3,"text":"7. Show Me Da Money! (costs)","markups":[]},{"name":"0615","type":1,"text":"Costs are important, still, in practice what really matters is cost-income ratio, not just cost.","markups":[]},{"name":"b49b","type":1,"text":"While I can’t make public Dafiti’s data and costs, let us see how a system like this would cost for a simulated eCommerce.","markups":[]},{"name":"b8f9","type":1,"text":"First of all, we have the Standard AppEngine cron service. This cost is basically negligible, it probably will be $1 per month. Now we have BigQuery making the data processing, which, assuming process 100 GB everyday, adds $15 in queries per month. Lets simulate a Dataproc cluster running everyday for roughly 2 hours, 3 machines of type n1-standard-4 which adds $36 a month. We also have the Dataflow machines but as the bottleneck is the writing operation we can use quite basic instances n1-standard-1 which, assuming 3 hours of work with 2 workers adds up $9 a month. Now we have Datastore. As each 100k writes is $0.18, assuming 300k ends up being around 16$ per month. Now let’s say the eCommerce is big and has around 5 million requests everyday. That would be $90 a month. There’s also price for storage. If we consume 5GBs that leads to just $1 at the end of the month. Finally we have the Flexible Environment machine. Here we choose a quite basic machine since we saw main bottleneck is Datastore. Considering we’ll be using 1 vCPU and 2GB of memory this gives us roughly $46.8.","markups":[]},{"name":"e973","type":1,"text":"This all adds up to $214 per month for an eCommerce receiving 5 million requests per day.","markups":[{"type":1,"start":20,"end":34}]},{"name":"a8a7","type":1,"text":"With one very important note: the system is totally Serverless, which means we have no expenses with an infrastructure team or devOps. We literally pay just for what we use and nothing more; there’s no extra costs into play here.","markups":[]},{"name":"c5f6","type":3,"text":"8. And Now We Improve","markups":[]},{"name":"fb49","type":1,"text":"Well, there’s still some changes we can make to improve the system. At Dafiti, we don’t use Spark in production. Our similarities are extract with a BigQuery query that already computes all correlations for us.","markups":[]},{"name":"53c2","type":1,"text":"Also, using Python to make the recommendations didn’t end up being very effective. A better alternative could be using GoLang here. This would lead to the possibility of not having to export data to Datastore and each instance loads a file from GCS to its own local memory. Costs would probably be much less then $100 in this architecture for our simulated store.","markups":[{"type":3,"start":119,"end":125,"href":"https://golang.org/","title":"","rel":"noopener","anchorType":0},{"type":1,"start":313,"end":318}]},{"name":"2651","type":1,"text":"As we had to make the delivery, we couldn’t further explore this approach but it’s definitely something we’ll be testing soon.","markups":[]},{"name":"cdb2","type":3,"text":"9. And That’s It!","markups":[]},{"name":"f319","type":1,"text":"What a journey…","markups":[]},{"name":"2051","type":1,"text":"When we started implementing this system we just couldn’t imagine how challenging and demanding it would end up being. It was exhausting, painful, we had to face bug after bug every single day in a tight deadline; it was quite quite quite challenging.","markups":[]},{"name":"11e3","type":1,"text":"I remember seeing this phrase “The Best Sailors Are Not Made In Calm Seas”. I confess that this version of “no pain no gain” made me reconsider keep going through the all the hurdle this project implementation presented itself to be. I’m glad we successfully worked it through as we learned a lot throughout the process.","markups":[]},{"name":"b9a5","type":1,"text":"We managed to make it work and made the delivery just in time. We are very happy with the accomplishment and excited to see what’s coming next.","markups":[]},{"name":"b71a","type":1,"text":"We have developed some knowledge now on how to implement quite demanding systems in production with a complete Serverless architecture that is cheap and effective. Hopefully, this will open us the doors to build even more complex systems fast, easy, Serverless and ready to interact with customers in no time.","markups":[]},{"name":"1d42","type":1,"text":"Just until recently we thought it would be impossible to build a recommender system totally Serverless as the computing in each request can be quite demanding but as we could confirm, that’s quite possible and should be our main goal as developers now.","markups":[]},{"name":"6ee7","type":1,"text":"If you read it through all that, gosh you deserve it! Hopefully it was worth the read and you could learn something out of that. If you have suggestions or anything to comment, please let us know!","markups":[]},{"name":"67d5","type":1,"text":"The whole code is available here.","markups":[{"type":3,"start":28,"end":32,"href":"https://github.com/WillianFuks/example_dataproc_twitter","title":"","rel":"","anchorType":0}]},{"name":"07f1","type":1,"text":"Well, we look forward to our next mission (you can play Super Metroid Ending soundtrack now, it’ll be epic, guaranteed).","markups":[{"type":3,"start":56,"end":76,"href":"https://www.youtube.com/watch?v=KWdRKZ6QgcU","title":"","rel":"","anchorType":0}]},{"name":"8572","type":1,"text":"Thanks a lot!\n(Beam fires. Apache-beam, that is*)","markups":[]}],"sections":[{"name":"b233","startIndex":0},{"name":"ff8f","startIndex":64},{"name":"a190","startIndex":89}]},"postDisplay":{"coverless":true}},"virtuals":{"statusForCollection":"APPROVED","allowNotes":true,"previewImage":{"imageId":"1*axNxklrne21SY_N6pyXp-w.png","filter":"","backgroundSize":"","originalWidth":795,"originalHeight":520,"strategy":"resample","height":0,"width":0},"wordCount":7032,"imageCount":33,"readingTime":28.93584905660377,"subtitle":"Just recently we were faced with a quite exciting challenge by our company and I’d like to take the opportunity to write down about it and…","publishedInCount":1,"usersBySocialRecommends":[],"noIndex":false,"recommends":147,"socialRecommends":[],"isBookmarked":false,"tags":[{"slug":"google-cloud-platform","name":"Google Cloud Platform","postCount":3858,"metadata":{"postCount":3858,"coverImage":{"id":"1*trNhoe9XVKt2IrSy4JbIkQ.jpeg","originalWidth":4048,"originalHeight":3036,"isFeatured":true}},"type":"Tag"},{"slug":"machine-learning","name":"Machine Learning","postCount":48619,"metadata":{"postCount":48619,"coverImage":{"id":"1*jnZT4gFAzScOJ_VnYsni0g.png","originalWidth":700,"originalHeight":450,"isFeatured":true}},"type":"Tag"},{"slug":"recommender-systems","name":"Recommender Systems","postCount":205,"metadata":{"postCount":205,"coverImage":{"id":"1*YsJVKieG3EEA8BrWMI9ljw.jpeg","originalWidth":1920,"originalHeight":754}},"type":"Tag"},{"slug":"serverless","name":"Serverless","postCount":3648,"metadata":{"postCount":3648,"coverImage":{"id":"0*x93bzQPPt7rcq-9T.png","originalWidth":1897,"originalHeight":900,"isFeatured":true}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":8,"links":{"entries":[{"url":"http://jupyter.org/","alts":[],"httpStatus":200},{"url":"https://en.wikipedia.org/wiki/Sandbox_(software_development)","alts":[],"httpStatus":200},{"url":"http://cython.readthedocs.io/en/latest/","alts":[],"httpStatus":200},{"url":"https://en.wikipedia.org/wiki/Bayesian_optimization","alts":[],"httpStatus":200},{"url":"https://en.wikipedia.org/wiki/Collaborative_filtering","alts":[],"httpStatus":200},{"url":"https://golang.org/","alts":[],"httpStatus":200},{"url":"http://global-fashion-group.com/","alts":[],"httpStatus":200},{"url":"http://wsgi.readthedocs.io/en/latest/what.html","alts":[],"httpStatus":200},{"url":"https://grpc.io/","alts":[],"httpStatus":200},{"url":"http://gunicorn.org/","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/recommender.py","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/main.py","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/tree/master/dataproc/bin","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/utils.sh","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/notebooks/df_naive.ipynb","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/requirements.txt","alts":[],"httpStatus":200},{"url":"https://console.cloud.google.com/appengine?src=ac","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/cythonized/c_funcs.pyx","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/launch_jupyter.sh","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/gae/worker.py","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataflow/build_datastore_template.py","alts":[],"httpStatus":200},{"url":"https://support.google.com/analytics/answer/3437719?hl=en","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/jobs/dimsum.py","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/jobs/base.py","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter/blob/master/dataproc/bin/create_cluster.sh","alts":[],"httpStatus":200},{"url":"https://github.com/WillianFuks/example_dataproc_twitter","alts":[],"httpStatus":200},{"url":"http://flask.pocoo.org/","alts":[],"httpStatus":200},{"url":"http://yifanhu.net/PUB/cf.pdf","alts":[],"httpStatus":200},{"url":"https://beam.apache.org/","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/datastore/","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/products/big-data/?hl=pt-br&utm_source=google&utm_medium=cpc&utm_campaign=latam-BR-all-pt-dr-bkws-all-all-trial-b-latam-1002243-LUAC0000358&utm_content=text-ad-none-any-DEV_c-CRE_204833483167-ADGP_BKWS+%7C+Multi+~+Bigquery+Google-KWID_43700022301561115-kwd-302438885959-userloc_1001773&utm_term=KW_%2Bbigquery%20%2Bgoogle-ST_%2Bbigquery+%2Bgoogle&dclid=CL_tiJTPgNgCFQcchwodeagASQ","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/appengine/docs/standard/python/ndb/","alts":[],"httpStatus":200},{"url":"https://www.youtube.com/watch?v=KWdRKZ6QgcU","alts":[{"type":2,"url":"vnd.youtube://www.youtube.com/watch?v=KWdRKZ6QgcU&feature=applinks"},{"type":3,"url":"vnd.youtube://www.youtube.com/watch?v=KWdRKZ6QgcU&feature=applinks"}],"httpStatus":200},{"url":"https://spark.apache.org/","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/dataflow/","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/dataflow/docs/templates/overview","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/appengine/docs/standard/python/taskqueue/push/","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/appengine/docs/standard/python/config/queueref","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/appengine/docs/standard/python/taskqueue/","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/appengine/docs/standard/python/config/cronref","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/appengine/docs/standard/python/config/appref","alts":[],"httpStatus":200},{"url":"https://www.khanacademy.org/math/statistics-probability/random-variables-stats-library/random-variables-discrete/v/random-variables","alts":[],"httpStatus":200},{"url":"https://stanford.edu/~rezab/papers/dimsum.pdf","alts":[],"httpStatus":200},{"url":"https://cloud.google.com/sdk/downloads","alts":[],"httpStatus":200}],"version":"0.3","generatedAt":1515719495005},"isLockedPreviewOnly":false,"takeoverId":"","metaDescription":"","totalClapCount":1127,"sectionCount":3,"readingList":0,"topics":[]},"coverless":true,"slug":"how-we-implemented-a-fully-serverless-recommender-system-using-gcp","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc","previewContent":{"bodyModel":{"paragraphs":[{"name":"11c0","type":3,"text":"How We Implemented a Fully Serverless Recommender System Using GCP","markups":[],"alignment":1},{"name":"f59b","type":1,"text":"Just recently we were faced with a quite exciting challenge by our company and I’d like to take the opportunity to write down about it and what we’ve learned along the way.","markups":[],"alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false,"subtitle":"Just recently we were faced with a quite exciting challenge by our company and I’d like to take the opportunity to write down about it and…"},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc","approvedHomeCollectionId":"e52cf94d98af","approvedHomeCollection":{"id":"e52cf94d98af","name":"Google Cloud Platform - Community","slug":"google-cloud","tags":["GOOGLE CLOUD PLATFORM","DEVELOPERS","CLOUD COMPUTING","DEVOPS","TECHNOLOGY"],"creatorId":"a535baed6389","description":"A collection of technical articles published or curated by Google Cloud Platform Developer Advocates. The views expressed are those of the authors and don't necessarily reflect those of Google.","shortDescription":"A collection of technical articles published or curated by…","image":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":16105,"activeAt":1539008070407},"virtuals":{"permissions":{"canPublish":false,"canPublishAll":false,"canRepublish":false,"canRemove":false,"canManageAll":false,"canSubmit":false,"canEditPosts":false,"canAddWriters":false,"canViewStats":false,"canSendNewsletter":false,"canViewLockedPosts":false,"canViewCloaked":false,"canEditOwnPosts":false,"canBeAssignedAuthor":false,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false},"isSubscribed":false,"isNewsletterSubscribed":false,"memberOfMembershipPlanId":"","isEnrolledInHightower":false,"isEligibleForHightower":false},"logo":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"twitterUsername":"gcpcloud","facebookPageName":"googlecloud","collectionMastheadId":"536cf63fce6","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":3,"layout":4,"number":10,"postIds":["2b0031e2c3b5","57e4af9b10da","429775bd6d11","79dc217b916","3e68396378b4","3ba9a8d8fc03","a76e72e45026","426e5f4c8a36","9870d41fcee3","cf753fa173a4"]}},{"type":1,"postListMetadata":{"source":2,"layout":4,"number":7,"postIds":[],"sectionHeader":"Trending"}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":11,"postIds":[],"sectionHeader":"Latest"}},{"type":1,"postListMetadata":{"source":1,"layout":6,"number":5,"postIds":[]}}],"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF02B875","point":0},{"color":"#FF00AB6B","point":0.1},{"color":"#FF1C9963","point":0.2},{"color":"#FF092E20","point":1}],"backgroundColor":"#FFFFFFFF"},"highlightSpectrum":{"colorPoints":[{"color":"#FFFFFFFF","point":0},{"color":"#FFE9FDF0","point":0.1},{"color":"#FFE2FAEE","point":0.2},{"color":"#FFADFFCF","point":0.6},{"color":"#FF7DFFB3","point":1}],"backgroundColor":"#FFFFFFFF"}},"navItems":[{"type":4,"title":"This Week in GCP","url":"https://medium.com/google-cloud/weekly/home","topicId":"af575ce9e5c7","source":"topicId"},{"type":1,"title":"Containers","tagSlug":"kubernetes","url":"https://medium.com/google-cloud/tagged/kubernetes","source":"tagSlug"},{"type":1,"title":"Virtualization","tagSlug":"google-compute-engine","url":"https://medium.com/google-cloud/tagged/google-compute-engine","source":"tagSlug"},{"type":1,"title":"Platform as a Service","tagSlug":"google-app-engine","url":"https://medium.com/google-cloud/tagged/google-app-engine","source":"tagSlug"},{"type":1,"title":"Data","tagSlug":"bigquery","url":"https://medium.com/google-cloud/tagged/bigquery","source":"tagSlug"},{"type":1,"title":"Machine Learning","tagSlug":"machine-learning","url":"https://medium.com/google-cloud/tagged/machine-learning","source":"tagSlug"},{"type":3,"title":"More","url":"https://cloud.google.com/blog/"}],"colorBehavior":1,"instantArticlesState":0,"acceleratedMobilePagesState":0,"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5},"type":"Collection"},"newsletterId":"","webCanonicalUrl":"https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc","mediumUrl":"https://medium.com/google-cloud/how-we-implemented-a-fully-serverless-recommender-system-using-gcp-9c9fbbdc46cc","migrationId":"","notifyFollowers":true,"notifyTwitter":false,"isSponsored":false,"isRequestToPubDisabled":false,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"audioVersionDurationSec":0,"sequenceId":"","isNsfw":false,"isEligibleForRevenue":false,"isBlockedFromHightower":false,"deletedAt":0,"lockedPostSource":0,"hightowerMinimumGuaranteeStartsAt":0,"hightowerMinimumGuaranteeEndsAt":0,"featureLockRequestAcceptedAt":0,"isElevate":false,"mongerRequestType":1,"layerCake":0,"socialTitle":"","socialDek":"","editorialPreviewTitle":"","editorialPreviewDek":"","curationEligibleAt":0,"type":"Post"},"mentionedUsers":[],"collaborators":[],"collectionUserRelations":[],"mode":null,"references":{"User":{"e9c35a095d0d":{"userId":"e9c35a095d0d","name":"Will Fuks","username":"willian.fuks","createdAt":1446065422885,"lastPostCreatedAt":1521650887588,"imageId":"1*KKOPcg6qjT9LWFRohbOwjQ.jpeg","backgroundImageId":"","bio":"Working as a Data Scientist at Dafiti Group","twitterScreenName":"","socialStats":{"userId":"e9c35a095d0d","usersFollowedCount":30,"usersFollowedByCount":79,"type":"SocialStats"},"social":{"userId":"lo_dnt_IwTGKK4Ik4yn","targetUserId":"e9c35a095d0d","type":"Social"},"facebookAccountId":"","allowNotes":1,"mediumMemberAt":0,"isNsfw":false,"isPartnerProgramEnrolled":false,"type":"User"}},"Collection":{"e52cf94d98af":{"id":"e52cf94d98af","name":"Google Cloud Platform - Community","slug":"google-cloud","tags":["GOOGLE CLOUD PLATFORM","DEVELOPERS","CLOUD COMPUTING","DEVOPS","TECHNOLOGY"],"creatorId":"a535baed6389","description":"A collection of technical articles published or curated by Google Cloud Platform Developer Advocates. The views expressed are those of the authors and don't necessarily reflect those of Google.","shortDescription":"A collection of technical articles published or curated by…","image":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":16105,"activeAt":1539008070407},"virtuals":{"permissions":{"canPublish":false,"canPublishAll":false,"canRepublish":false,"canRemove":false,"canManageAll":false,"canSubmit":false,"canEditPosts":false,"canAddWriters":false,"canViewStats":false,"canSendNewsletter":false,"canViewLockedPosts":false,"canViewCloaked":false,"canEditOwnPosts":false,"canBeAssignedAuthor":false,"canEnrollInHightower":false,"canLockPostsForMediumMembers":false,"canLockOwnPostsForMediumMembers":false},"isSubscribed":false,"isNewsletterSubscribed":false,"memberOfMembershipPlanId":"","isEnrolledInHightower":false,"isEligibleForHightower":false},"logo":{"imageId":"1*FUjLiCANvATKeaJEeg20Rw.png","filter":"","backgroundSize":"","originalWidth":192,"originalHeight":192,"strategy":"resample","height":0,"width":0},"twitterUsername":"gcpcloud","facebookPageName":"googlecloud","collectionMastheadId":"536cf63fce6","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":3,"layout":4,"number":10,"postIds":["2b0031e2c3b5","57e4af9b10da","429775bd6d11","79dc217b916","3e68396378b4","3ba9a8d8fc03","a76e72e45026","426e5f4c8a36","9870d41fcee3","cf753fa173a4"]}},{"type":1,"postListMetadata":{"source":2,"layout":4,"number":7,"postIds":[],"sectionHeader":"Trending"}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":11,"postIds":[],"sectionHeader":"Latest"}},{"type":1,"postListMetadata":{"source":1,"layout":6,"number":5,"postIds":[]}}],"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FF02B875","point":0},{"color":"#FF00AB6B","point":0.1},{"color":"#FF1C9963","point":0.2},{"color":"#FF092E20","point":1}],"backgroundColor":"#FFFFFFFF"},"highlightSpectrum":{"colorPoints":[{"color":"#FFFFFFFF","point":0},{"color":"#FFE9FDF0","point":0.1},{"color":"#FFE2FAEE","point":0.2},{"color":"#FFADFFCF","point":0.6},{"color":"#FF7DFFB3","point":1}],"backgroundColor":"#FFFFFFFF"}},"navItems":[{"type":4,"title":"This Week in GCP","url":"https://medium.com/google-cloud/weekly/home","topicId":"af575ce9e5c7","source":"topicId"},{"type":1,"title":"Containers","tagSlug":"kubernetes","url":"https://medium.com/google-cloud/tagged/kubernetes","source":"tagSlug"},{"type":1,"title":"Virtualization","tagSlug":"google-compute-engine","url":"https://medium.com/google-cloud/tagged/google-compute-engine","source":"tagSlug"},{"type":1,"title":"Platform as a Service","tagSlug":"google-app-engine","url":"https://medium.com/google-cloud/tagged/google-app-engine","source":"tagSlug"},{"type":1,"title":"Data","tagSlug":"bigquery","url":"https://medium.com/google-cloud/tagged/bigquery","source":"tagSlug"},{"type":1,"title":"Machine Learning","tagSlug":"machine-learning","url":"https://medium.com/google-cloud/tagged/machine-learning","source":"tagSlug"},{"type":3,"title":"More","url":"https://cloud.google.com/blog/"}],"colorBehavior":1,"instantArticlesState":0,"acceleratedMobilePagesState":0,"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Google Cloud Platform","description":"Curated articles for developers","backgroundImage":{},"logoImage":{"id":"1*Wbm0PGaB2AuerxdZb0SDUw.png","originalWidth":1024,"originalHeight":1024,"alt":"Google Cloud Platform - Community"},"alignment":2,"layout":5},"type":"Collection"}},"Social":{"e9c35a095d0d":{"userId":"lo_dnt_IwTGKK4Ik4yn","targetUserId":"e9c35a095d0d","type":"Social"}},"SocialStats":{"e9c35a095d0d":{"userId":"e9c35a095d0d","usersFollowedCount":30,"usersFollowedByCount":79,"type":"SocialStats"}}}})
// ]]></script><script type="text/javascript">(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent".split(" "), 0); branch.init('key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm', {'no_journeys': true, 'disable_exit_animation': true, 'disable_entry_animation': true}, function(err, data) {});</script><div class="surface-scrollOverlay"></div><script charset="UTF-8" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/main-common-async.bundle.ybn8pINumuGVGI-wY651qA.js"></script><script charset="UTF-8" src="./How We Implemented a Fully Serverless Recommender System Using GCP_files/main-notes.bundle.4Hcf4I6qAbwXHFjEyhPyAg.js"></script></body></html>